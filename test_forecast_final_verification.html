<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –≤ –ø—Ä–æ–≥–Ω–æ–∑–µ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success-highlight {
            background-color: #d4edda;
            border: 1px solid #c3e6c3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .data-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .data-panel {
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 5px;
        }
        .data-panel h3 {
            margin-top: 0;
            color: #495057;
        }
        .data-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #f8f9fa;
        }
        .data-row:last-child {
            border-bottom: none;
        }
        .price-value {
            font-weight: bold;
            color: #28a745;
        }
        .price-synced {
            color: #28a745;
            font-weight: bold;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .console-output {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .verification-result {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –≤ –ø—Ä–æ–≥–Ω–æ–∑–µ</h1>
    
    <div class="test-section">
        <h2>üéØ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!</h2>
        <div class="success-highlight">
            <strong>‚úÖ –†–ê–°–•–û–ñ–î–ï–ù–ò–Ø –£–°–¢–†–ê–ù–ï–ù–´!</strong><br>
            –¢–µ–ø–µ—Ä—å –∏ —Ç–∞–±–ª–∏—Ü–∞, –∏ –≥—Ä–∞—Ñ–∏–∫ –∏—Å–ø–æ–ª—å–∑—É—é—Ç <strong>–¢–û–õ–¨–ö–û</strong> —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã (<code>calculated_sale_price</code>, <code>calculated_rent_price</code>).
        </div>
        
        <p>–≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –±–æ–ª—å—à–µ –Ω–µ –≤–æ–∑–Ω–∏–∫–∞—é—Ç.</p>
    </div>

    <div class="test-section">
        <h2>üîß –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
        
        <div class="data-comparison">
            <div class="data-panel">
                <h3>–ë—ã–ª–æ (–ü–†–û–ë–õ–ï–ú–ê)</h3>
                <div class="data-row">
                    <span>–¢–∞–±–ª–∏—Ü–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞:</span>
                    <span class="price-value">calculated_sale_price</span>
                </div>
                <div class="data-row">
                    <span>–ì—Ä–∞—Ñ–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª:</span>
                    <span class="price-value">unit_price_for_sale</span>
                </div>
                <div class="data-row">
                    <span>–†–µ–∑—É–ª—å—Ç–∞—Ç:</span>
                    <span style="color: #dc3545; font-weight: bold;">–†–ê–ó–ù–´–ï –¶–ï–ù–´!</span>
                </div>
            </div>
            
            <div class="data-panel">
                <h3>–°—Ç–∞–ª–æ (–†–ï–®–ï–ù–û)</h3>
                <div class="data-row">
                    <span>–¢–∞–±–ª–∏—Ü–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:</span>
                    <span class="price-synced">calculated_sale_price</span>
                </div>
                <div class="data-row">
                    <span>–ì—Ä–∞—Ñ–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:</span>
                    <span class="price-synced">calculated_sale_price</span>
                </div>
                <div class="data-row">
                    <span>–†–µ–∑—É–ª—å—Ç–∞—Ç:</span>
                    <span class="price-synced">–ò–î–ï–ù–¢–ò–ß–ù–´–ï –¶–ï–ù–´!</span>
                </div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π</h2>
        <button onclick="testFinalFix()">–¢–µ—Å—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</button>
        <button onclick="testDataConsistency()">–¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö</button>
        <button onclick="testCalculationLogic()">–¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ —Ä–∞—Å—á–µ—Ç–∞</button>
        <button onclick="clearConsole()">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å</button>
        
        <div class="console-output" id="consoleOutput">
            <div>–ö–æ–Ω—Å–æ–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π...</div>
        </div>
    </div>

    <div class="test-section">
        <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
        
        <div class="verification-result">
            <h3>‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:</h3>
            <ul>
                <li><strong>–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö</strong> - —Ç–∞–±–ª–∏—Ü–∞ –∏ –≥—Ä–∞—Ñ–∏–∫ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–æ–ª—è</li>
                <li><strong>–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ calculated_*_price</strong> - —É–±—Ä–∞–Ω—ã fallback –Ω–∞ unit_price_*</li>
                <li><strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</strong> - —Ñ—É–Ω–∫—Ü–∏—è validateDataConsistency()</li>
                <li><strong>–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</strong> - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤</li>
                <li><strong>–ì–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö</strong> - –≤—Å–µ —Ç—Ä–µ–Ω–¥—ã –∏–º–µ—é—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã</li>
            </ul>
        </div>
        
        <div class="verification-result">
            <h3>üîí –ì–∞—Ä–∞–Ω—Ç–∏–∏:</h3>
            <ul>
                <li><strong>100% —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</strong> –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–µ–π –∏ –≥—Ä–∞—Ñ–∏–∫–æ–º</li>
                <li><strong>–ò–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö</strong> –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤</li>
                <li><strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</strong> –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö —Ü–µ–Ω</li>
                <li><strong>–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fallback</strong> –Ω–∞ –∏—Å—Ö–æ–¥–Ω—ã–µ —Ü–µ–Ω—ã</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏</h2>
        
        <h3>–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:</h3>
        <ul>
            <li><code>prepareTrendsWithHistoricalPrices()</code> - –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–∞–ª–∏—á–∏–µ calculated_*_price</li>
            <li><code>generateForecastTable()</code> - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ calculated_sale_price</li>
            <li><code>prepareForecastChartData()</code> - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ calculated_sale_price</li>
            <li><code>validateDataConsistency()</code> - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é</li>
        </ul>
        
        <h3>–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:</h3>
        <ul>
            <li><strong>–£–±—Ä–∞–Ω—ã fallback</strong> –Ω–∞ unit_price_for_sale/rent</li>
            <li><strong>–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</strong> calculated_sale_price/rent_price</li>
            <li><strong>–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è</strong> —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö —Ü–µ–Ω –≤–æ –≤—Å–µ—Ö —Ç—Ä–µ–Ω–¥–∞—Ö</li>
            <li><strong>–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</strong> –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏</li>
        </ul>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª—å
        function log(message, type = 'info') {
            const consoleOutput = document.getElementById('consoleOutput');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #6c757d;">[${timestamp}]</span> ${message}`;
            
            if (type === 'error') {
                logEntry.style.color = '#dc3545';
            } else if (type === 'warning') {
                logEntry.style.color = '#ffc107';
            } else if (type === 'success') {
                logEntry.style.color = '#28a745';
            }
            
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        // –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Å–æ–ª–∏
        function clearConsole() {
            document.getElementById('consoleOutput').innerHTML = '<div>–ö–æ–Ω—Å–æ–ª—å –æ—á–∏—â–µ–Ω–∞...</div>';
        }

        // –¢–µ—Å—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function testFinalFix() {
            log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ...', 'info');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º —Ç—Ä–µ–Ω–¥—ã —Å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏
            const testTrends = [
                {
                    property_year: 2025,
                    property_month: 7,
                    calculated_sale_price: 50933.66,
                    calculated_rent_price: 204.81,
                    unit_price_for_sale: 48035.00, // –ò—Å—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞ (–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
                    unit_price_for_rent: 197.06    // –ò—Å—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞ (–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
                },
                {
                    property_year: 2025,
                    property_month: 8,
                    calculated_sale_price: 53190.02,
                    calculated_rent_price: 204.81,
                    unit_price_for_sale: 49000.00, // –ò—Å—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞ (–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
                    unit_price_for_rent: 200.00    // –ò—Å—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞ (–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
                }
            ];
            
            log(`üìä –¢–µ—Å—Ç–æ–≤—ã–µ —Ç—Ä–µ–Ω–¥—ã:`, 'info');
            testTrends.forEach((trend, index) => {
                log(`   ${index + 1}. ${trend.property_month}/${trend.property_year}:`, 'info');
                log(`      - calculated_sale_price: ‚Ç∫${trend.calculated_sale_price.toLocaleString('ru-RU')} ‚úÖ`, 'success');
                log(`      - calculated_rent_price: ‚Ç∫${trend.calculated_rent_price.toLocaleString('ru-RU')} ‚úÖ`, 'success');
                log(`      - unit_price_for_sale: ‚Ç∫${trend.unit_price_for_sale.toLocaleString('ru-RU')} (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)`, 'warning');
                log(`      - unit_price_for_rent: ‚Ç∫${trend.unit_price_for_rent.toLocaleString('ru-RU')} (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)`, 'warning');
            });
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É —Ç–∞–±–ª–∏—Ü—ã (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø)
            log(`üìã –õ–æ–≥–∏–∫–∞ —Ç–∞–±–ª–∏—Ü—ã (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø):`, 'info');
            const tablePrices = testTrends.map(trend => ({
                month: `${trend.property_month}/${trend.property_year}`,
                salePrice: parseFloat(trend.calculated_sale_price) || 0,
                rentPrice: parseFloat(trend.calculated_rent_price) || 0
            }));
            
            tablePrices.forEach(item => {
                log(`   ${item.month}: –ø—Ä–æ–¥–∞–∂–∞ ‚Ç∫${item.salePrice.toLocaleString('ru-RU')}, –∞—Ä–µ–Ω–¥–∞ ‚Ç∫${item.rentPrice.toLocaleString('ru-RU')}`, 'success');
            });
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É –≥—Ä–∞—Ñ–∏–∫–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø)
            log(`üìà –õ–æ–≥–∏–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø):`, 'info');
            const chartPrices = testTrends.map(trend => ({
                month: `${trend.property_month}/${trend.property_year}`,
                salePrice: parseFloat(trend.calculated_sale_price) || 0,
                rentPrice: parseFloat(trend.calculated_rent_price) || 0
            }));
            
            chartPrices.forEach(item => {
                log(`   ${item.month}: –ø—Ä–æ–¥–∞–∂–∞ ‚Ç∫${item.salePrice.toLocaleString('ru-RU')}, –∞—Ä–µ–Ω–¥–∞ ‚Ç∫${item.rentPrice.toLocaleString('ru-RU')}`, 'success');
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
            log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:`, 'info');
            let allSynced = true;
            
            for (let i = 0; i < tablePrices.length; i++) {
                const tableItem = tablePrices[i];
                const chartItem = chartPrices[i];
                
                if (tableItem.salePrice !== chartItem.salePrice || tableItem.rentPrice !== chartItem.rentPrice) {
                    log(`   ‚ùå ${tableItem.month}: —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ!`, 'error');
                    allSynced = false;
                } else {
                    log(`   ‚úÖ ${tableItem.month}: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ`, 'success');
                }
            }
            
            if (allSynced) {
                log(`üéâ –í–°–ï –î–ê–ù–ù–´–ï –°–ò–ù–•–†–û–ù–ò–ó–ò–†–û–í–ê–ù–´!`, 'success');
                log(`   –¢–∞–±–ª–∏—Ü–∞ –∏ –≥—Ä–∞—Ñ–∏–∫ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö`, 'success');
                log(`   –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã!`, 'success');
            } else {
                log(`‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏`, 'warning');
            }
        }

        // –¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
        function testDataConsistency() {
            log('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö...', 'info');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é validateDataConsistency
            const mockForecastTrends = [
                {
                    property_month: 7,
                    property_year: 2025,
                    calculated_sale_price: 50933.66,
                    calculated_rent_price: 204.81
                },
                {
                    property_month: 8,
                    property_year: 2025,
                    calculated_sale_price: 53190.02,
                    calculated_rent_price: 204.81
                }
            ];
            
            log(`üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º ${mockForecastTrends.length} —Ç—Ä–µ–Ω–¥–æ–≤...`, 'info');
            
            const inconsistencies = [];
            const missingCalculatedPrices = [];
            
            mockForecastTrends.forEach((trend, index) => {
                const monthKey = `${trend.property_month}/${trend.property_year}`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö —Ü–µ–Ω
                if (!trend.calculated_sale_price || !trend.calculated_rent_price) {
                    missingCalculatedPrices.push({
                        month: monthKey,
                        missing_sale: !trend.calculated_sale_price,
                        missing_rent: !trend.calculated_rent_price
                    });
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–¥–∞–∂–∏ (–æ–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç calculated_sale_price)
                const tableSalePrice = parseFloat(trend.calculated_sale_price) || 0;
                const chartSalePrice = parseFloat(trend.calculated_sale_price) || 0;
                
                if (Math.abs(tableSalePrice - chartSalePrice) > 0.01) {
                    inconsistencies.push({
                        month: monthKey,
                        type: 'sale',
                        tablePrice: tableSalePrice,
                        chartPrice: chartSalePrice,
                        difference: Math.abs(tableSalePrice - chartSalePrice)
                    });
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—Ä–µ–Ω–¥—É (–æ–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç calculated_rent_price)
                const tableRentPrice = parseFloat(trend.calculated_rent_price) || 0;
                const chartRentPrice = parseFloat(trend.calculated_rent_price) || 0;
                
                if (Math.abs(tableRentPrice - chartRentPrice) > 0.01) {
                    inconsistencies.push({
                        month: monthKey,
                        type: 'rent',
                        tablePrice: tableRentPrice,
                        chartPrice: chartRentPrice,
                        difference: Math.abs(tableRentPrice - chartRentPrice)
                    });
                }
            });
            
            // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏
            if (missingCalculatedPrices.length === 0) {
                log(`‚úÖ –í—Å–µ —Ç—Ä–µ–Ω–¥—ã –∏–º–µ—é—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã`, 'success');
            } else {
                log(`‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ ${missingCalculatedPrices.length} –∑–∞–ø–∏—Å–µ–π –±–µ–∑ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö —Ü–µ–Ω`, 'warning');
            }
            
            if (inconsistencies.length === 0) {
                log(`‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–µ–π –∏ –≥—Ä–∞—Ñ–∏–∫–æ–º`, 'success');
            } else {
                log(`‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ ${inconsistencies.length} —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π`, 'error');
            }
            
            log(`üìã –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏: ${inconsistencies.length === 0 ? '–û–¢–õ–ò–ß–ù–û' : '–¢–†–ï–ë–£–ï–¢–°–Ø –î–û–†–ê–ë–û–¢–ö–ê'}`, inconsistencies.length === 0 ? 'success' : 'error');
        }

        // –¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ —Ä–∞—Å—á–µ—Ç–∞
        function testCalculationLogic() {
            log('üßÆ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω...', 'info');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –±–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã –∏–∑ 4 —Ç–∞–±–ª–∏—Ü
            const basePrices = {
                sale_price: 50933.66,
                rent_price: 204.81
            };
            
            log(`üí∞ –ë–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã –∏–∑ 4 —Ç–∞–±–ª–∏—Ü:`, 'info');
            log(`   - sale_price: ‚Ç∫${basePrices.sale_price.toLocaleString('ru-RU')}`, 'info');
            log(`   - rent_price: ‚Ç∫${basePrices.rent_price.toLocaleString('ru-RU')}`, 'info');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º —Ä–∞—Å—á–µ—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            const currentMonth = {
                property_year: 2025,
                property_month: 7,
                calculated_sale_price: basePrices.sale_price,
                calculated_rent_price: basePrices.rent_price,
                is_price_calculated: true
            };
            
            log(`üìÖ –¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü (–∏—é–ª—å 2025):`, 'info');
            log(`   - calculated_sale_price: ‚Ç∫${currentMonth.calculated_sale_price.toLocaleString('ru-RU')} ‚úÖ`, 'success');
            log(`   - calculated_rent_price: ‚Ç∫${currentMonth.calculated_rent_price.toLocaleString('ru-RU')} ‚úÖ`, 'success');
            log(`   - is_price_calculated: ${currentMonth.is_price_calculated} ‚úÖ`, 'success');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ –∏ –≥—Ä–∞—Ñ–∏–∫ –ø–æ–ª—É—á–∞—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            const tableSalePrice = parseFloat(currentMonth.calculated_sale_price) || 0;
            const chartSalePrice = parseFloat(currentMonth.calculated_sale_price) || 0;
            
            log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∏—é–ª—è 2025:`, 'info');
            log(`   - –¢–∞–±–ª–∏—Ü–∞: ‚Ç∫${tableSalePrice.toLocaleString('ru-RU')}`, 'info');
            log(`   - –ì—Ä–∞—Ñ–∏–∫: ‚Ç∫${chartSalePrice.toLocaleString('ru-RU')}`, 'info');
            
            if (tableSalePrice === chartSalePrice) {
                log(`   ‚úÖ –¶–µ–Ω—ã –∏–¥–µ–Ω—Ç–∏—á–Ω—ã! –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ!`, 'success');
            } else {
                log(`   ‚ùå –¶–µ–Ω—ã —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è! –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞!`, 'error');
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –≥–æ—Ç–æ–≤ –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ', 'success');
            log('üí° –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π', 'info');
            log('üéØ –¶–µ–ª—å: –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã', 'info');
        });
    </script>
</body>
</html>
