<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f9f9f9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: right;
        }
        th {
            background-color: #4CAF50;
            color: white;
            text-align: center;
        }
        td:first-child {
            text-align: left;
            font-weight: bold;
        }
        .current-month {
            background-color: #e3f2fd;
        }
        .historical {
            background-color: #fff3cd;
        }
        .future {
            background-color: #f5f5f5;
        }
        .error {
            background-color: #ffcdd2;
        }
        .success {
            background-color: #c8e6c9;
        }
        .formula {
            font-family: monospace;
            background: #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            overflow-x: auto;
        }
        .summary {
            background: #d4edda;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .small-diff {
            color: green;
        }
        .large-diff {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ —Ü–µ–Ω</h1>
        
        <div class="summary">
            <h2>üìã –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:</h2>
            <ul>
                <li>–§—É–Ω–∫—Ü–∏—è <code>calculateHistoricalPrice</code> —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ 4.47 (–¥–ª—è 4.47%)</li>
                <li>–§—É–Ω–∫—Ü–∏—è <code>calculateFuturePrice</code> —Ç–∞–∫–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è</li>
                <li>–û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ª–æ–≥–∏ –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h2>üìä –î–∞–Ω–Ω—ã–µ —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞</h2>
            <table id="originalData">
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ü—Ä–æ–¥–∞–∂–∞ (‚Ç∫/–º¬≤)</th>
                        <th>–ò–∑–º-–∏–µ —Ü–µ–Ω—ã</th>
                        <th>–ê—Ä–µ–Ω–¥–∞ (‚Ç∫/–º¬≤)</th>
                        <th>–ò–∑–º-–∏–µ –∞—Ä–µ–Ω–¥—ã</th>
                        <th>–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div class="test-section">
            <h2>üßÆ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤</h2>
            <div class="formula">
                <strong>–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –º–µ—Å—è—Ü—ã:</strong> –¶–µ–Ω–∞ = –¶–µ–Ω–∞_—Å–ª–µ–¥—É—é—â–µ–≥–æ_–º–µ—Å—è—Ü–∞ √∑ (1 + –ø—Ä–æ—Ü–µ–Ω—Ç_–∏–∑–º–µ–Ω–µ–Ω–∏—è/100)<br>
                <strong>–ë—É–¥—É—â–∏–µ –º–µ—Å—è—Ü—ã:</strong> –¶–µ–Ω–∞ = –¶–µ–Ω–∞_–ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ_–º–µ—Å—è—Ü–∞ √ó (1 + –ø—Ä–æ—Ü–µ–Ω—Ç_–∏–∑–º–µ–Ω–µ–Ω–∏—è/100)
            </div>
            <table id="calculatedData">
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–∞</th>
                        <th>–†–∞—Å—á–µ—Ç–Ω–∞—è —Ü–µ–Ω–∞</th>
                        <th>–†–∞–∑–Ω–∏—Ü–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- –†–∞—Å—á–µ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div class="test-section">
            <h2>üìà –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
            <div id="analysisResults"></div>
        </div>
    </div>
    
    <script>
        // –î–∞–Ω–Ω—ã–µ —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞
        const screenshotData = [
            { date: '—Å–µ–Ω. 2025', salePrice: 50836.00, saleChange: 1.30, rentPrice: 199.54, rentChange: 1.56, yield: 4.71, type: 'future' },
            { date: '–∞–≤–≥. 2025', salePrice: 50184.00, saleChange: 4.47, rentPrice: 196.48, rentChange: 2.71, yield: 4.70, type: 'current' },
            { date: '–∏—é–ª. 2025', salePrice: 48035.00, saleChange: 4.43, rentPrice: 191.30, rentChange: 3.93, yield: 4.78, type: 'historical' },
            { date: '–∏—é–Ω. 2025', salePrice: 53190.02, saleChange: 3.74, rentPrice: 204.81, rentChange: 3.79, yield: 4.80, type: 'historical' },
            { date: '–º–∞–π. 2025', salePrice: 51480.86, saleChange: 3.32, rentPrice: 200.79, rentChange: 2.00, yield: 4.80, type: 'historical' },
            { date: '–∞–ø—Ä. 2025', salePrice: 50352.95, saleChange: 2.24, rentPrice: 197.41, rentChange: 1.71, yield: 4.86, type: 'historical' },
            { date: '–º–∞—Ä. 2025', salePrice: 49657.74, saleChange: 1.40, rentPrice: 193.26, rentChange: 2.15, yield: 4.89, type: 'historical' },
            { date: '—Ñ–µ–≤. 2025', salePrice: 49707.45, saleChange: -0.10, rentPrice: 190.89, rentChange: 1.24, yield: 4.85, type: 'historical' },
            { date: '—è–Ω–≤. 2025', salePrice: 49977.33, saleChange: -0.54, rentPrice: 187.85, rentChange: 1.62, yield: 4.79, type: 'historical' },
            { date: '–¥–µ–∫. 2024', salePrice: 51127.70, saleChange: -2.25, rentPrice: 184.67, rentChange: 1.72, yield: 4.68, type: 'historical' }
        ];
        
        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á–µ—Ç–∞
        function calculateHistoricalPrice(nextMonthPrice, percentageChange) {
            if (!nextMonthPrice || percentageChange === null || percentageChange === undefined) return nextMonthPrice;
            const changeMultiplier = 1 + (percentageChange / 100);
            return nextMonthPrice / changeMultiplier;
        }
        
        function calculateFuturePrice(previousPrice, percentageChange) {
            const changeMultiplier = 1 + (percentageChange / 100);
            return previousPrice * changeMultiplier;
        }
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        function fillOriginalData() {
            const tbody = document.querySelector('#originalData tbody');
            screenshotData.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = row.type;
                tr.innerHTML = `
                    <td>${row.date}</td>
                    <td>‚Ç∫${row.salePrice.toFixed(2)}</td>
                    <td>${row.saleChange > 0 ? '+' : ''}${row.saleChange}%</td>
                    <td>‚Ç∫${row.rentPrice.toFixed(2)}</td>
                    <td>${row.rentChange > 0 ? '+' : ''}${row.rentChange}%</td>
                    <td>${row.yield}%</td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // –í—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞—Å—á–µ—Ç—ã —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
        function performCalculations() {
            const tbody = document.querySelector('#calculatedData tbody');
            const augustIndex = 1; // –ê–≤–≥—É—Å—Ç - –±–∞–∑–æ–≤—ã–π –º–µ—Å—è—Ü
            const augustPrice = screenshotData[augustIndex].salePrice;
            
            let calculatedPrices = {};
            calculatedPrices[augustIndex] = augustPrice;
            
            // –ê–≤–≥—É—Å—Ç - –±–∞–∑–æ–≤—ã–π –º–µ—Å—è—Ü
            const augustRow = document.createElement('tr');
            augustRow.className = 'current-month';
            augustRow.innerHTML = `
                <td>${screenshotData[augustIndex].date}</td>
                <td>‚Ç∫${augustPrice.toFixed(2)}</td>
                <td>‚Ç∫${augustPrice.toFixed(2)}</td>
                <td>‚Ç∫0.00</td>
                <td class="success">–ë–∞–∑–æ–≤—ã–π –º–µ—Å—è—Ü</td>
                <td>–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –æ—Ç—á–µ—Ç–∞</td>
            `;
            tbody.appendChild(augustRow);
            
            // –°–µ–Ω—Ç—è–±—Ä—å - –±—É–¥—É—â–∏–π –º–µ—Å—è—Ü
            const septData = screenshotData[0];
            const septCalc = calculateFuturePrice(augustPrice, septData.saleChange);
            const septDiff = Math.abs(septData.salePrice - septCalc);
            
            const septRow = document.createElement('tr');
            septRow.className = 'future';
            septRow.innerHTML = `
                <td>${septData.date}</td>
                <td>‚Ç∫${septData.salePrice.toFixed(2)}</td>
                <td>‚Ç∫${septCalc.toFixed(2)}</td>
                <td class="${septDiff < 10 ? 'small-diff' : 'large-diff'}">‚Ç∫${septDiff.toFixed(2)}</td>
                <td class="${septDiff < 10 ? 'success' : 'error'}">${septDiff < 10 ? '‚úì' : '‚úó'}</td>
                <td>${augustPrice.toFixed(2)} √ó (1 + ${septData.saleChange}%) = ${septCalc.toFixed(2)}</td>
            `;
            tbody.appendChild(septRow);
            
            // –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –º–µ—Å—è—Ü—ã
            for (let i = augustIndex + 1; i < screenshotData.length; i++) {
                const monthData = screenshotData[i];
                const nextMonthPrice = calculatedPrices[i - 1];
                const calculatedPrice = calculateHistoricalPrice(nextMonthPrice, monthData.saleChange);
                calculatedPrices[i] = calculatedPrice;
                
                const diff = Math.abs(monthData.salePrice - calculatedPrice);
                const row = document.createElement('tr');
                row.className = 'historical';
                row.innerHTML = `
                    <td>${monthData.date}</td>
                    <td>‚Ç∫${monthData.salePrice.toFixed(2)}</td>
                    <td>‚Ç∫${calculatedPrice.toFixed(2)}</td>
                    <td class="${diff < 10 ? 'small-diff' : 'large-diff'}">‚Ç∫${diff.toFixed(2)}</td>
                    <td class="${diff < 10 ? 'success' : 'error'}">${diff < 10 ? '‚úì' : '‚úó'}</td>
                    <td>${nextMonthPrice.toFixed(2)} √∑ (1 + ${monthData.saleChange}%) = ${calculatedPrice.toFixed(2)}</td>
                `;
                tbody.appendChild(row);
            }
        }
        
        // –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function analyzeResults() {
            const analysisDiv = document.getElementById('analysisResults');
            
            // –°—á–∏—Ç–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            let totalDiff = 0;
            let maxDiff = 0;
            let correctCount = 0;
            const threshold = 10; // –î–æ–ø—É—Å—Ç–∏–º–∞—è –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å –≤ ‚Ç∫
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–ª—è –≤—Å–µ—Ö –º–µ—Å—è—Ü–µ–≤ –∫—Ä–æ–º–µ –∞–≤–≥—É—Å—Ç–∞
            const augustIndex = 1;
            const augustPrice = screenshotData[augustIndex].salePrice;
            
            // –°–µ–Ω—Ç—è–±—Ä—å
            const septCalc = calculateFuturePrice(augustPrice, screenshotData[0].saleChange);
            const septDiff = Math.abs(screenshotData[0].salePrice - septCalc);
            totalDiff += septDiff;
            maxDiff = Math.max(maxDiff, septDiff);
            if (septDiff < threshold) correctCount++;
            
            // –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –º–µ—Å—è—Ü—ã
            let prevPrice = augustPrice;
            for (let i = augustIndex + 1; i < screenshotData.length; i++) {
                const monthData = screenshotData[i];
                const calculatedPrice = calculateHistoricalPrice(prevPrice, monthData.saleChange);
                const diff = Math.abs(monthData.salePrice - calculatedPrice);
                totalDiff += diff;
                maxDiff = Math.max(maxDiff, diff);
                if (diff < threshold) correctCount++;
                prevPrice = calculatedPrice;
            }
            
            const avgDiff = totalDiff / (screenshotData.length - 1);
            const accuracy = (correctCount / (screenshotData.length - 1)) * 100;
            
            let html = `
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á–µ—Ç–æ–≤:</h3>
                <ul>
                    <li><strong>–°—Ä–µ–¥–Ω—è—è –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å:</strong> ‚Ç∫${avgDiff.toFixed(2)}</li>
                    <li><strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å:</strong> ‚Ç∫${maxDiff.toFixed(2)}</li>
                    <li><strong>–¢–æ—á–Ω–æ—Å—Ç—å (–ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å < ‚Ç∫10):</strong> ${accuracy.toFixed(1)}% (${correctCount} –∏–∑ ${screenshotData.length - 1})</li>
                </ul>
            `;
            
            if (maxDiff > 1000) {
                html += `
                    <div style="background: #ffebee; padding: 15px; border-radius: 4px; margin-top: 20px;">
                        <h3>‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞:</h3>
                        <p>–ë–æ–ª—å—à–∏–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –º–µ–∂–¥—É —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ –∏ —Ä–∞—Å—á–µ—Ç–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ —Ç–æ, —á—Ç–æ:</p>
                        <ul>
                            <li>–¶–µ–Ω—ã –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥—Ä—É–≥–æ–π –ª–æ–≥–∏–∫–∏</li>
                            <li>–í–æ–∑–º–æ–∂–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã –¥–ª—è –∞–≤–≥—É—Å—Ç–∞</li>
                            <li>–ò–ª–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥—Ä—É–≥–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞</li>
                        </ul>
                    </div>
                `;
            } else {
                html += `
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 4px; margin-top: 20px;">
                        <h3>‚úÖ –†–∞—Å—á–µ—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã!</h3>
                        <p>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ù–µ–±–æ–ª—å—à–∏–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω—ã —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º.</p>
                    </div>
                `;
            }
            
            analysisDiv.innerHTML = html;
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            fillOriginalData();
            performCalculations();
            analyzeResults();
        };
    </script>
</body>
</html>