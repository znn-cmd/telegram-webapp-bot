<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="/i18n-manager.js"></script>
    <meta charset="UTF-8">
    <title data-i18n-title="balance.income">Пополнение баланса</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f8f9fa; margin: 0; }
        .container { max-width: 340px; margin: 40px auto; background: #fff; border-radius: 16px; box-shadow: 0 2px 12px rgba(102,126,234,0.10); padding: 32px 20px 24px 20px; text-align: center; }
        .title { font-size: 1.3em; font-weight: bold; margin-bottom: 18px; color: #333; }
        .soon { font-size: 18px; color: #667eea; margin-top: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="title" id="topupTitle">Пополнение баланса</div>
        <div class="soon" id="soonText">Тут скоро будет платежка</div>
    </div>
    <script>
        let currentLanguage = 'ru';

        // Получаем данные пользователя
        function getUserData() {
            let tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
            if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                return tg.initDataUnsafe.user;
            }
            try {
                const stored = localStorage.getItem('aaadviser_user');
                if (stored) return JSON.parse(stored);
            } catch (e) {}
            return null;
        }

        // Локализации
        const locales = {
            'ru': {
                'topupTitle': 'Пополнение баланса',
                'soonText': 'Тут скоро будет платежка'
            },
            'en': {
                'topupTitle': 'Top Up Balance',
                'soonText': 'Payment system coming soon'
            },
            'de': {
                'topupTitle': 'Kontostand aufladen',
                'soonText': 'Zahlungssystem kommt bald'
            },
            'fr': {
                'topupTitle': 'Recharger le solde',
                'soonText': 'Système de paiement bientôt disponible'
            },
            'tr': {
                'topupTitle': 'Bakiye Yükle',
                'soonText': 'Ödeme sistemi yakında gelecek'
            }
        };

        // Функция для получения локализованного текста
        function getText(key) {
            const locale = locales[currentLanguage] || locales['ru'];
            return locale[key] || key;
        }

        // Обновление текста на странице
        function updatePageText() {
            document.getElementById('topupTitle').textContent = getText('topupTitle');
            document.getElementById('soonText').textContent = getText('soonText');
        }

        // Инициализация
        async function init() {
            const userData = getUserData();
            if (!userData) {
                updatePageText();
                return;
            }

            try {
                const response = await fetch('/api/user', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        telegram_id: userData.id,
                        username: userData.username,
                        tg_name: userData.tg_name,
                        last_name: userData.last_name,
                        language_code: userData.language_code || 'ru'
                    })
                });

                if (response.ok) {
                    const userInfo = await response.json();
                    
                    // Устанавливаем язык в зависимости от статуса пользователя
                    if (userInfo.user_status === 'admin' && userInfo.language) {
                        // Для админов используем язык из базы данных
                        currentLanguage = userInfo.language;
                    } else if (userData.language_code) {
                        // Для обычных пользователей используем язык из Telegram
                        currentLanguage = userData.language_code;
                    }
                }
            } catch (error) {
                // В случае ошибки используем язык из Telegram
                if (userData.language_code) {
                    currentLanguage = userData.language_code;
                }
            }
            
            updatePageText();
        }

        // Запускаем инициализацию
        init();
    </script>
</body>
</html> 