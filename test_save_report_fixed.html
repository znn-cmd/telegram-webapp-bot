<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #218838;
        }
        .result-section {
            background: #e8f5e8;
            border: 1px solid #c3e6c3;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
        .error-section {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞</h1>
        
        <p>–≠—Ç–æ—Ç —Ñ–∞–π–ª —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è HTML –æ—Ç—á–µ—Ç–∞.</p>
        
        <div>
            <button class="test-button" onclick="testSaveReport()">–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞</button>
            <button class="test-button" onclick="clearResults()">–û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        </div>
        
        <div id="resultSection" class="result-section" style="display: none;">
            <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h4>
            <div id="resultOutput"></div>
        </div>
        
        <div id="errorSection" class="error-section" style="display: none;">
            <h4>–û—à–∏–±–∫–∞:</h4>
            <div id="errorOutput"></div>
        </div>
    </div>

    <script>
        async function testSaveReport() {
            const resultSection = document.getElementById('resultSection');
            const errorSection = document.getElementById('errorSection');
            const resultOutput = document.getElementById('resultOutput');
            const errorOutput = document.getElementById('errorOutput');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            resultSection.style.display = 'none';
            errorSection.style.display = 'none';
            
            try {
                // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                const testData = {
                    telegram_id: '123456789',
                    report_content: '<div>–¢–µ—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç</div>',
                    location_info: 'T√ºrkiye, Antalya, Test District',
                    object_data: {
                        bedrooms: '2+1',
                        floor: '3',
                        age: '5',
                        heating: '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ',
                        price: '150,000 EUR',
                        area: '120 –º¬≤',
                        currency: 'EUR'
                    }
                };
                
                console.log('üß™ Testing save report with data:', testData);
                
                const response = await fetch('/api/save_html_report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ Save report successful:', result);
                    
                    resultOutput.innerHTML = `
                        <p><strong>‚úÖ –û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!</strong></p>
                        <p><strong>ID –æ—Ç—á–µ—Ç–∞:</strong> ${result.report_id}</p>
                        <p><strong>–ò–º—è —Ñ–∞–π–ª–∞:</strong> ${result.filename}</p>
                        <p><strong>–°—Å—ã–ª–∫–∞:</strong> <a href="${result.report_url}" target="_blank">${result.report_url}</a></p>
                    `;
                    resultSection.style.display = 'block';
                } else {
                    const errorText = await response.text();
                    console.error('‚ùå Save report failed:', response.status, errorText);
                    
                    errorOutput.innerHTML = `
                        <p><strong>‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞</strong></p>
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status}</p>
                        <p><strong>–û—Ç–≤–µ—Ç:</strong> ${errorText}</p>
                    `;
                    errorSection.style.display = 'block';
                }
                
            } catch (error) {
                console.error('‚ùå Test failed with error:', error);
                
                errorOutput.innerHTML = `
                    <p><strong>‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</strong></p>
                    <p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ${error.message}</p>
                `;
                errorSection.style.display = 'block';
            }
        }
        
        function clearResults() {
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('errorSection').style.display = 'none';
        }
    </script>
</body>
</html>
