<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .chart-container {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #218838;
        }
        .result-section {
            background: #e8f5e8;
            border: 1px solid #c3e6c3;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤</h1>
        
        <div class="chart-container">
            <h3>–ì—Ä–∞—Ñ–∏–∫ —Ç—Ä–µ–Ω–¥–æ–≤</h3>
            <canvas id="trendsChart" width="600" height="300"></canvas>
        </div>
        
        <div class="chart-container">
            <h3>–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥–Ω–æ–∑–∞</h3>
            <canvas id="forecastChart" width="600" height="300"></canvas>
        </div>
        
        <div class="debug-info">
            <h4>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h4>
            <div id="debugOutput">–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</div>
        </div>
        
        <div>
            <button class="test-button" onclick="testExportWithTableData()">–¢–µ—Å—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü</button>
            <button class="test-button" onclick="testChartRestoration()">–¢–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤</button>
            <button class="test-button" onclick="clearResults()">–û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        </div>
        
        <div id="resultSection" class="result-section" style="display: none;">
            <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h4>
            <div id="resultOutput"></div>
        </div>
    </div>

    <script>
        let trendsChart, forecastChart;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            updateDebugInfo();
        });
        
        function initializeCharts() {
            // –ì—Ä–∞—Ñ–∏–∫ —Ç—Ä–µ–Ω–¥–æ–≤
            const trendsCtx = document.getElementById('trendsChart').getContext('2d');
            trendsChart = new Chart(trendsCtx, {
                type: 'line',
                data: {
                    labels: ['–Ø–Ω–≤ 2025', '–§–µ–≤ 2025', '–ú–∞—Ä 2025', '–ê–ø—Ä 2025', '–ú–∞–π 2025', '–ò—é–Ω 2025'],
                    datasets: [{
                        label: '–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ (‚Ç∫/–º¬≤)',
                        data: [45000, 46000, 47000, 48000, 49000, 50000],
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.4,
                        borderWidth: 3
                    }, {
                        label: '–¶–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã (‚Ç∫/–º¬≤)',
                        data: [170, 175, 180, 185, 190, 195],
                        borderColor: '#ffc107',
                        backgroundColor: 'rgba(255, 193, 7, 0.1)',
                        tension: 0.4,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥–Ω–æ–∑–∞
            const forecastCtx = document.getElementById('forecastChart').getContext('2d');
            forecastChart = new Chart(forecastCtx, {
                type: 'line',
                data: {
                    labels: ['–ò—é–ª 2025', '–ê–≤–≥ 2025', '–°–µ–Ω 2025', '–û–∫—Ç 2025', '–ù–æ—è 2025', '–î–µ–∫ 2025'],
                    datasets: [{
                        label: '–ü—Ä–æ–≥–Ω–æ–∑ –ø—Ä–æ–¥–∞–∂–∏ (‚Ç∫/–º¬≤)',
                        data: [51000, 52000, 53000, 54000, 55000, 56000],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        borderWidth: 3
                    }, {
                        label: '–ü—Ä–æ–≥–Ω–æ–∑ –∞—Ä–µ–Ω–¥—ã (‚Ç∫/–º¬≤)',
                        data: [200, 205, 210, 215, 220, 225],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
            window.trendsChart = trendsChart;
            window.forecastChart = forecastChart;
            
            console.log('‚úÖ Charts initialized:', { trendsChart, forecastChart });
        }
        
        function updateDebugInfo() {
            const debugOutput = document.getElementById('debugOutput');
            const trendsCanvas = document.getElementById('trendsChart');
            const forecastCanvas = document.getElementById('forecastChart');
            
            let debugText = '';
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä–∞—Ñ–∏–∫–∞—Ö
            debugText += `üìä –ì—Ä–∞—Ñ–∏–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:\n`;
            debugText += `- trendsChart: ${trendsChart ? '‚úÖ' : '‚ùå'}\n`;
            debugText += `- forecastChart: ${forecastChart ? '‚úÖ' : '‚ùå'}\n\n`;
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ canvas —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
            debugText += `üé® Canvas —ç–ª–µ–º–µ–Ω—Ç—ã:\n`;
            debugText += `- trendsChart canvas: ${trendsCanvas ? '‚úÖ' : '‚ùå'}\n`;
            debugText += `- forecastChart canvas: ${forecastCanvas ? '‚úÖ' : '‚ùå'}\n\n`;
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Chart.js —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö
            if (trendsCanvas) {
                const trendsInstance = Chart.getChart(trendsCanvas);
                debugText += `üîç Chart.js —ç–∫–∑–µ–º–ø–ª—è—Ä—ã:\n`;
                debugText += `- trendsChart instance: ${trendsInstance ? '‚úÖ' : '‚ùå'}\n`;
                if (trendsInstance) {
                    debugText += `  - Type: ${trendsInstance.config.type}\n`;
                    debugText += `  - Labels: ${trendsInstance.config.data.labels.length}\n`;
                    debugText += `  - Datasets: ${trendsInstance.config.data.datasets.length}\n`;
                }
            }
            
            debugOutput.textContent = debugText;
        }
        
        function testExportWithTableData() {
            console.log('üß™ Testing export with table data...');
            
            // –°–æ–∑–¥–∞–µ–º –∫–ª–æ–Ω –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
            const contentClone = document.querySelector('.container').cloneNode(true);
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—á–∏—Å—Ç–∫–∏
            removeInteractiveElementsPreserveCharts(contentClone);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const canvasElements = contentClone.querySelectorAll('canvas');
            console.log(`üìä Found ${canvasElements.length} canvas elements after export processing`);
            
            let resultText = `üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞:\n\n`;
            resultText += `–ù–∞–π–¥–µ–Ω–æ canvas —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ${canvasElements.length}\n\n`;
            
            canvasElements.forEach((canvas, index) => {
                const chartData = canvas.getAttribute('data-chart-data');
                const chartType = canvas.getAttribute('data-chart-type');
                const chartId = canvas.getAttribute('data-chart-id');
                
                resultText += `Canvas ${index + 1} (${canvas.id}):\n`;
                resultText += `- data-chart-data: ${chartData}\n`;
                resultText += `- data-chart-type: ${chartType}\n`;
                resultText += `- data-chart-id: ${chartId}\n\n`;
                
                console.log(`Canvas ${index + 1}:`, {
                    id: canvas.id,
                    'data-chart-data': chartData,
                    'data-chart-type': chartType,
                    'data-chart-id': chartId
                });
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            showResult(resultText);
        }
        
        function testChartRestoration() {
            console.log('üß™ Testing chart restoration...');
            
            // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π HTML —Å canvas —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
            const testHTML = `
                <div>
                    <canvas id="trendsChart" data-chart-data='{"type":"line"}' data-chart-type="line" data-chart-id="trendsChart"></canvas>
                    <canvas id="forecastChart" data-chart-data='{"type":"line"}' data-chart-type="line" data-chart-id="forecastChart"></canvas>
                    
                    <table class="trends-table">
                        <tbody>
                            <tr><td>—è–Ω–≤. 2025</td><td>‚Ç∫46 131,92</td><td>-0.54%</td><td>‚Ç∫174,15</td><td>+1.62%</td><td>4.79%</td></tr>
                            <tr><td>–¥–µ–∫. 2024</td><td>‚Ç∫47 193,78</td><td>-2.25%</td><td>‚Ç∫171,20</td><td>+1.72%</td><td>4.68%</td></tr>
                        </tbody>
                    </table>
                    
                    <table class="forecast-table">
                        <tbody>
                            <tr><td>–∏—é–ª. 2025</td><td>‚Ç∫50 933,66</td><td>‚Ç∫197,06</td><td>4.78%</td></tr>
                            <tr><td>–∞–≤–≥. 2025</td><td>‚Ç∫53 190,02</td><td>‚Ç∫204,81</td><td>4.70%</td></tr>
                        </tbody>
                    </table>
                </div>
            `;
            
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π div –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = testHTML;
            document.body.appendChild(tempDiv);
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
            try {
                restoreCharts();
                console.log('‚úÖ Chart restoration test completed');
                showResult('‚úÖ –¢–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.');
            } catch (error) {
                console.error('‚ùå Chart restoration test failed:', error);
                showResult(`‚ùå –¢–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π:\n${error.message}`);
            }
            
            // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π div
            document.body.removeChild(tempDiv);
        }
        
        function showResult(text) {
            const resultSection = document.getElementById('resultSection');
            const resultOutput = document.getElementById('resultOutput');
            
            resultOutput.textContent = text;
            resultSection.style.display = 'block';
        }
        
        function clearResults() {
            document.getElementById('resultSection').style.display = 'none';
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ (–∫–æ–ø–∏–∏ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞)
        function extractChartData(canvas) {
            try {
                const chartId = canvas.id;
                console.log(`üîç Extracting chart data for: ${chartId}`);
                
                // 1. Try to get chart instance from Chart.js
                const chartInstance = Chart.getChart(canvas);
                if (chartInstance && chartInstance.config && chartInstance.config.data) {
                    console.log(`‚úÖ Found Chart.js instance for ${chartId}:`, chartInstance.config.data);
                    return {
                        type: chartInstance.config.type,
                        data: chartInstance.config.data,
                        options: chartInstance.config.options
                    };
                }
                
                // 2. Try to extract data from global chart variables
                if (chartId === 'trendsChart' && window.trendsChart) {
                    console.log(`‚úÖ Found global trendsChart for ${chartId}:`, window.trendsChart.data);
                    return {
                        type: 'line',
                        data: window.trendsChart.data,
                        options: window.trendsChart.options
                    };
                }
                
                if (chartId === 'forecastChart' && window.forecastChart) {
                    console.log(`‚úÖ Found global forecastChart for ${chartId}:`, window.forecastChart.data);
                    return {
                        type: 'line',
                        data: window.forecastChart.data,
                        options: window.forecastChart.options
                    };
                }
                
                // 3. Try to extract data from table if chart data not available
                if (chartId === 'trendsChart') {
                    const tableData = extractDataFromTrendsTable();
                    if (tableData) {
                        console.log(`‚úÖ Extracted trends data from table for ${chartId}:`, tableData);
                        return tableData;
                    }
                }
                
                if (chartId === 'forecastChart') {
                    const tableData = extractDataFromForecastTable();
                    if (tableData) {
                        console.log(`‚úÖ Extracted forecast data from table for ${chartId}:`, tableData);
                        return tableData;
                    }
                }
                
                console.log(`‚ö†Ô∏è No chart data found for ${chartId}, using fallback`);
                return {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {}
                };
                
            } catch (error) {
                console.log('‚ùå Error extracting chart data:', error);
                return null;
            }
        }
        
        function removeInteractiveElementsPreserveCharts(element) {
            console.log('üîß Starting removeInteractiveElementsPreserveCharts...');
            
            // Remove buttons
            const buttons = element.querySelectorAll('button');
            console.log(`üóëÔ∏è Removing ${buttons.length} buttons`);
            buttons.forEach(button => button.remove());
            
            // Preserve charts with data for export
            const canvasElements = element.querySelectorAll('canvas');
            console.log(`üìä Found ${canvasElements.length} canvas elements for charts`);
            
            canvasElements.forEach((canvas, index) => {
                console.log(`üîç Processing canvas ${index + 1}: ${canvas.id}`);
                
                const chartData = extractChartData(canvas);
                if (chartData) {
                    console.log(`‚úÖ Chart data extracted for ${canvas.id}:`, chartData);
                    
                    canvas.setAttribute('data-chart-data', JSON.stringify(chartData));
                    canvas.setAttribute('data-chart-type', chartData.type || 'line');
                    canvas.setAttribute('data-chart-id', canvas.id || 'chart');
                    
                    console.log(`üíæ Chart data saved to ${canvas.id}`);
                } else {
                    console.log(`‚ö†Ô∏è No chart data extracted for ${canvas.id}`);
                }
            });
            
            console.log('‚úÖ removeInteractiveElementsPreserveCharts completed');
        }
        
        function extractDataFromTrendsTable() {
            try {
                const table = document.querySelector('.trends-table');
                if (!table) {
                    console.log('‚ùå Trends table not found');
                    return null;
                }
                
                const rows = table.querySelectorAll('tbody tr');
                console.log(`üîç Found ${rows.length} rows in trends table`);
                
                const labels = [];
                const salesData = [];
                const rentData = [];
                
                rows.forEach((row, index) => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 4) {
                        const date = cells[0].textContent.trim();
                        const salesPriceText = cells[1].textContent.trim();
                        const rentPriceText = cells[3].textContent.trim();
                        
                        // Extract numeric values from price text
                        const salesPrice = parseFloat(salesPriceText.replace(/[^\d.,]/g, '').replace(',', '.'));
                        const rentPrice = parseFloat(rentPriceText.replace(/[^\d.,]/g, '').replace(',', '.'));
                        
                        console.log(`Row ${index}: Date=${date}, Sales=${salesPriceText}->${salesPrice}, Rent=${rentPriceText}->${rentPrice}`);
                        
                        if (date && !isNaN(salesPrice) && !isNaN(rentPrice)) {
                            labels.push(date);
                            salesData.push(salesPrice);
                            rentData.push(rentPrice);
                        }
                    }
                });
                
                console.log(`‚úÖ Extracted trends data: ${labels.length} labels, ${salesData.length} sales, ${rentData.length} rent`);
                
                if (labels.length === 0) {
                    console.log('‚ö†Ô∏è No valid trends data extracted from table');
                    return null;
                }
                
                return {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: '–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ (‚Ç∫/–º¬≤)',
                                data: salesData,
                                borderColor: '#28a745',
                                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                                tension: 0.4,
                                borderWidth: 3,
                                fill: false
                            },
                            {
                                label: '–¶–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã (‚Ç∫/–º¬≤)',
                                data: rentData,
                                borderColor: '#ffc107',
                                backgroundColor: 'rgba(255, 193, 7, 0.1)',
                                tension: 0.4,
                                borderWidth: 3,
                                fill: false
                            }
                        ]
                    },
                    options: {}
                };
            } catch (error) {
                console.log('‚ùå Error extracting trends data from table:', error);
                return null;
            }
        }
        
        function extractDataFromForecastTable() {
            try {
                const table = document.querySelector('.forecast-table');
                if (!table) {
                    console.log('‚ùå Forecast table not found');
                    return null;
                }
                
                const rows = table.querySelectorAll('tbody tr');
                console.log(`üîç Found ${rows.length} rows in forecast table`);
                
                const labels = [];
                const salesData = [];
                const rentData = [];
                
                rows.forEach((row, index) => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 3) {
                        const date = cells[0].textContent.trim();
                        const salesPriceText = cells[1].textContent.trim();
                        const rentPriceText = cells[2].textContent.trim();
                        
                        // Extract numeric values from price text
                        const salesPrice = parseFloat(salesPriceText.replace(/[^\d.,]/g, '').replace(',', '.'));
                        const rentPrice = parseFloat(rentPriceText.replace(/[^\d.,]/g, '').replace(',', '.'));
                        
                        console.log(`Row ${index}: Date=${date}, Sales=${salesPriceText}->${salesPrice}, Rent=${rentPriceText}->${rentPrice}`);
                        
                        if (date && !isNaN(salesPrice) && !isNaN(rentPrice)) {
                            labels.push(date);
                            salesData.push(salesPrice);
                            rentData.push(rentPrice);
                        }
                    }
                });
                
                console.log(`‚úÖ Extracted forecast data: ${labels.length} labels, ${salesData.length} sales, ${rentData.length} rent`);
                
                if (labels.length === 0) {
                    console.log('‚ö†Ô∏è No valid forecast data extracted from table');
                    return null;
                }
                
                return {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: '–ü—Ä–æ–≥–Ω–æ–∑ –ø—Ä–æ–¥–∞–∂–∏ (‚Ç∫/–º¬≤)',
                                data: salesData,
                                borderColor: '#3498db',
                                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                tension: 0.4,
                                borderWidth: 3,
                                fill: false
                            },
                            {
                                label: '–ü—Ä–æ–≥–Ω–æ–∑ –∞—Ä–µ–Ω–¥—ã (‚Ç∫/–º¬≤)',
                                data: rentData,
                                borderColor: '#e74c3c',
                                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                tension: 0.4,
                                borderWidth: 3,
                                fill: false
                            }
                        ]
                    },
                    options: {}
                };
            } catch (error) {
                console.log('‚ùå Error extracting forecast data from table:', error);
                return null;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ (–∫–æ–ø–∏–∏ –∏–∑ app.py)
        function restoreCharts() {
            console.log('üîß Starting chart restoration...');
            
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ canvas —ç–ª–µ–º–µ–Ω—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤
            const canvasElements = document.querySelectorAll('canvas[data-chart-data]');
            console.log(`üìä Found ${canvasElements.length} canvas elements to restore`);
            
            canvasElements.forEach((canvas, index) => {
                console.log(`üîç Processing canvas ${index + 1}: ${canvas.id}`);
                
                try {
                    const chartData = JSON.parse(canvas.getAttribute('data-chart-data'));
                    const chartType = canvas.getAttribute('data-chart-type') || 'line';
                    const chartId = canvas.getAttribute('data-chart-id') || 'chart';
                    
                    console.log(`üìä Chart data for ${canvas.id}:`, chartData);
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
                    if (chartData && chartData.data && chartData.data.labels && chartData.data.labels.length > 0) {
                        console.log(`‚úÖ Full chart data found for ${canvas.id}, creating chart...`);
                        createChartFromData(canvas, chartData, chartType, chartId);
                    } else {
                        console.log(`‚ö†Ô∏è Incomplete chart data for ${canvas.id}, trying to create from table...`);
                        createChartFromTable(canvas, chartId);
                    }
                } catch (error) {
                    console.error(`‚ùå Error processing ${canvas.id}:`, error);
                    // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
                    try {
                        const chartId = canvas.getAttribute('data-chart-id') || 'chart';
                        createChartFromTable(canvas, chartId);
                    } catch (fallbackError) {
                        console.error(`‚ùå Fallback also failed for ${canvas.id}:`, fallbackError);
                        showChartPlaceholder(canvas);
                    }
                }
            });
        }
        
        function createChartFromData(canvas, chartData, chartType, chartId) {
            const ctx = canvas.getContext('2d');
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            new Chart(ctx, {
                type: chartType,
                data: chartData.data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 12 },
                                color: '#2c3e50'
                            }
                        },
                        title: {
                            display: true,
                            text: getChartTitle(chartId),
                            color: '#2c3e50',
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#e9ecef' },
                            ticks: { color: '#6c757d', font: { size: 11 } }
                        },
                        y: {
                            grid: { color: '#e9ecef' },
                            ticks: { color: '#6c757d', font: { size: 11 } }
                        }
                    }
                }
            });
            
            console.log(`‚úÖ Chart created from data for ${chartId}`);
        }
        
        function createChartFromTable(canvas, chartId) {
            console.log(`üîç Creating chart from table for ${chartId}`);
            
            let chartData = null;
            
            if (chartId === 'trendsChart') {
                chartData = extractDataFromTrendsTable();
            } else if (chartId === 'forecastChart') {
                chartData = extractDataFromForecastTable();
            }
            
            if (chartData && chartData.data && chartData.data.labels && chartData.data.labels.length > 0) {
                console.log(`‚úÖ Table data extracted for ${chartId}:`, chartData);
                createChartFromData(canvas, chartData, chartData.type, chartId);
            } else {
                console.log(`‚ö†Ô∏è No table data found for ${chartId}, showing placeholder`);
                showChartPlaceholder(canvas);
            }
        }
        
        function getChartTitle(chartId) {
            const titles = {
                'trendsChart': '–ì—Ä–∞—Ñ–∏–∫ —Ç—Ä–µ–Ω–¥–æ–≤ —Ü–µ–Ω –Ω–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å',
                'forecastChart': '–ü—Ä–æ–≥–Ω–æ–∑ —Ü–µ–Ω –Ω–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å',
                'priceChart': '–î–∏–Ω–∞–º–∏–∫–∞ —Ü–µ–Ω',
                'default': '–ì—Ä–∞—Ñ–∏–∫ –¥–∞–Ω–Ω—ã—Ö'
            };
            return titles[chartId] || titles['default'];
        }
        
        function showChartPlaceholder(canvas) {
            const placeholder = document.createElement('div');
            placeholder.className = 'chart-placeholder';
            placeholder.innerHTML = `
                <div style="font-size: 16px; font-weight: 600; margin-bottom: 10px;">
                    üìä –ì—Ä–∞—Ñ–∏–∫ –¥–∞–Ω–Ω—ã—Ö
                </div>
                <div style="font-size: 13px; color: #6c757d;">
                    –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö –≤—ã—à–µ
                </div>
            `;
            canvas.parentNode.replaceChild(placeholder, canvas);
        }
    </script>
</body>
</html>
