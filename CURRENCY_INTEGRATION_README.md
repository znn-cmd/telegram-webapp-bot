# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–∞–ª—é—Ç–Ω—ã–º–∏ –∫—É—Ä—Å–∞–º–∏

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å –≤–∞–ª—é—Ç–Ω—ã–º–∏ –∫—É—Ä—Å–∞–º–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ç—É—Ä–µ—Ü–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –µ–≤—Ä–æ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ—Ç—á–µ—Ç–æ–≤. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –≤–∞–ª—é—Ç—ã –≤ –æ—Ç—á–µ—Ç–∞—Ö –∏ —É–ø—Ä–æ—â–∞–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. –¢–∞–±–ª–∏—Ü–∞ `currency` –≤ Supabase

–¢–∞–±–ª–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ EUR (–±–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞):

```sql
CREATE TABLE currency (
    id SERIAL PRIMARY KEY,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    rub NUMERIC,  -- –†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å
    usd NUMERIC,  -- –î–æ–ª–ª–∞—Ä –°–®–ê
    euro NUMERIC DEFAULT 1.0,  -- –ï–≤—Ä–æ (–±–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞)
    try NUMERIC,  -- –¢—É—Ä–µ—Ü–∫–∞—è –ª–∏—Ä–∞
    aed NUMERIC,  -- –î–∏—Ä—Ö–∞–º –û–ê–≠
    thb NUMERIC   -- –¢–∞–π—Å–∫–∏–π –±–∞—Ç
);
```

### 2. API CurrencyLayer.com

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç:
- **API –∫–ª—é—á**: `c61dddb55d93e77ce5a2c8b91fb22694`
- **–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞**: EUR
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤–∞–ª—é—Ç—ã**: RUB, USD, TRY, AED, THB

## –§—É–Ω–∫—Ü–∏–∏

### `get_currency_rate_for_date(target_date=None)`

–ü–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å –≤–∞–ª—é—Ç—ã –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∞—Ç—ã:

1. **–ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**: –ò—â–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `currency` –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
2. **API –∑–∞–ø—Ä–æ—Å**: –ï—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç, –ø–æ–ª—É—á–∞–µ—Ç —Å currencylayer.com
3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∫—É—Ä—Å—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `target_date` (datetime): –î–∞—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ–≥–æ–¥–Ω—è)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `dict`: –°–ª–æ–≤–∞—Ä—å —Å –∫—É—Ä—Å–∞–º–∏ –≤–∞–ª—é—Ç –∏–ª–∏ `None` –µ—Å–ª–∏ –æ—à–∏–±–∫–∞

### `fetch_and_save_currency_rates(target_date=None)`

–ü–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç —Å currencylayer.com –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –±–∞–∑—É:

1. **API –∑–∞–ø—Ä–æ—Å**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ currencylayer.com
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞**: –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –∏–∑ –æ—Ç–≤–µ—Ç–∞
3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É `currency`

### `convert_turkish_data_to_eur(data, currency_rate)`

–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ç—É—Ä–µ—Ü–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –µ–≤—Ä–æ:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É—Ä—Å–∞**: –£–±–µ–∂–¥–∞–µ—Ç—Å—è, —á—Ç–æ –∫—É—Ä—Å –≤–∞–ª—é—Ç—ã –¥–æ—Å—Ç—É–ø–µ–Ω
2. **–†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è**: –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–º —á–∏—Å–ª–æ–≤—ã–º –ø–æ–ª—è–º
3. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ü–µ–Ω**: –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∫—É—Ä—Å TRY/EUR –∫ —Ü–µ–Ω–æ–≤—ã–º –ø–æ–ª—è–º

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–æ–ª—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:**
- `unit_price_for_sale` - —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –º¬≤
- `min_unit_price_for_sale` - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –º¬≤
- `max_unit_price_for_sale` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –º¬≤
- `unit_price_for_rent` - —Ü–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã –∑–∞ –º¬≤
- `min_unit_price_for_rent` - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã –∑–∞ –º¬≤
- `max_unit_price_for_rent` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã –∑–∞ –º¬≤
- `price_for_sale` - —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏
- `price_for_rent` - —Ü–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã

### `is_turkish_location(location_components)`

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ª–æ–∫–∞—Ü–∏—è –≤ –¢—É—Ä—Ü–∏–∏:

**–¢—É—Ä–µ—Ü–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
- `turkey`, `t√ºrkiye`, `tr`, `tur`

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –æ—Ç—á–µ—Ç—ã

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—É—Ä–µ—Ü–∫–æ–π –ª–æ–∫–∞—Ü–∏–∏

–ü—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞ —Å–∏—Å—Ç–µ–º–∞:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ª–æ–∫–∞—Ü–∏–∏
2. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ª–æ–∫–∞—Ü–∏—è —Ç—É—Ä–µ—Ü–∫–æ–π
3. –ï—Å–ª–∏ –¥–∞ - –ø–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å –≤–∞–ª—é—Ç—ã –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ

### 2. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –æ—Ç—á–µ—Ç–µ

–î–ª—è —Ç—É—Ä–µ—Ü–∫–∏—Ö –ª–æ–∫–∞—Ü–∏–π –≤ –æ—Ç—á–µ—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è:
```
–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞: 19.07.2025 17:01
–ö—É—Ä—Å –≤–∞–ª—é—Ç—ã TRY/EUR: 46.8977
```

### 3. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ –µ–≤—Ä–æ:
- `property_trends`
- `floor_segment_data`
- `general_data`
- `heating_data`
- `house_type_data`

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
from currency_functions import (
    get_currency_rate_for_date,
    convert_turkish_data_to_eur,
    is_turkish_location
)

# –ü–æ–ª—É—á–∞–µ–º –∫—É—Ä—Å –≤–∞–ª—é—Ç—ã
currency_rate = get_currency_rate_for_date()

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç—É—Ä–µ—Ü–∫—É—é –ª–æ–∫–∞—Ü–∏—é
location_components = {
    'country': 'Turkey',
    'country_code': 'TR'
}
is_turkish = is_turkish_location(location_components)

# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
if is_turkish and currency_rate:
    market_data = convert_turkish_data_to_eur(market_data, currency_rate)
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:

```bash
python test_currency_integration.py
```

–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—É—Ä–µ—Ü–∫–æ–π –ª–æ–∫–∞—Ü–∏–∏
3. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –≤ –µ–≤—Ä–æ
4. –†–∞–±–æ—Ç—É —Å API currencylayer.com

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –≤–µ–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:
- `‚úÖ` - —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `‚ùå` - –æ—à–∏–±–∫–∏
- `üîç` - –ø–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö
- `üíæ` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `üí±` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç
- `üáπüá∑` - —Ç—É—Ä–µ—Ü–∫–∞—è –ª–æ–∫–∞—Ü–∏—è

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å –∫ API
2. **–û—à–∏–±–∫–∞ API**: –í–æ–∑–≤—Ä–∞—Ç –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
3. **–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫—É—Ä—Å**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
4. **–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏**: Graceful degradation

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- API –∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫–æ–¥–µ (—Å–æ–≥–ª–∞—Å–Ω–æ –ø–æ–ª–∏—Ç–∏–∫–µ –ø—Ä–æ–µ–∫—Ç–∞)
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –±–µ–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
- –î–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Å–±–æ—è—Ö –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
