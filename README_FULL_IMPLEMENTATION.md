# Aaadviser - Полная реализация

## Описание проекта

Telegram бот с WebApp для анализа недвижимости в Анталии, Турция. Проект включает полную функциональность для генерации отчетов, работы с макроэкономическими данными, создания PDF и отправки клиентам.

## Реализованные функции

### 1. WebApp интерфейс
- ✅ Форма ввода адреса, количества спален и цены
- ✅ После генерации отчета показывается информация о недвижимости (адрес, спальни, цена)
- ✅ Кнопки "В главное меню" и "Копировать в буфер" на одном уровне
- ✅ Кнопка "Получить полный отчет" ниже основных кнопок

### 2. Полный отчет ($1)
- ✅ Проверка баланса пользователя
- ✅ Списание $1 при получении полного отчета
- ✅ Макроэкономические данные (инфляция, курс валют, ставка ЦБ, ВВП)
- ✅ Финансовые показатели (депозиты, облигации, акции, фонды недвижимости)
- ✅ Региональные показатели Анталии
- ✅ Налоговая информация
- ✅ Оценка рисков
- ✅ Инвестиционный анализ
- ✅ Рекомендации

### 3. PDF функциональность
- ✅ Генерация PDF отчета
- ✅ Скачивание PDF
- ✅ Форма для клиента (имя, Telegram username)
- ✅ Настройки включения разделов в PDF
- ✅ Автоматическое появление кнопки отправки клиенту после скачивания

### 4. Backend API
- ✅ `/api/generate_report` - генерация базового отчета
- ✅ `/api/full_report` - полный отчет с проверкой баланса
- ✅ `/api/generate_pdf_report` - генерация PDF
- ✅ `/api/download_pdf` - скачивание PDF
- ✅ `/api/send_pdf_to_client` - отправка клиенту
- ✅ `/api/user_balance` - проверка баланса
- ✅ `/api/user` - работа с пользователями

### 5. Внешние API интеграции
- ✅ Trading Economics API для макроэкономических данных
- ✅ Yahoo Finance для финансовых данных
- ✅ Симуляция региональных данных Анталии
- ✅ Расчет налогов и рисков

## Установка и запуск

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Настройка переменных окружения
Создайте файл `.env`:
```
SUPABASE_URL=your_supabase_url
SUPABASE_KEY=your_supabase_key
TELEGRAM_BOT_TOKEN=your_bot_token
TRADING_ECONOMICS_API_KEY=your_api_key
WORLD_BANK_API_KEY=your_api_key
```

### 3. Запуск сервера
```bash
python app.py
```

## Структура базы данных

### Таблицы Supabase:
- `users` - пользователи бота
- `user_balance` - баланс пользователей
- `user_reports` - отчеты пользователей
- `user_objects` - сохраненные объекты
- `client_contacts` - контакты клиентов
- `short_term_rentals` - краткосрочная аренда
- `long_term_rentals` - долгосрочная аренда
- `property_sales` - продажи недвижимости
- `market_statistics` - статистика рынка
- `historical_prices` - исторические цены

## API Endpoints

### Основные endpoints:
- `POST /api/generate_report` - генерация базового отчета
- `POST /api/full_report` - полный отчет с макроэкономическими данными
- `POST /api/generate_pdf_report` - генерация PDF
- `POST /api/download_pdf` - скачивание PDF
- `POST /api/send_pdf_to_client` - отправка клиенту
- `POST /api/user_balance` - проверка баланса

### Параметры запросов:
```json
{
  "telegram_id": "123456789",
  "address": "Antalya, Turkey",
  "bedrooms": 2,
  "price_usd": 150000,
  "client_name": "Иван Иванов",
  "client_telegram": "@ivan_client"
}
```

## Функции макроэкономических данных

### 1. Макроэкономические показатели
- Инфляция в Турции
- Курс USD/TRY
- Ставка Центрального банка
- Рост ВВП

### 2. Финансовые показатели
- Банковские депозиты (TRY, USD, EUR)
- Государственные облигации
- Акции турецких компаний
- Фонды недвижимости

### 3. Региональные показатели Анталии
- Население и рост ВВП
- Уровень безработицы
- Рост туризма
- Инвестиции в инфраструктуру
- Рост цен на недвижимость
- Доходность аренды

### 4. Налоговая информация
- Налог на недвижимость
- Налог на доходы
- Налог на прирост капитала
- Пошлины при покупке
- Нотариальные услуги

### 5. Оценка рисков
- Валютный риск
- Политический риск
- Экономический риск
- Рыночный риск
- Ликвидность
- Регуляторный риск

## WebApp интерфейс

### Экраны:
1. **Начальный экран** - форма ввода данных
2. **Экран загрузки** - анимация загрузки
3. **Результат** - информация о недвижимости + кнопки
4. **Полный отчет** - детальный анализ + PDF
5. **Модальное окно клиента** - форма для отправки

### Кнопки:
- "Генерация отчета" - создание базового отчета
- "В главное меню" - возврат к началу
- "Копировать в буфер" - копирование информации
- "Получить полный отчет" - полный анализ ($1)
- "Скачать PDF" - генерация и скачивание PDF
- "Отправить клиенту" - отправка через Telegram

## Безопасность

- Проверка баланса перед генерацией полного отчета
- Валидация входных данных
- Обработка ошибок и логирование
- Безопасное хранение API ключей

## Развертывание

### Amvera (рекомендуется):
1. Подключите GitHub репозиторий
2. Настройте переменные окружения
3. Деплой автоматический при push

### Локальный запуск:
```bash
python app.py
```

## Мониторинг

- Логирование всех операций
- Отслеживание ошибок
- Мониторинг балансов пользователей
- Статистика использования

## Дальнейшее развитие

1. Интеграция с дополнительными API
2. Расширенная аналитика
3. Уведомления пользователей
4. Многоязычная поддержка
5. Мобильное приложение

## Поддержка

Для вопросов и поддержки обращайтесь к разработчику. 