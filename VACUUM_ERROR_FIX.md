# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ VACUUM

## –ü—Ä–æ–±–ª–µ–º–∞
```
ERROR: 25001: VACUUM cannot run inside a transaction block
```

## –ü—Ä–∏—á–∏–Ω–∞
–ö–æ–º–∞–Ω–¥—ã `VACUUM ANALYZE` –Ω–µ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ PostgreSQL.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –°–ø–æ—Å–æ–± 1: –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –æ—Ç–¥–µ–ª—å–Ω–æ

1. **–°–æ–∑–¥–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã:**
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ `create_new_indexes.sql` –≤ Supabase Dashboard

2. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—Ç–¥–µ–ª—å–Ω–æ:**
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ `update_statistics.sql` –≤ Supabase Dashboard

### –°–ø–æ—Å–æ–± 2: –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –ø–æ –æ–¥–Ω–æ–π

–í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ:

```sql
-- –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –≤—Å–µ –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX IF NOT EXISTS idx_users_status ON users(user_status);
CREATE INDEX IF NOT EXISTS idx_users_telegram_status ON users(telegram_id, user_status);
-- ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

-- –ó–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
VACUUM ANALYZE users;
VACUUM ANALYZE locations;
```

### –°–ø–æ—Å–æ–± 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Python —Å–∫—Ä–∏–ø—Ç

```bash
python create_indexes.py
```

## üìã –ß—Ç–æ –¥–µ–ª–∞—Ç—å

1. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ `create_new_indexes.sql`** - —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã
2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ `update_statistics.sql`** - –æ–±–Ω–æ–≤–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ë–î
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç** - –∏–Ω–¥–µ–∫—Å—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ

## ‚ö° –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –ò–Ω–¥–µ–∫—Å—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î –æ–±–Ω–æ–≤–∏—Ç—Å—è
- –ó–∞–ø—Ä–æ—Å—ã —Å—Ç–∞–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ –≤ 5-50 —Ä–∞–∑

---

**–í–∞–∂–Ω–æ**: –ö–æ–º–∞–Ω–¥—ã `VACUUM ANALYZE` –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤!
