# üí∞ –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤

## üéØ –û–±–∑–æ—Ä –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ –Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ **–±–∞–∑–æ–≤—ã—Ö —Ü–µ–Ω–∞—Ö –∏–∑ 4 —Ç–∞–±–ª–∏—Ü** –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞ –∏ **–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º—É–ª–∞—Ö** –¥–ª—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –∏ –±—É–¥—É—â–∏—Ö –ø–µ—Ä–∏–æ–¥–æ–≤.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### **Backend: API `/api/base_prices`**
–ù–æ–≤—ã–π endpoint –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ 4 —Ç–∞–±–ª–∏—Ü –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã:

```python
# –¢–∞–±–ª–∏—Ü—ã –∏—Å—Ç–æ—á–Ω–∏–∫–∏
tables = ['age_data', 'floor_segment_data', 'heating_data', 'house_type_data']

# –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞
for table in tables:
    min_prices.append(avg(table.min_unit_price_for_sale))
    max_prices.append(avg(table.max_unit_price_for_sale))

# –§–∏–Ω–∞–ª—å–Ω–∞—è –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞
base_sale_price = (avg(min_prices) + avg(max_prices)) / 2
```

### **Frontend: –§—É–Ω–∫—Ü–∏—è `prepareTrendsWithHistoricalPrices()`**
–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å 3 —Ç–∏–ø–∞–º–∏ —Ä–∞—Å—á–µ—Ç–æ–≤:

1. **–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü**: –ë–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã –∏–∑ 4 —Ç–∞–±–ª–∏—Ü
2. **–ë—É–¥—É—â–∏–µ –º–µ—Å—è—Ü—ã**: –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç
3. **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –º–µ—Å—è—Ü—ã**: –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç

---

## üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–æ–≤

### **1Ô∏è‚É£ –¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü (–∞–≤–≥—É—Å—Ç 2025)**

#### **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:**
```javascript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ü–µ–Ω –∏–∑ 4 —Ç–∞–±–ª–∏—Ü
const basePrices = await getBasePricesFromTables();

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
if (isCurrentMonth) {
    priceCache.set(cacheKey, {
        salePrice: basePrices.sale_price,    // –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞
        rentPrice: basePrices.rent_price,    // –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞
        isCalculated: true                   // –ü–æ–º–µ—á–µ–Ω–æ –∫–∞–∫ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–µ
    });
}
```

#### **–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω—ã:**
```
–ë–∞–∑–æ–≤–∞—è_—Ü–µ–Ω–∞ = (–°—Ä–µ–¥–Ω–µ–µ_MIN_–∏–∑_4_—Ç–∞–±–ª–∏—Ü + –°—Ä–µ–¥–Ω–µ–µ_MAX_–∏–∑_4_—Ç–∞–±–ª–∏—Ü) √∑ 2

–≥–¥–µ:
- age_data.min_unit_price_for_sale/rent ‚Üí avg
- floor_segment_data.min_unit_price_for_sale/rent ‚Üí avg  
- heating_data.min_unit_price_for_sale/rent ‚Üí avg
- house_type_data.min_unit_price_for_sale/rent ‚Üí avg
```

---

### **2Ô∏è‚É£ –ë—É–¥—É—â–∏–µ –º–µ—Å—è—Ü—ã (—Å–µ–Ω—Ç—è–±—Ä—å 2025+)**

#### **–ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞:**
```javascript
function calculateFuturePrice(previousPrice, changePercent) {
    return previousPrice * (1 + changePercent);
}

// –ü—Ä–∏–º–µ—Ä:
// –ê–≤–≥—É—Å—Ç 2025: ‚Ç∫61,803.00 (–±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞)
// –ü—Ä–æ—Ü–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ–Ω—Ç—è–±—Ä—è: +2.25%
// –°–µ–Ω—Ç—è–±—Ä—å 2025 = 61,803 √ó (1 + 0.0225) = ‚Ç∫63,193.17
```

#### **–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:**
```javascript
if (isFutureMonth) {
    const prevMonthData = priceCache.get(prevMonthKey);
    if (prevMonthData && trend.price_change_sale) {
        calculatedSalePrice = calculateFuturePrice(
            prevMonthData.salePrice, 
            trend.price_change_sale
        );
    }
}
```

---

### **3Ô∏è‚É£ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –º–µ—Å—è—Ü—ã (—Ñ–µ–≤—Ä–∞–ª—å-–∏—é–ª—å 2025)**

#### **–†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞:**
```javascript
function calculateHistoricalPrice(nextMonthPrice, changePercent) {
    return nextMonthPrice / (1 + changePercent);
}

// –ü—Ä–∏–º–µ—Ä:
// –ê–≤–≥—É—Å—Ç 2025: ‚Ç∫61,803.00 (–±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞)
// –ü—Ä–æ—Ü–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤–≥—É—Å—Ç–∞: +1.66%
// –ò—é–ª—å 2025 = 61,803 √∑ (1 + 0.0166) = ‚Ç∫60,787.33
```

#### **–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:**
```javascript
if (isHistoricalMonth) {
    const nextMonthData = priceCache.get(nextMonthKey);
    if (nextMonthData && trend.price_change_sale) {
        calculatedSalePrice = calculateHistoricalPrice(
            nextMonthData.salePrice, 
            trend.price_change_sale
        );
    }
}
```

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–æ –≤—Å–µ –±–ª–æ–∫–∏

### **‚úÖ –ë–ª–æ–∫ "–¢—Ä–µ–Ω–¥ —Ü–µ–Ω" (–ó–µ–ª–µ–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞)**

**–û–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- –§—É–Ω–∫—Ü–∏—è `addPropertyTrendsSection()` –ø–æ–ª—É—á–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã
- –î–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É –≤–º–µ—Å—Ç–æ `trend_value`
- –ü—Ä–æ—Ü–µ–Ω—Ç—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è –∏–∑ –ë–î

```javascript
// –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
let displayValue = currentTrend.trend_value;
if (basePrices && type === 'price_trend') {
    displayValue = basePrices.sale_price; // –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏
}
```

### **‚úÖ –¢–∞–±–ª–∏—Ü–∞ "–î–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–¥–æ–≤"**

**–û–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- –§—É–Ω–∫—Ü–∏—è `generateTrendsTable()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `await prepareTrendsWithHistoricalPrices()`
- –í—Å–µ —Ü–µ–Ω—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ
- –¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü: –±–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã (–ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ calculated)
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ: —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç
- –ë—É–¥—É—â–∏–µ: –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç

### **‚úÖ –¢–∞–±–ª–∏—Ü–∞ "–ü—Ä–æ–≥–Ω–æ–∑ —Ü–µ–Ω—ã –∏ –∞—Ä–µ–Ω–¥—ã"**

**–û–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- –§—É–Ω–∫—Ü–∏—è `generateForecastTable()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `await prepareTrendsWithHistoricalPrices()`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –º–µ—Å—è—Ü–µ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `calculated_sale_price` –≤–º–µ—Å—Ç–æ `unit_price_for_sale`

---

## üõ°Ô∏è Fallback-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è

–ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∞–∑–æ–≤—ã—Ö —Ü–µ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞**:

```javascript
try {
    basePrices = await getBasePricesFromTables();
} catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö —Ü–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback:', error);
    return prepareTrendsWithOriginalLogic(trends);
}
```

**Fallback —Ñ—É–Ω–∫—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `property_trends` –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—è—Ü–µ–≤
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø—Ä–∏ –ª—é–±—ã—Ö –æ—à–∏–±–∫–∞—Ö

---

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏

| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ | –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ |
|--------|---------------|--------------|
| **–ë–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã** | –ò–∑ `property_trends` | –ò–∑ 4 —Ä—ã–Ω–æ—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü |
| **–¢–æ—á–Ω–æ—Å—Ç—å** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è | –í—ã—Å–æ–∫–∞—è (–º–Ω–æ–≥–æ–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ) |
| **–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü** | –ü—Ä—è–º–æ –∏–∑ –ë–î | –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã |
| **–ë—É–¥—É—â–∏–µ –º–µ—Å—è—Ü—ã** | –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å | –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç |
| **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ** | –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç | –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑–æ–≤—ã—Ö —Ü–µ–Ω |
| **Fallback** | –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª | –ü–æ–ª–Ω–∞—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ |

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

1. **Backend:**
   - `api_base_prices()` - –Ω–æ–≤—ã–π endpoint
   - –ó–∞–ø—Ä–æ—Å—ã –∫ 4 —Ç–∞–±–ª–∏—Ü–∞–º —Å –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π

2. **Frontend:**
   - `prepareTrendsWithHistoricalPrices()` - async, –Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
   - `getBasePricesFromTables()` - –∑–∞–ø—Ä–æ—Å –±–∞–∑–æ–≤—ã—Ö —Ü–µ–Ω
   - `calculateFuturePrice()` - –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç
   - `prepareTrendsWithOriginalLogic()` - fallback
   - `addPropertyTrendsSection()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –±–∞–∑–æ–≤—ã—Ö —Ü–µ–Ω

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**

```javascript
console.log('üí∞ –ë–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã –ø–æ–ª—É—á–µ–Ω—ã:', basePrices);
console.log('üöÄ –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è 2025-9: –ø—Ä–æ–¥–∞–∂–∞ 63193.17 ‚Ç∫/–º¬≤');
console.log('‚è™ –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è 2025-7: –ø—Ä–æ–¥–∞–∂–∞ 60787.33 ‚Ç∫/–º¬≤');
```

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:**
- ‚úÖ –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- ‚úÖ –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã –¥–ª—è –≤—Å–µ—Ö –ø–µ—Ä–∏–æ–¥–æ–≤  
- ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤–æ –≤—Å–µ—Ö –±–ª–æ–∫–∞—Ö –æ—Ç—á–µ—Ç–∞
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ fallback-–ª–æ–≥–∏–∫—É
- ‚úÖ –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

**–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –±–ª–æ–∫–∏ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—É—é, —Ç–æ—á–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω! üöÄ**
