# Обновление системы именования файлов отчетов

## Описание изменений

Обновлена механика сохранения отчетов при анализе объекта. Теперь все файлы отчетов именуются только цифрами с уникальным кодом.

## Что изменилось

### Старая система именования:
- HTML файлы: `Аналитический_отчет_по_недвижимости_{локация}_{время}.html`
- PDF файлы: `report_{report_id}.pdf`

### Новая система именования:
- HTML файлы: `{12-значный_код}.html`
- PDF файлы: `{12-значный_код}.pdf`

## Примеры

### Старые имена файлов:
```
Аналитический_отчет_по_недвижимости_Türkiye_Antalya_Alanya_Mahmutlar_20241201_143022.html
report_12345.pdf
```

### Новые имена файлов:
```
123456789012.html
987654321098.pdf
```

## Преимущества новой системы

1. **Короткие имена файлов** - 12 цифр + расширение
2. **Только цифры** - без специальных символов и пробелов
3. **Уникальность** - каждый файл получает уникальный код
4. **Совместимость** - работает с любой файловой системой
5. **Безопасность** - не раскрывает информацию о содержимом

## Измененные функции

### 1. `api_save_html_report()` (строка ~4974)
- **Файл**: `app.py`
- **Изменение**: Генерация имени HTML файла
- **Код**: 
```python
# Старый код
filename = f"Аналитический_отчет_по_недвижимости_{safe_location}_{timestamp}.html"

# Новый код
file_id = ''.join(random.choices(string.digits, k=12))
filename = f"{file_id}.html"
```

### 2. `api_generate_pdf_report()` (строка ~4708)
- **Файл**: `app.py`
- **Изменение**: Генерация имени PDF файла
- **Код**:
```python
# Старый код
final_pdf_name = f'report_{report_id}.pdf'

# Новый код
file_id = ''.join(random.choices(string.digits, k=12))
final_pdf_name = f'{file_id}.pdf'
```

### 3. `api_send_saved_report_pdf()` (строка ~6568)
- **Файл**: `app.py`
- **Изменение**: Генерация имени PDF файла для сохраненных отчетов
- **Код**:
```python
# Старый код
final_pdf_name = f'report_{report_id}.pdf'

# Новый код
file_id = ''.join(random.choices(string.digits, k=12))
final_pdf_name = f'{file_id}.pdf'
```

## Алгоритм генерации уникального кода

```python
def generate_unique_file_id():
    """Генерирует уникальный 12-значный числовой код для файла"""
    return ''.join(random.choices(string.digits, k=12))
```

- **Длина кода**: 12 цифр
- **Диапазон**: 000000000000 - 999999999999
- **Возможных комбинаций**: 10^12 = 1 триллион
- **Уникальность**: Гарантирована для практических целей

## Тестирование

Создан тестовый скрипт `test_file_naming.py` для проверки:
- ✅ Генерация HTML имен файлов
- ✅ Генерация PDF имен файлов  
- ✅ Уникальность кодов (100 тестов)
- ✅ Совместимость с файловыми системами

## Совместимость

- ✅ Windows (NTFS, FAT32)
- ✅ Linux (ext4, ext3)
- ✅ macOS (HFS+, APFS)
- ✅ Веб-серверы (Apache, Nginx)
- ✅ Облачные хранилища (AWS S3, Google Cloud Storage)

## Безопасность

Новая система именования обеспечивает:
- **Анонимность** - имена файлов не содержат информации о содержимом
- **Безопасность** - нет уязвимостей через специальные символы
- **Конфиденциальность** - невозможно определить тип отчета по имени файла

## Дата обновления

**Дата**: 1 декабря 2024  
**Версия**: 1.0  
**Статус**: ✅ Реализовано и протестировано
