<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aaadviser - –ú–æ–∏ –æ—Ç—á–µ—Ç—ã</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 40px 20px;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
        }
        .title {
            font-size: 20px;
            font-weight: 700;
            color: #333;
            margin-bottom: 24px;
            text-align: center;
        }
        .report-list {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .report-card {
            background: #f8f9fa;
            border-radius: 14px;
            box-shadow: 0 2px 8px rgba(102,126,234,0.08);
            padding: 18px 14px 14px 14px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .report-address {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 2px;
        }
        .report-meta {
            font-size: 13px;
            color: #555;
        }
        .report-type {
            font-size: 13px;
            color: #764ba2;
            font-weight: 500;
        }
        .btn {
            margin-top: 10px;
            padding: 10px 0;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            transition: background 0.2s;
        }
        .btn:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }
        .back-btn {
            margin-top: 30px;
            background: #f1f1f1;
            color: #333;
            border: 1px solid #ddd;
        }
        .back-btn:hover {
            background: #e2e2e2;
        }
        .loading {
            text-align: center;
            color: #667eea;
            font-size: 16px;
            margin-top: 30px;
        }
        .empty {
            text-align: center;
            color: #888;
            font-size: 15px;
            margin-top: 40px;
        }
        .icon-btn-row {
            display: flex;
            flex-direction: row;
            gap: 12px;
            margin-top: 12px;
            justify-content: flex-start;
        }
        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(102,126,234,0.08);
            position: relative;
        }
        .icon-btn:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            box-shadow: 0 4px 16px rgba(102,126,234,0.18);
        }
        .icon-btn[disabled] {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .icon-btn .tooltip {
            visibility: hidden;
            width: max-content;
            background: #222;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 1;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 13px;
            pointer-events: none;
        }
        .icon-btn:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">Aaadviser</div>
        <div class="title" id="pageTitle">–ú–æ–∏ –æ—Ç—á–µ—Ç—ã</div>
        <div id="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div id="reportList" class="report-list" style="display:none;"></div>
        <div id="empty" style="display:none;text-align:center;color:#888;font-size:18px;margin-top:40px;">
    <span id="emptyText"></span>
</div>
        <button class="btn back-btn" onclick="goToMainMenu()">–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
    </div>
    <script>
        let tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
        if (tg) {
            tg.ready();
            tg.expand();
        }
        let userData = tg && tg.initDataUnsafe && tg.initDataUnsafe.user ? tg.initDataUnsafe.user : null;
        if (!userData) {
            try {
                userData = JSON.parse(localStorage.getItem('aaadviser_user'));
            } catch (e) {
                userData = null;
            }
        }
        // –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å)
        const locales = {
            'ru': {
                'pageTitle': '–ú–æ–∏ –æ—Ç—á–µ—Ç—ã',
                'loading': '–ó–∞–≥—Ä—É–∑–∫–∞...',
                'empty': '–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤, –Ω–∞—á–Ω–∏—Ç–µ —Å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã.',
                'mainMenu': '–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
                'view': '–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å',
                'full': '–ü–æ–ª–Ω—ã–π',
                'market_analysis': '–ë–∞–∑–æ–≤—ã–π',
                'download_pdf': '–°–∫–∞—á–∞—Ç—å PDF',
                'send_to_client': '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É',
                'delete': '–£–¥–∞–ª–∏—Ç—å',
                'update': '–û–±–Ω–æ–≤–∏—Ç—å',
                'confirm_delete': '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç—á–µ—Ç?',
                'confirm_update': '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç—á–µ—Ç? –≠—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç 1$ –∏–∑ –≤–∞—à–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞.',
                'error': '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram WebApp. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.'
            },
            'en': {
                'pageTitle': 'My Reports',
                'loading': 'Loading...',
                'empty': 'You have no saved reports yet. Start by generating your first report and save it for future use.',
                'mainMenu': 'Main menu',
                'view': 'View',
                'full': 'Full',
                'market_analysis': 'Basic',
                'download_pdf': 'Download PDF',
                'send_to_client': 'Send to client',
                'delete': 'Delete',
                'update': 'Update',
                'confirm_delete': 'Are you sure you want to delete this report?',
                'confirm_update': 'Are you sure you want to update this report? This will require 1$ from your balance.',
                'error': 'Telegram WebApp initialization error. Please restart the app.'
            }
        };
        let currentLanguage = 'ru';
        if (userData && userData.language_code && locales[userData.language_code]) {
            currentLanguage = userData.language_code;
        }
        function getText(key) {
            return locales[currentLanguage][key] || key;
        }
        document.getElementById('pageTitle').textContent = getText('pageTitle');
        document.getElementById('loading').textContent = getText('loading');
        document.querySelector('.back-btn').textContent = getText('mainMenu');
        function showEmptyMessage() {
            document.getElementById('emptyText').textContent = getText('empty');
            document.getElementById('empty').style.display = '';
            document.getElementById('reportList').style.display = 'none';
        }
        async function loadReports() {
            if (!userData) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('emptyText').textContent = getText('error');
                document.getElementById('empty').style.display = '';
                return;
            }
            document.getElementById('loading').style.display = '';
            document.getElementById('reportList').style.display = 'none';
            document.getElementById('empty').style.display = 'none';
            try {
                const res = await fetch('/api/user_reports', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ telegram_id: userData.id })
                });
                const data = await res.json();
                if (data.success && data.reports && data.reports.length > 0) {
                    renderReports(data.reports);
                } else {
                    showEmptyMessage();
                    document.getElementById('loading').style.display = 'none';
                }
            } catch (e) {
                showEmptyMessage();
                document.getElementById('loading').style.display = 'none';
            }
            document.getElementById('loading').style.display = 'none';
        }
        function renderReports(reports) {
            const list = document.getElementById('reportList');
            list.innerHTML = '';
            if (!reports || reports.length === 0) {
                showEmptyMessage();
                return;
            }
            document.getElementById('empty').style.display = 'none';
            reports.forEach(r => {
                const card = document.createElement('div');
                card.className = 'report-card';
                const createdAt = new Date(r.created_at);
                const now = new Date();
                const daysAgo = Math.floor((now - createdAt) / (1000*60*60*24));
                const canUpdate = daysAgo > 30;
                card.innerHTML = `
                    <div class="report-address">${r.address || ''}</div>
                    <div class="report-meta">${createdAt.toLocaleString()} | <span class="report-type">${getText(r.report_type) || r.report_type}</span></div>
                    <div class="icon-btn-row">
                        <button class="icon-btn" onclick="viewReport('${r.id || ''}')" title="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å"><span>üëÅÔ∏è<span class='tooltip'>–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</span></span></button>
                        <button class="icon-btn" onclick="downloadPdf('${r.id || ''}')" title="–°–∫–∞—á–∞—Ç—å PDF"><span>‚¨áÔ∏è<span class='tooltip'>–°–∫–∞—á–∞—Ç—å PDF</span></span></button>
                        <button class="icon-btn" onclick="sendToClient('${r.id || ''}')" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É"><span>‚úâÔ∏è<span class='tooltip'>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É</span></span></button>
                        <button class="icon-btn" onclick="confirmDeleteReport('${r.id || ''}')" title="–£–¥–∞–ª–∏—Ç—å"><span>üóëÔ∏è<span class='tooltip'>–£–¥–∞–ª–∏—Ç—å</span></span></button>
                        <button class="icon-btn" onclick="confirmUpdateReport('${r.id || ''}')" ${canUpdate ? '' : 'disabled'} title="–û–±–Ω–æ–≤–∏—Ç—å (1$)"><span>‚ôªÔ∏è<span class='tooltip'>–û–±–Ω–æ–≤–∏—Ç—å (1$)</span></span></button>
                    </div>
                `;
                list.appendChild(card);
            });
            list.style.display = '';
        }
        function goToMainMenu() {
            window.location.href = '/webapp';
        }
        function viewReport(id) {
            // –ü–æ–ª—É—á–∞–µ–º –æ—Ç—á—ë—Ç –ø–æ id –∏–∑ /api/user_reports (–º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ —É–∂–µ –µ—Å—Ç—å)
            fetch('/api/user_reports', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ telegram_id: userData.id })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success && data.reports) {
                    const report = data.reports.find(r => r.id == id);
                    if (report && report.report_type === 'full') {
                        showFullReportModal(report.full_report);
                    } else {
                        alert('–î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞.');
                    }
                }
            });
        }
        // –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞
        function showFullReportModal(report) {
            let oldModal = document.getElementById('full-report-modal');
            if (oldModal) oldModal.remove();
            const modal = document.createElement('div');
            modal.id = 'full-report-modal';
            modal.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);z-index:1000;display:flex;align-items:center;justify-content:center;overflow:auto;';
            modal.innerHTML = `
                <div style="background:#fff;border-radius:18px;box-shadow:0 4px 24px rgba(102,126,234,0.18);padding:32px 18px 24px 18px;max-width:420px;width:96vw;text-align:left;max-height:90vh;overflow-y:auto;">
                    <div id="fullReportContent"></div>
                    <div style='display:flex;gap:10px;margin-top:18px;'>
                        <button class="btn" onclick="exportPdfFlow()">–°–∫–∞—á–∞—Ç—å PDF</button>
                        <button class="btn" onclick="sendPdfToClientFlow()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É</button>
                        <button class="btn back-btn" style="background:#f1f1f1;color:#333;" onclick="saveAndExitFullReport()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤—ã–π—Ç–∏</button>
                    </div>
                    <button class="btn back-btn" style="margin-top:18px;" onclick="closeFullReportModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            document.body.appendChild(modal);
            showFullReport(report, 'fullReportContent');
            window._currentFullReport = report; // –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞/–æ—Ç–ø—Ä–∞–≤–∫–∏
        }
        function closeFullReportModal() {
            let modal = document.getElementById('full-report-modal');
            if (modal) modal.remove();
        }
        // –î—É–±–ª–∏—Ä—É–µ–º showFullReport —Å webapp_real_data.html (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –ª—é–±–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
        function showFullReport(report, containerId) {
            let html = '';
            html += `<div style='font-size:22px;font-weight:800;color:#667eea;margin-bottom:10px;text-align:center;'>–ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –æ–±—ä–µ–∫—Ç—É</div>`;
            html += `<div style='background:#f4f7ff;border-radius:12px;padding:16px 14px 10px 14px;margin-bottom:18px;box-shadow:0 2px 8px rgba(102,126,234,0.08);'>`;
            html += `<div style='font-size:16px;margin-bottom:6px;'><b>–ê–¥—Ä–µ—Å:</b> <span style='color:#333;'>${report.object.address}</span></div>`;
            html += `<div style='font-size:16px;margin-bottom:6px;'><b>–°–ø–∞–ª–µ–Ω:</b> <span style='color:#333;'>${report.object.bedrooms}</span></div>`;
            html += `<div style='font-size:16px;margin-bottom:6px;'><b>–¶–µ–Ω–∞ –æ–±—ä–µ–∫—Ç–∞:</b> <span style='color:#333;'>‚Ç¨${Number(report.object.purchase_price).toLocaleString('ru-RU')}</span></div>`;
            html += `<div style='font-size:16px;margin-bottom:0;'><b>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –∑–∞ –º¬≤:</b> <span style='color:#333;'>‚Ç¨${Number(report.object.avg_price_per_sqm).toLocaleString('ru-RU')}</span></div>`;
            html += `</div>`;
            html += `<div style='background:#f8f9fa;border-radius:12px;padding:14px 12px 10px 12px;margin-bottom:14px;box-shadow:0 2px 8px rgba(102,126,234,0.06);'>`;
            html += `<div style='font-size:17px;font-weight:700;color:#667eea;margin-bottom:8px;'>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (ROI)</div>`;
            html += `<div style='font-size:15px;color:#222;margin-bottom:7px;'>–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∞—è –∞—Ä–µ–Ω–¥–∞: ROI ${report.roi.short_term.roi}%<br>–ú–µ—Å—è—á–Ω—ã–π –¥–æ—Ö–æ–¥: ‚Ç¨${report.roi.short_term.monthly_income}, –ß–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥: ‚Ç¨${report.roi.short_term.net_income}, 5 –ª–µ—Ç: ‚Ç¨${report.roi.short_term.five_year_income}, –†–æ—Å—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏: ‚Ç¨${report.roi.short_term.final_value.toLocaleString('ru-RU')}</div>`;
            html += `<div style='font-size:15px;color:#222;margin-bottom:7px;'>–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è –∞—Ä–µ–Ω–¥–∞: ROI ${report.roi.long_term.roi}%<br>–ì–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥: ‚Ç¨${report.roi.long_term.annual_income}, –ß–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥: ‚Ç¨${report.roi.long_term.net_income}, 5 –ª–µ—Ç: ‚Ç¨${report.roi.long_term.five_year_income}, –†–æ—Å—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏: ‚Ç¨${report.roi.long_term.final_value.toLocaleString('ru-RU')}</div>`;
            html += `<div style='font-size:15px;color:#222;margin-bottom:7px;'>–ë–µ–∑ –∞—Ä–µ–Ω–¥—ã (—Ç–æ–ª—å–∫–æ —Ä–æ—Å—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏): ROI ${report.roi.no_rent.roi}%<br>–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ‚Ç¨${report.roi.no_rent.final_value.toLocaleString('ru-RU')}</div>`;
            html += `</div>`;
            html += `<div style='background:#f8f9fa;border-radius:12px;padding:14px 12px 10px 12px;margin-bottom:14px;box-shadow:0 2px 8px rgba(102,126,234,0.06);'>`;
            html += `<div style='font-size:17px;font-weight:700;color:#667eea;margin-bottom:8px;'>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏ (5 –ª–µ—Ç)</div>`;
            html += `<table style='width:100%;font-size:14px;margin-bottom:7px;'><tr><th style='text-align:left;'>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</th><th style='text-align:right;'>–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å</th></tr>`;
            report.alternatives.forEach(alt => {
                html += `<tr><td>${alt.name}</td><td style='text-align:right;'>${(alt.yield*100).toFixed(1)}%</td></tr>`;
            });
            html += `</table></div>`;
            html += `<div style='background:#f8f9fa;border-radius:12px;padding:14px 12px 10px 12px;margin-bottom:14px;box-shadow:0 2px 8px rgba(102,126,234,0.06);'>`;
            html += `<div style='font-size:17px;font-weight:700;color:#667eea;margin-bottom:8px;'>–ú–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏–∫–∞</div>`;
            html += `<div style='font-size:15px;color:#222;margin-bottom:7px;'>–ò–Ω—Ñ–ª—è—Ü–∏—è: ${report.macro.inflation}%<br>–ö—É—Ä—Å EUR/TRY: ${report.macro.eur_try} (${(report.macro.eur_try_growth*100).toFixed(1)}% –∑–∞ –≥–æ–¥)<br>–ö–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞: ${report.macro.refi_rate}%<br>–†–æ—Å—Ç –í–í–ü: ${report.macro.gdp_growth}%</div>`;
            html += `</div>`;
            html += `<div style='background:#f8f9fa;border-radius:12px;padding:14px 12px 10px 12px;margin-bottom:14px;box-shadow:0 2px 8px rgba(102,126,234,0.06);'>`;
            html += `<div style='font-size:17px;font-weight:700;color:#667eea;margin-bottom:8px;'>–ù–∞–ª–æ–≥–∏ –∏ —Å–±–æ—Ä—ã</div>`;
            html += `<div style='font-size:15px;color:#222;margin-bottom:7px;'>–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ: –Ω–∞–ª–æ–≥ –Ω–∞ –ø–µ—Ä–µ–≤–æ–¥ ${report.taxes.transfer_tax*100}%<br>–ì–µ—Ä–±–æ–≤—ã–π —Å–±–æ—Ä: ${report.taxes.stamp_duty*100}%<br>–ù–æ—Ç–∞—Ä–∏—É—Å: ‚Ç¨${report.taxes.notary}</div>`;
            html += `<div style='font-size:15px;color:#222;margin-bottom:7px;'>–ï–∂–µ–≥–æ–¥–Ω–æ: –Ω–∞–ª–æ–≥ –Ω–∞ –∏–º—É—â–µ—Å—Ç–≤–æ ${report.taxes.annual_property_tax*100}% - ${report.taxes.annual_property_tax_max*100}%<br>–ü–æ–¥–æ—Ö–æ–¥–Ω—ã–π –Ω–∞–ª–æ–≥ —Å –∞—Ä–µ–Ω–¥—ã: ${report.taxes.rental_income_tax}</div>`;
            html += `<div style='font-size:15px;color:#222;margin-bottom:7px;'>–ü—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ: –Ω–∞–ª–æ–≥ –Ω–∞ –ø—Ä–∏—Ä–æ—Å—Ç: ${report.taxes.capital_gains_tax}</div>`;
            html += `</div>`;
            html += `<div style='background:#f8f9fa;border-radius:12px;padding:14px 12px 10px 12px;margin-bottom:14px;box-shadow:0 2px 8px rgba(102,126,234,0.06);'>`;
            html += `<div style='font-size:17px;font-weight:700;color:#667eea;margin-bottom:8px;'>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏</div>`;
            html += `<div style='font-size:15px;color:#222;margin-bottom:7px;'>Yield: ${(report.yield*100).toFixed(1)}%<br>–ò–Ω–¥–µ–∫—Å —Ü–µ–Ω: ${report.price_index}<br>–ò–ø–æ—Ç–µ—á–Ω–∞—è —Å—Ç–∞–≤–∫–∞: ${(report.mortgage_rate*100).toFixed(1)}%<br>–ì–ª–æ–±–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å —Ü–µ–Ω: ${report.global_house_price_index}</div>`;
            html += `</div>`;
            html += `<div style='background:#f8f9fa;border-radius:12px;padding:14px 12px 10px 12px;margin-bottom:14px;box-shadow:0 2px 8px rgba(102,126,234,0.06);'>`;
            html += `<div style='font-size:17px;font-weight:700;color:#667eea;margin-bottom:8px;'>–†–∏—Å–∫–∏ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ —Ä–∞–π–æ–Ω–∞</div>`;
            html += `<div style='font-size:15px;color:#222;margin-bottom:7px;'>${report.risks.join('<br>')}</div>`;
            html += `<div style='font-size:15px;color:#222;margin-bottom:7px;'>${report.liquidity}</div>`;
            html += `<div style='font-size:15px;color:#222;margin-bottom:7px;'>${report.district}</div>`;
            html += `</div>`;
            html += `<div style='background:#f4f7ff;border-radius:12px;padding:14px 12px 10px 12px;margin-bottom:14px;box-shadow:0 2px 8px rgba(102,126,234,0.06);font-size:15px;color:#222;'>${report.summary}</div>`;
            document.getElementById(containerId).innerHTML = html;
        }
        // –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF: –ø–æ—à–∞–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
        function exportPdfFlow(reportId) {
            if (!reportId) {
                alert('–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å id –æ—Ç—á–µ—Ç–∞ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ PDF!');
                return;
            }
            askAddUserContacts(reportId);
        }

        function askAddUserContacts(reportId) {
            showModalQuestion(
                '–î–æ–±–∞–≤–∏—Ç—å –≤–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ PDF?',
                () => checkAndCollectUserContacts(reportId),
                () => askAddClientData(undefined, reportId)
            );
        }

        function askAddClientData(userProfile, reportId) {
            showModalQuestion(
                '–•–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–∫–ª–∏–µ–Ω—Ç–∞)?',
                () => askClientName(userProfile, reportId),
                () => generatePdfRequest(userProfile, null, reportId)
            );
        }

        function askClientName(userProfile, reportId) {
            showModalInput('–ò–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–∫–ª–∏–µ–Ω—Ç–∞)', (clientName) => {
                generatePdfRequest(userProfile, clientName, reportId);
            });
        }

        function checkAndCollectUserContacts(reportId) {
            // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            fetch('/api/user_profile', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ telegram_id: userData.id })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    const profile = data.profile;
                    const fields = [
                        { key: 'first_name', label: '–ò–º—è' },
                        { key: 'last_name', label: '–§–∞–º–∏–ª–∏—è' },
                        { key: 'photo_url', label: '–§–æ—Ç–æ (—Å—Å—ã–ª–∫–∞)' },
                        { key: 'phone', label: '–¢–µ–ª–µ—Ñ–æ–Ω' },
                        { key: 'email', label: 'Email' },
                        { key: 'website', label: '–°–∞–π—Ç' },
                        { key: 'company', label: '–ö–æ–º–ø–∞–Ω–∏—è' },
                        { key: 'about_me', label: '–û —Å–µ–±–µ' }
                    ];
                    collectMissingFields(profile, fields, 0, (filledProfile) => {
                        // –ü–æ—Å–ª–µ —Å–±–æ—Ä–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –ø—Ä–æ –∫–ª–∏–µ–Ω—Ç–∞
                        askAddClientData(filledProfile, reportId);
                    });
                } else {
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è');
                }
            });
        }

        function collectMissingFields(profile, fields, idx, cb) {
            if (idx >= fields.length) {
                cb(profile);
                return;
            }
            const field = fields[idx];
            if (profile[field.key]) {
                collectMissingFields(profile, fields, idx + 1, cb);
            } else {
                showModalInput(field.label + ' (–º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)', (val) => {
                    if (val) profile[field.key] = val;
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É
                    const update = {};
                    update[field.key] = val;
                    fetch('/api/user_profile', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ telegram_id: userData.id, ...update })
                    });
                    collectMissingFields(profile, fields, idx + 1, cb);
                }, true);
            }
        }

        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –≤–æ–ø—Ä–æ—Å–æ–º (–¥–∞/–Ω–µ—Ç)
        function showModalQuestion(question, onYes, onNo) {
            let oldModal = document.getElementById('modal-question');
            if (oldModal) oldModal.remove();
            const modal = document.createElement('div');
            modal.id = 'modal-question';
            modal.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);z-index:2000;display:flex;align-items:center;justify-content:center;';
            modal.innerHTML = `
                <div style="background:#fff;border-radius:18px;box-shadow:0 4px 24px rgba(102,126,234,0.18);padding:28px 18px 18px 18px;max-width:340px;width:90vw;text-align:center;">
                    <div style="font-size:18px;font-weight:700;color:#667eea;margin-bottom:16px;">${question}</div>
                    <button class="btn" style="width:100%;font-size:16px;" onclick="closeModalQuestion();window._modalYes()">–î–∞</button>
                    <button class="btn btn-secondary" style="width:100%;margin-top:10px;font-size:16px;" onclick="closeModalQuestion();window._modalNo()">–ù–µ—Ç, –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
                </div>
            `;
            document.body.appendChild(modal);
            window._modalYes = onYes;
            window._modalNo = onNo;
        }
        function closeModalQuestion() {
            let modal = document.getElementById('modal-question');
            if (modal) modal.remove();
        }
        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞
        function showModalInput(label, onSubmit, allowSkip) {
            let oldModal = document.getElementById('modal-input');
            if (oldModal) oldModal.remove();
            const modal = document.createElement('div');
            modal.id = 'modal-input';
            modal.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);z-index:2100;display:flex;align-items:center;justify-content:center;';
            modal.innerHTML = `
                <div style="background:#fff;border-radius:18px;box-shadow:0 4px 24px rgba(102,126,234,0.18);padding:28px 18px 18px 18px;max-width:340px;width:90vw;text-align:center;">
                    <div style="font-size:18px;font-weight:700;color:#667eea;margin-bottom:16px;">${label}</div>
                    <input id="modalInputField" class="input-field" style="margin-bottom:10px;width:90%;font-size:16px;padding:8px;" autofocus>
                    <button class="btn" style="width:100%;font-size:16px;" onclick="closeModalInput();window._modalInputSubmit()">${allowSkip ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å/–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å'}</button>
                </div>
            `;
            document.body.appendChild(modal);
            window._modalInputSubmit = function() {
                const val = document.getElementById('modalInputField').value.trim();
                onSubmit(val);
            };
        }
        function closeModalInput() {
            let modal = document.getElementById('modal-input');
            if (modal) modal.remove();
        }
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF (AJAX)
        function generatePdfRequest(profile, clientName, reportId) {
            if (!reportId) {
                alert('–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å id –æ—Ç—á–µ—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF!');
                return;
            }
            console.log('PDF GENERATE: reportId:', reportId, 'profile:', profile, 'clientName:', clientName, 'fullReport:', window._currentFullReport);
            fetch('/api/generate_pdf_report', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ report: window._currentFullReport, profile, client_name: clientName, report_id: reportId })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success && data.pdf_path) {
                    showPdfDownloadModal(data.pdf_path, data.message);
                } else {
                    alert('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF: ' + (data.error || ''));
                    if (data.details) console.log('PDF ERROR DETAILS:', data.details);
                }
            });
        }
        // –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è PDF
        function showPdfDownloadModal(pdfPath, message) {
            let oldModal = document.getElementById('pdf-download-modal');
            if (oldModal) oldModal.remove();
            const modal = document.createElement('div');
            modal.id = 'pdf-download-modal';
            modal.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);z-index:1200;display:flex;align-items:center;justify-content:center;';
            modal.innerHTML = `
                <div style="background:#fff;border-radius:18px;box-shadow:0 4px 24px rgba(102,126,234,0.18);padding:28px 18px 18px 18px;max-width:340px;width:90vw;text-align:center;">
                    <div style="font-size:18px;font-weight:700;color:#667eea;margin-bottom:16px;">${message || 'PDF –≥–æ—Ç–æ–≤'}</div>
                    <a href="/api/download_pdf" onclick="event.preventDefault();window.open('${pdfPath}','_blank');window.location.href='/webapp_saved';" class="btn" style="width:100%;font-size:16px;">–°–∫–∞—á–∞—Ç—å PDF</a>
                    <button class="btn btn-secondary" style="width:100%;margin-top:10px;font-size:16px;" onclick="closePdfDownloadModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        function closePdfDownloadModal() {
            let modal = document.getElementById('pdf-download-modal');
            if (modal) modal.remove();
        }
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª–∏–µ–Ω—Ç—É
        function sendPdfToClientFlow(reportId) {
            if (!reportId) {
                alert('–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å id –æ—Ç—á–µ—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç—É!');
                return;
            }
            generatePdfRequest(null, null, reportId);
            // –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–º–æ–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ UX)
            setTimeout(() => {
                showSendClientModal();
            }, 1000);
        }
        function showSendClientModal() {
            let oldModal = document.getElementById('send-client-modal');
            if (oldModal) oldModal.remove();
            const modal = document.createElement('div');
            modal.id = 'send-client-modal';
            modal.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);z-index:1300;display:flex;align-items:center;justify-content:center;';
            modal.innerHTML = `
                <div style="background:#fff;border-radius:18px;box-shadow:0 4px 24px rgba(102,126,234,0.18);padding:28px 18px 18px 18px;max-width:340px;width:90vw;text-align:center;">
                    <div style="font-size:18px;font-weight:700;color:#667eea;margin-bottom:16px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É</div>
                    <input id="clientNameInput" class="input-field" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞" style="margin-bottom:10px;width:90%;">
                    <input id="clientTelegramInput" class="input-field" placeholder="Telegram –∫–ª–∏–µ–Ω—Ç–∞ (username)" style="margin-bottom:10px;width:90%;">
                    <button class="btn" style="width:100%;font-size:16px;" onclick="sendPdfToClientConfirm()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    <button class="btn btn-secondary" style="width:100%;margin-top:10px;font-size:16px;" onclick="closeSendClientModal()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        function closeSendClientModal() {
            let modal = document.getElementById('send-client-modal');
            if (modal) modal.remove();
        }
        function sendPdfToClientConfirm() {
            const clientName = document.getElementById('clientNameInput').value.trim();
            const clientTelegram = document.getElementById('clientTelegramInput').value.trim();
            if (!clientName || !clientTelegram) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Ç—å –∫ PDF (–º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ window._lastPdfPath –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)
            const pdfPath = window._lastPdfPath || '';
            fetch('/api/send_pdf_to_client', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    realtor_telegram_id: userData.id,
                    client_name: clientName,
                    client_telegram: clientTelegram,
                    pdf_path: pdfPath
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('PDF –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç—É –∏ –∑–∞–ø–∏—Å–∞–Ω –≤ –∏—Å—Ç–æ—Ä–∏—é!');
                    closeSendClientModal();
                } else {
                    alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ PDF');
                }
            });
        }
        // –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
        function confirmDeleteReport(reportId) {
            if (confirm(getText('confirm_delete'))) {
                deleteReport(reportId);
            }
        }
        async function deleteReport(reportId) {
            if (!userData) return;
            const res = await fetch('/api/delete_user_report', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ telegram_id: userData.id, report_id: reportId })
            });
            const data = await res.json();
            if (data.success) {
                loadReports();
            } else {
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
            }
        }
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
        async function confirmUpdateReport(reportId) {
            if (confirm(getText('confirm_update'))) {
                const res = await fetch('/api/update_user_report', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ telegram_id: userData.id, report_id: reportId })
                });
                const data = await res.json();
                if (data.success) {
                    alert('–û—Ç—á–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω!');
                    loadReports();
                } else if (data.error === 'Insufficient balance') {
                    alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –ë–∞–ª–∞–Ω—Å: $${data.balance}`);
                } else {
                    alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞');
                }
            }
        }
        // –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç—á–µ—Ç –µ—Å–ª–∏ –Ω–µ—Ç id, –∑–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞–µ—Ç cb(reportId) ‚Äî –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç—É
        async function saveReportIfNeededAndExportPdf(report, cb) {
            if (report.id) {
                cb(report.id);
                return;
            }
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç—á–µ—Ç –≤ –±–∞–∑—É
            const res = await fetch('/api/user_reports/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ telegram_id: userData.id, full_report: report.full_report, address: report.address, report_type: report.report_type })
            });
            const data = await res.json();
            if (data.success && data.report_id) {
                cb(data.report_id);
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞ (–Ω–µ –ø–æ–ª—É—á–µ–Ω id)');
            }
        }
        async function saveReportIfNeededAndSendToClient(report, cb) {
            if (report.id) {
                cb(report.id);
                return;
            }
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç—á–µ—Ç –≤ –±–∞–∑—É
            const res = await fetch('/api/user_reports/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ telegram_id: userData.id, full_report: report.full_report, address: report.address, report_type: report.report_type })
            });
            const data = await res.json();
            if (data.success && data.report_id) {
                cb(data.report_id);
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞ (–Ω–µ –ø–æ–ª—É—á–µ–Ω id)');
            }
        }
        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF
        async function downloadPdf(reportId) {
            // –ü–æ–ª—É—á–∞–µ–º –æ—Ç—á–µ—Ç –ø–æ ID
            const res = await fetch('/api/user_reports', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ telegram_id: userData.id })
            });
            const data = await res.json();
            if (data.success && data.reports) {
                const report = data.reports.find(r => r.id == reportId);
                if (report && report.full_report) {
                    window._currentFullReport = report.full_report;
                    saveReportIfNeededAndExportPdf(report, function(newReportId) {
                        exportPdfFlow(newReportId);
                    });
                } else {
                    alert('–ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
            }
        }
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª–∏–µ–Ω—Ç—É
        async function sendToClient(reportId) {
            // –ü–æ–ª—É—á–∞–µ–º –æ—Ç—á–µ—Ç –ø–æ ID
            const res = await fetch('/api/user_reports', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ telegram_id: userData.id })
            });
            const data = await res.json();
            if (data.success && data.reports) {
                const report = data.reports.find(r => r.id == reportId);
                if (report && report.full_report) {
                    window._currentFullReport = report.full_report;
                    saveReportIfNeededAndSendToClient(report, function(newReportId) {
                        sendPdfToClientFlow(newReportId);
                    });
                } else {
                    alert('–ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
            }
        }
        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é saveAndExitFullReport
        async function saveAndExitFullReport() {
            if (!userData || !window._currentFullReport) return;
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç—á–µ—Ç –≤ –±–∞–∑—É (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω)
            const res = await fetch('/api/user_reports', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ telegram_id: userData.id, full_report: window._currentFullReport })
            });
            // –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
            window.location.href = '/webapp';
        }
        loadReports();
        window.addEventListener('DOMContentLoaded', loadReports);
    </script>
</body>
</html> 