# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π –≤–∞–ª—é—Ç –≤ –æ—Ç—á–µ—Ç—ã –æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏

## –û–±–∑–æ—Ä

–î–∞–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç –≤ –æ—Ç—á–µ—Ç—ã –æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏. –ö–æ–≥–¥–∞ –∞–¥—Ä–µ—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –¢—É—Ä—Ü–∏–∏, –≤—Å–µ —Ü–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ –µ–≤—Ä–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç.

## –§–∞–π–ª—ã

### 1. `currency_functions.py`
–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∞–ª—é—Ç–∞–º–∏:

- `get_currency_rates()` - –ø–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ API
- `fetch_and_save_currency_rates()` - –ø–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å—ã —Å currencylayer.com –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
- `format_currency_rates_for_report()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫—É—Ä—Å—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –æ—Ç—á–µ—Ç–µ
- `convert_to_euro()` - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –µ–≤—Ä–æ
- `convert_market_data_to_euro()` - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ä—ã–Ω–∫–∞ –≤ –µ–≤—Ä–æ

### 2. `test_currency.py`
–¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π –≤–∞–ª—é—Ç.

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥

### –®–∞–≥ 1: –ò–º–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π
–î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ `app.py`:

```python
from currency_functions import get_currency_rates, format_currency_rates_for_report, convert_market_data_to_euro
```

### –®–∞–≥ 2: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ `format_simple_report`
–î–æ–±–∞–≤–∏—Ç—å –≤ —Ñ—É–Ω–∫—Ü–∏—é `format_simple_report` –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ `# –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á—ë—Ç`:

```python
# –ü–æ–ª—É—á–∞–µ–º –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç
currency_rates = get_currency_rates()
is_turkey = False

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∞–¥—Ä–µ—Å –≤ –¢—É—Ä—Ü–∏–∏
if hasattr(format_simple_report, 'last_location_components'):
    components = format_simple_report.last_location_components
    if components and components.get('country_code') == 'TR':
        is_turkey = True
        logger.info("üáπüá∑ –ê–¥—Ä–µ—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –¢—É—Ä—Ü–∏–∏, –ø—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –≤–∞–ª—é—Ç")

# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Ä—ã–Ω–∫–∞ –≤ –µ–≤—Ä–æ, –µ—Å–ª–∏ —ç—Ç–æ –¢—É—Ä—Ü–∏—è
if is_turkey and market_data and currency_rates:
    logger.info("üí± –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Ä—ã–Ω–∫–∞ –≤ –µ–≤—Ä–æ")
    market_data = convert_market_data_to_euro(market_data, currency_rates)

# –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–∞—Ç–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞ –∏ –∫—É—Ä—Å–∞—Ö –≤–∞–ª—é—Ç
current_date = datetime.now().strftime("%d.%m.%Y")
report_lines.extend([
    f"üìÖ –î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞: {current_date}",
    "",
])

# –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫—É—Ä—Å–∞—Ö –≤–∞–ª—é—Ç, –µ—Å–ª–∏ —ç—Ç–æ –¢—É—Ä—Ü–∏—è
if is_turkey and currency_rates:
    currency_info = format_currency_rates_for_report(currency_rates)
    report_lines.extend([
        f"üí± {currency_info}",
        "",
    ])
elif is_turkey and not currency_rates:
    report_lines.extend([
        "‚ö†Ô∏è –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –¥–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –º–µ—Å—Ç–Ω–æ–π –≤–∞–ª—é—Ç–µ",
        "",
    ])
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã currency

–¢–∞–±–ª–∏—Ü–∞ `currency` –≤ Supabase –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è:

- `id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `created_at` - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ (—Ñ–æ—Ä–º–∞—Ç ISO)
- `euro` - –∫—É—Ä—Å –µ–≤—Ä–æ (–≤—Å–µ–≥–¥–∞ 1.0)
- `rub` - –∫—É—Ä—Å —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ —Ä—É–±–ª—è –∫ –µ–≤—Ä–æ
- `usd` - –∫—É—Ä—Å –¥–æ–ª–ª–∞—Ä–∞ –°–®–ê –∫ –µ–≤—Ä–æ
- `try` - –∫—É—Ä—Å —Ç—É—Ä–µ—Ü–∫–æ–π –ª–∏—Ä—ã –∫ –µ–≤—Ä–æ
- `aed` - –∫—É—Ä—Å –¥–∏—Ä—Ö–∞–º–∞ –û–ê–≠ –∫ –µ–≤—Ä–æ
- `thb` - –∫—É—Ä—Å —Ç–∞–π—Å–∫–æ–≥–æ –±–∞—Ç–∞ –∫ –µ–≤—Ä–æ

## API CurrencyLayer

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è API –∫–ª—é—á: `c61dddb55d93e77ce5a2c8b91fb22694`

### –ó–∞–ø—Ä–æ—Å –∫ API:
```
GET http://api.currencylayer.com/live
Parameters:
- access_key: API –∫–ª—é—á
- source: EUR (–±–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞)
- currencies: RUB,USD,TRY,AED,THB
```

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "success": true,
  "quotes": {
    "EURRUB": 91.265035,
    "EURUSD": 1.162261,
    "EURTRY": 46.897678,
    "EURAED": 4.26841,
    "EURTHB": 37.628259
  }
}
```

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∞–¥—Ä–µ—Å –≤ –¢—É—Ä—Ü–∏–∏ –ø–æ –∫–æ–¥—É —Å—Ç—Ä–∞–Ω—ã `TR`
2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤**: –ï—Å–ª–∏ –∞–¥—Ä–µ—Å –≤ –¢—É—Ä—Ü–∏–∏, –ø–æ–ª—É—á–∞—é—Ç—Å—è –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –∏–∑ –ë–î –∏–ª–∏ API
3. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –í—Å–µ —Ü–µ–Ω—ã –≤ –¥–∞–Ω–Ω—ã—Ö —Ä—ã–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ –µ–≤—Ä–æ
4. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏**: –í –æ—Ç—á–µ—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –¥–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç

## –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è

–í –¥–∞–Ω–Ω—ã—Ö —Ä—ã–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è:
- `unit_price_for_sale` - —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –º¬≤
- `min_unit_price_for_sale` - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –º¬≤
- `max_unit_price_for_sale` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –º¬≤
- `unit_price_for_rent` - —Ü–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã –∑–∞ –º¬≤
- `min_unit_price_for_rent` - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã –∑–∞ –º¬≤
- `max_unit_price_for_rent` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã –∑–∞ –º¬≤
- `price_for_sale` - –æ–±—â–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏
- `price_for_rent` - –æ–±—â–∞—è —Ü–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç:
```bash
python test_currency.py
```

## –ü—Ä–∏–º–µ—Ä –æ—Ç—á–µ—Ç–∞ —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π

```
–ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ –≤ —Ä–∞–¥–∏—É—Å–µ 5 –∫–º:

üìÖ –î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞: 19.01.2025

üí± –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç (EUR): RUB: 91.2650 | USD: 1.1623 | TRY: 46.8977 | AED: 4.2684 | THB: 37.6283

=== –û–ë–©–ò–ô –¢–†–ï–ù–î ===

üìä –ü–†–û–î–ê–ñ–ê –ù–ï–î–í–ò–ñ–ò–ú–û–°–¢–ò
–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏, –º¬≤: ‚Ç¨106.63
–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏, –º¬≤: ‚Ç¨85.31
–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏: ‚Ç¨127.96
...
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –ï—Å–ª–∏ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –¥–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –º–µ—Å—Ç–Ω–æ–π –≤–∞–ª—é—Ç–µ
- –ï—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω—è—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –∏–∑ –ë–î
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
