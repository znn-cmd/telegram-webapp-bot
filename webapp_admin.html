<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="/i18n-manager.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aaadviser - <span data-i18n="admin.title">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</span></title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body { background: #f8f9fa; margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .container { max-width: 400px; margin: 40px auto; background: #fff; border-radius: 16px; box-shadow: 0 2px 12px rgba(102,126,234,0.10); padding: 32px 20px 24px 20px; text-align: center; }
        .admin-logo { width: 120px; margin: 0 auto 18px auto; display: block; }
        .admin-title { font-size: 1.4em; font-weight: bold; margin-bottom: 18px; color: #333; }
        .admin-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border: none; border-radius: 12px; padding: 18px 20px; font-size: 16px; font-weight: 500; cursor: pointer; margin: 12px 0 0 0; width: 100%; text-align: left; transition: all 0.2s; box-shadow: 0 2px 8px rgba(102,126,234,0.15); display: flex; align-items: center; gap: 12px; }
        .admin-btn:hover { background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); }
        .admin-btn-icon { font-size: 20px; margin-right: 10px; }
        .admin-btn-yellow { background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%) !important; color: #222 !important; }
        .nav-btn-row { display: flex; gap: 10px; margin-top: 28px; }
        .nav-btn { flex: 1; padding: 14px 0; border: none; border-radius: 10px; font-size: 1em; font-weight: 500; cursor: pointer; background: #f1f1f1; color: #333; transition: background 0.2s; }
        .nav-btn:hover { background: #e2e2e2; }
        .nav-btn-main { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; }
        .nav-btn-main:hover { background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); }
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 1000; }
        .toast { background: #fff; border-radius: 8px; padding: 12px 18px; margin-bottom: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.12); border-left: 4px solid #28a745; display: flex; align-items: center; gap: 8px; animation: fadeIn 0.4s; }
        .toast.error { border-left-color: #dc3545; }
        .toast.info { border-left-color: #007bff; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }
    </style>
</head>
<body>
    <div class="container">
        <img src="/logo-flt.png" alt="Aaadviser Logo" class="admin-logo" />
        <div class="admin-title" data-i18n="admin.title">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
        <button class="admin-btn admin-btn-yellow" onclick="makeBalance100()">
            <span class="admin-btn-icon">üí∞</span>
            <span data-i18n="admin.make_balance_100">–°–¥–µ–ª–∞—Ç—å –±–∞–ª–∞–Ω—Å 100</span>
        </button>
        <button class="admin-btn" onclick="showUsersStats()">
            <span class="admin-btn-icon">üë•</span>
            <span data-i18n="admin.users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
        </button>
        <button class="admin-btn" onclick="showPublication()">
            <span class="admin-btn-icon">üì¢</span>
            <span data-i18n="admin.publication">–ü—É–±–ª–∏–∫–∞—Ü–∏—è</span>
        </button>
        <button class="admin-btn" onclick="showSettings()">
            <span class="admin-btn-icon">‚öôÔ∏è</span>
            <span data-i18n="admin.settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
        </button>
        <button class="admin-btn" onclick="refreshCache()">
            <span class="admin-btn-icon">üîÑ</span>
            <span data-i18n="admin.refresh_cache">–û–±–Ω–æ–≤–∏—Ç—å –∫–µ—à</span>
        </button>
        <div class="nav-btn-row">
            <button class="nav-btn" onclick="goBack()" data-i18n="common.back">–ù–∞–∑–∞–¥</button>
            <button class="nav-btn nav-btn-main" onclick="goToMainMenu()" data-i18n="common.main_menu">–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        </div>
    </div>
    <div id="toastContainer" class="toast-container"></div>
    <script>
        // –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
        const locales = {
            'ru': {
                'admin.title': '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å',
                'admin.make_balance_100': '–°–¥–µ–ª–∞—Ç—å –±–∞–ª–∞–Ω—Å 100',
                'admin.users': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏',
                'admin.publication': '–ü—É–±–ª–∏–∫–∞—Ü–∏—è',
                'admin.settings': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
                'admin.refresh_cache': '–û–±–Ω–æ–≤–∏—Ç—å –∫–µ—à',
                'common.back': '–ù–∞–∑–∞–¥',
                'common.main_menu': '–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
                'admin.balance_updated': '–ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—ë–Ω –¥–æ 100',
                'admin.balance_error': '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞',
                'admin.cache_refreshed': '–ö–µ—à —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω',
                'admin.cache_error': '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–µ—à–∞',
                'admin.user_not_found': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω. –û—Ç–∫—Ä–æ–π—Ç–µ WebApp –∏–∑ Telegram.'
            },
            'en': {
                'admin.title': 'Admin Panel',
                'admin.make_balance_100': 'Set Balance to 100',
                'admin.users': 'Users',
                'admin.publication': 'Publication',
                'admin.settings': 'Settings',
                'admin.refresh_cache': 'Refresh Cache',
                'common.back': 'Back',
                'common.main_menu': 'To Main Menu',
                'admin.balance_updated': 'Balance updated to 100',
                'admin.balance_error': 'Error updating balance',
                'admin.cache_refreshed': 'Cache refreshed successfully',
                'admin.cache_error': 'Error refreshing cache',
                'admin.user_not_found': 'User not identified. Open WebApp from Telegram.'
            },
            'de': {
                'admin.title': 'Admin-Panel',
                'admin.make_balance_100': 'Kontostand auf 100 setzen',
                'admin.users': 'Benutzer',
                'admin.publication': 'Ver√∂ffentlichung',
                'admin.settings': 'Einstellungen',
                'admin.refresh_cache': 'Cache aktualisieren',
                'common.back': 'Zur√ºck',
                'common.main_menu': 'Zum Hauptmen√º',
                'admin.balance_updated': 'Kontostand auf 100 aktualisiert',
                'admin.balance_error': 'Fehler beim Aktualisieren des Kontostands',
                'admin.cache_refreshed': 'Cache erfolgreich aktualisiert',
                'admin.cache_error': 'Fehler beim Aktualisieren des Caches',
                'admin.user_not_found': 'Benutzer nicht identifiziert. √ñffnen Sie WebApp aus Telegram.'
            },
            'fr': {
                'admin.title': 'Panneau d\'Administration',
                'admin.make_balance_100': 'D√©finir le Solde √† 100',
                'admin.users': 'Utilisateurs',
                'admin.publication': 'Publication',
                'admin.settings': 'Param√®tres',
                'admin.refresh_cache': 'Actualiser le Cache',
                'common.back': 'Retour',
                'common.main_menu': 'Au Menu Principal',
                'admin.balance_updated': 'Solde mis √† jour √† 100',
                'admin.balance_error': 'Erreur de mise √† jour du solde',
                'admin.cache_refreshed': 'Cache actualis√© avec succ√®s',
                'admin.cache_error': 'Erreur lors de l\'actualisation du cache',
                'admin.user_not_found': 'Utilisateur non identifi√©. Ouvrez WebApp depuis Telegram.'
            },
            'tr': {
                'admin.title': 'Y√∂netici Paneli',
                'admin.make_balance_100': 'Bakiyeyi 100 Yap',
                'admin.users': 'Kullanƒ±cƒ±lar',
                'admin.publication': 'Yayƒ±n',
                'admin.settings': 'Ayarlar',
                'admin.refresh_cache': '√ñnbelleƒüi Yenile',
                'common.back': 'Geri',
                'common.main_menu': 'Ana Men√ºye',
                'admin.balance_updated': 'Bakiye 100\'e g√ºncellendi',
                'admin.balance_error': 'Bakiye g√ºncelleme hatasƒ±',
                'admin.cache_refreshed': '√ñnbellek ba≈üarƒ±yla yenilendi',
                'admin.cache_error': '√ñnbellek yenileme hatasƒ±',
                'admin.user_not_found': 'Kullanƒ±cƒ± tanƒ±mlanmadƒ±. WebApp\'i Telegram\'dan a√ßƒ±n.'
            }
        };

        let currentLanguage = 'ru';

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
        function getText(key) {
            return locales[currentLanguage][key] || key;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function updatePageText() {
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (key) {
                    element.textContent = getText(key);
                }
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º title —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.title = `Aaadviser - ${getText('admin.title')}`;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
        async function initLocalization() {
            if (window.i18nManager) {
                currentLanguage = await window.i18nManager.init();
                window.i18nManager.setTranslations(locales);
                window.i18nManager.updatePageText();
            } else {
                // Fallback –µ—Å–ª–∏ i18nManager –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
                updatePageText();
            }
        }

        function goBack() { window.history.back(); }
        function goToMainMenu() { window.location.href = '/webapp'; }
        function showToast(message, type = 'success', duration = 2500) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span> <span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.remove(); }, duration);
        }
        function makeBalance100() {
            const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
            let userData = tg && tg.initDataUnsafe && tg.initDataUnsafe.user ? tg.initDataUnsafe.user : null;
            if (!userData) {
                try { userData = JSON.parse(localStorage.getItem('aaadviser_user')); } catch (e) { userData = null; }
            }
            if (!userData || !userData.id) {
                alert(getText('admin.user_not_found'));
                return;
            }
            const btn = event.target.closest('button');
            btn.disabled = true;
            fetch('/api/admin_balance_100', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ telegram_id: userData.id })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    btn.textContent = 'Balance: $100';
                    showToast(getText('admin.balance_updated'), 'success');
                    setTimeout(() => { 
                        btn.innerHTML = `<span class="admin-btn-icon">üí∞</span><span data-i18n="admin.make_balance_100">${getText('admin.make_balance_100')}</span>`;
                        btn.disabled = false; 
                    }, 2000);
                } else {
                    showToast(getText('admin.balance_error') + ': ' + (data.error || ''), 'error');
                    btn.disabled = false;
                }
            })
            .catch(() => { showToast(getText('admin.balance_error'), 'error'); btn.disabled = false; });
        }
        function showUsersStats() { window.location.href = '/webapp_admin_users'; }
        function showPublication() { window.location.href = '/webapp_admin_publication'; }
        function showSettings() { window.location.href = '/webapp_admin_settings'; }
        
        function refreshCache() {
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span class="admin-btn-icon">‚è≥</span><span>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...</span>';
            
            fetch('/api/cache/refresh_simple', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    btn.innerHTML = '<span class="admin-btn-icon">‚úÖ</span><span data-i18n="admin.cache_refreshed">' + getText('admin.cache_refreshed') + '</span>';
                    showToast(getText('admin.cache_refreshed'), 'success');
                    setTimeout(() => { 
                        btn.innerHTML = originalText;
                        btn.disabled = false; 
                    }, 3000);
                } else {
                    showToast(getText('admin.cache_error') + ': ' + (data.error || ''), 'error');
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            })
            .catch(() => { 
                showToast(getText('admin.cache_error'), 'error'); 
                btn.innerHTML = originalText;
                btn.disabled = false; 
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', initLocalization);
    </script>
</body>
</html> 