<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitleTag">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî Aaadviser</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body { background: #f8f9fa; margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .container { max-width: 400px; margin: 40px auto; background: #fff; border-radius: 16px; box-shadow: 0 2px 12px rgba(102,126,234,0.10); padding: 32px 20px 24px 20px; text-align: center; }
        .admin-logo { width: 120px; margin: 0 auto 18px auto; display: block; }
        .admin-title { font-size: 1.4em; font-weight: bold; margin-bottom: 18px; color: #333; }
        .admin-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border: none; border-radius: 12px; padding: 18px 20px; font-size: 16px; font-weight: 500; cursor: pointer; margin: 12px 0 0 0; width: 100%; text-align: left; transition: all 0.2s; box-shadow: 0 2px 8px rgba(102,126,234,0.15); display: flex; align-items: center; gap: 12px; }
        .admin-btn:hover { background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); }
        .admin-btn-icon { font-size: 20px; margin-right: 10px; }
        .admin-btn-yellow { background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%) !important; color: #222 !important; }
        .nav-btn-row { display: flex; gap: 10px; margin-top: 28px; }
        .nav-btn { flex: 1; padding: 14px 0; border: none; border-radius: 10px; font-size: 1em; font-weight: 500; cursor: pointer; background: #f1f1f1; color: #333; transition: background 0.2s; }
        .nav-btn:hover { background: #e2e2e2; }
        .nav-btn-main { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; }
        .nav-btn-main:hover { background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); }
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 1000; }
        .toast { background: #fff; border-radius: 8px; padding: 12px 18px; margin-bottom: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.12); border-left: 4px solid #28a745; display: flex; align-items: center; gap: 8px; animation: fadeIn 0.4s; }
        .toast.error { border-left-color: #dc3545; }
        .toast.info { border-left-color: #007bff; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }
    </style>
</head>
<body>
    <div class="container">
        <img src="/logo-flt.png" alt="Aaadviser Logo" class="admin-logo" />
        <div class="admin-title" id="adminTitle">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
        <button class="admin-btn admin-btn-yellow" onclick="makeBalance100()" id="balanceBtn">
            <span class="admin-btn-icon">üí∞</span>
            <span id="balanceBtnText">–°–¥–µ–ª–∞—Ç—å –±–∞–ª–∞–Ω—Å 100</span>
        </button>
        <button class="admin-btn" onclick="showUsersStats()" id="usersBtn">
            <span class="admin-btn-icon">üë•</span>
            <span id="usersBtnText">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
        </button>
        <button class="admin-btn" onclick="showPublication()" id="publicationBtn">
            <span class="admin-btn-icon">üì¢</span>
            <span id="publicationBtnText">–ü—É–±–ª–∏–∫–∞—Ü–∏—è</span>
        </button>
        <button class="admin-btn" onclick="showSettings()" id="settingsBtn">
            <span class="admin-btn-icon">‚öôÔ∏è</span>
            <span id="settingsBtnText">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
        </button>
        <div class="nav-btn-row">
            <button class="nav-btn" onclick="goBack()" id="backBtn">–ù–∞–∑–∞–¥</button>
            <button class="nav-btn nav-btn-main" onclick="goToMainMenu()" id="mainMenuBtn">–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        </div>
    </div>
    <div id="toastContainer" class="toast-container"></div>
    <script>
        function goBack() { window.history.back(); }
        function goToMainMenu() { window.location.href = '/webapp'; }
        function showToast(message, type = 'success', duration = 2500) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span> <span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.remove(); }, duration);
        }
        function makeBalance100() {
            const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
            let userData = tg && tg.initDataUnsafe && tg.initDataUnsafe.user ? tg.initDataUnsafe.user : null;
            if (!userData) {
                try { userData = JSON.parse(localStorage.getItem('aaadviser_user')); } catch (e) { userData = null; }
            }
            if (!userData || !userData.id) {
                alert(getText('userNotDefined'));
                return;
            }
            const btn = event.target.closest('button');
            btn.disabled = true;
            fetch('/api/admin_balance_100', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ telegram_id: userData.id })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    btn.textContent = getText('balanceSetText');
                    showToast(getText('balanceSuccess'), 'success');
                    setTimeout(() => { btn.textContent = getText('balanceBtnText'); btn.disabled = false; }, 2000);
                } else {
                    showToast(getText('balanceError') + (data.error || getText('balanceUpdateError')), 'error');
                    btn.disabled = false;
                }
            })
            .catch(() => { showToast(getText('networkError'), 'error'); btn.disabled = false; });
        }
        function showUsersStats() { window.location.href = '/webapp_admin_users'; }
        function showPublication() { window.location.href = '/webapp_admin_publication'; }
        function showSettings() { window.location.href = '/webapp_admin_settings'; }
    </script>

    <!-- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è -->
    <script>
        let currentLanguage = 'ru';
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
        async function getUserData() {
            try {
                const userData = window.Telegram.WebApp.initDataUnsafe.user;
                if (!userData) {
                    console.warn('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã');
                    return null;
                }
                return userData;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                return null;
            }
        }
        
        // –°–ª–æ–≤–∞—Ä–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
        const locales = {
            ru: {
                pageTitleTag: '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî Aaadviser',
                adminTitle: '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å',
                balanceBtnText: '–°–¥–µ–ª–∞—Ç—å –±–∞–ª–∞–Ω—Å 100',
                balanceSetText: '–ë–∞–ª–∞–Ω—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: $100',
                usersBtnText: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏',
                publicationBtnText: '–ü—É–±–ª–∏–∫–∞—Ü–∏—è',
                settingsBtnText: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
                backBtn: '–ù–∞–∑–∞–¥',
                mainMenuBtn: '–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
                userNotDefined: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω. –û—Ç–∫—Ä–æ–π—Ç–µ WebApp –∏–∑ Telegram.',
                balanceSuccess: '–ë–∞–ª–∞–Ω—Å —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!',
                balanceError: '–û—à–∏–±–∫–∞: ',
                balanceUpdateError: '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å.',
                networkError: '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏.'
            },
            en: {
                pageTitleTag: 'Admin Panel ‚Äî Aaadviser',
                adminTitle: 'Admin Panel',
                balanceBtnText: 'Set balance to 100',
                balanceSetText: 'Balance set: $100',
                usersBtnText: 'Users',
                publicationBtnText: 'Publication',
                settingsBtnText: 'Settings',
                backBtn: 'Back',
                mainMenuBtn: 'To Main Menu',
                userNotDefined: 'User not defined. Open WebApp from Telegram.',
                balanceSuccess: 'Balance successfully set!',
                balanceError: 'Error: ',
                balanceUpdateError: 'Failed to update balance.',
                networkError: 'Network error.'
            },
            de: {
                pageTitleTag: 'Admin-Panel ‚Äî Aaadviser',
                adminTitle: 'Admin-Panel',
                balanceBtnText: 'Guthaben auf 100 setzen',
                balanceSetText: 'Guthaben gesetzt: $100',
                usersBtnText: 'Benutzer',
                publicationBtnText: 'Ver√∂ffentlichung',
                settingsBtnText: 'Einstellungen',
                backBtn: 'Zur√ºck',
                mainMenuBtn: 'Zum Hauptmen√º',
                userNotDefined: 'Benutzer nicht definiert. √ñffnen Sie WebApp aus Telegram.',
                balanceSuccess: 'Guthaben erfolgreich gesetzt!',
                balanceError: 'Fehler: ',
                balanceUpdateError: 'Guthaben konnte nicht aktualisiert werden.',
                networkError: 'Netzwerkfehler.'
            },
            fr: {
                pageTitleTag: 'Panneau d\'administration ‚Äî Aaadviser',
                adminTitle: 'Panneau d\'administration',
                balanceBtnText: 'D√©finir le solde √† 100',
                balanceSetText: 'Solde d√©fini : $100',
                usersBtnText: 'Utilisateurs',
                publicationBtnText: 'Publication',
                settingsBtnText: 'Param√®tres',
                backBtn: 'Retour',
                mainMenuBtn: 'Au menu principal',
                userNotDefined: 'Utilisateur non d√©fini. Ouvrez WebApp depuis Telegram.',
                balanceSuccess: 'Solde d√©fini avec succ√®s !',
                balanceError: 'Erreur : ',
                balanceUpdateError: 'Impossible de mettre √† jour le solde.',
                networkError: 'Erreur r√©seau.'
            },
            tr: {
                pageTitleTag: 'Admin Paneli ‚Äî Aaadviser',
                adminTitle: 'Admin Paneli',
                balanceBtnText: 'Bakiyeyi 100 yap',
                balanceSetText: 'Bakiye ayarlandƒ±: $100',
                usersBtnText: 'Kullanƒ±cƒ±lar',
                publicationBtnText: 'Yayƒ±n',
                settingsBtnText: 'Ayarlar',
                backBtn: 'Geri',
                mainMenuBtn: 'Ana Men√ºye',
                userNotDefined: 'Kullanƒ±cƒ± tanƒ±mlanmadƒ±. WebApp\'i Telegram\'dan a√ßƒ±n.',
                balanceSuccess: 'Bakiye ba≈üarƒ±yla ayarlandƒ±!',
                balanceError: 'Hata: ',
                balanceUpdateError: 'Bakiye g√ºncellenemedi.',
                networkError: 'Aƒü hatasƒ±.'
            }
        };
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –ø–æ –∫–ª—é—á—É
        function getText(key) {
            return locales[currentLanguage][key] || key;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function updatePageText() {
            // –û–±–Ω–æ–≤–ª—è–µ–º title
            document.getElementById('pageTitleTag').textContent = getText('pageTitleTag');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            const elements = [
                'adminTitle', 'balanceBtnText', 'usersBtnText', 'publicationBtnText', 
                'settingsBtnText', 'backBtn', 'mainMenuBtn'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = getText(id);
                }
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
        async function initLocalization() {
            try {
                const userData = await getUserData();
                if (userData && userData.language_code) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–æ–º
                    const response = await fetch('/api/user', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            telegram_id: userData.id,
                            username: userData.username,
                            tg_name: userData.first_name,
                            last_name: userData.last_name,
                            language_code: userData.language_code
                        })
                    });
                    
                    if (response.ok) {
                        const userInfo = await response.json();
                        
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —è–∑—ã–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        if (userInfo.user_status === 'admin' && userInfo.language) {
                            // –î–ª—è –∞–¥–º–∏–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º —è–∑—ã–∫ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                            currentLanguage = userInfo.language;
                        } else if (userData.language_code) {
                            // –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º —è–∑—ã–∫ –∏–∑ Telegram
                            currentLanguage = userData.language_code;
                        }
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å –Ω–æ–≤—ã–º —è–∑—ã–∫–æ–º
                        updatePageText();
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                currentLanguage = 'ru';
                updatePageText();
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            initLocalization();
        });
    </script>
    <script src="/i18n-manager.js"></script>
</body>
</html> 