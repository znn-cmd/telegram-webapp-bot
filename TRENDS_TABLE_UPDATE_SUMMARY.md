# Обновление таблицы "Детальные данные трендов"

## Описание изменений

Обновлена логика отображения таблицы "Детальные данные трендов" в файле `webapp_object_evaluation.html`. Теперь для текущего месяца цены продажи и аренды рассчитываются как средние значения из глобальных переменных.

## Детали изменений

### 1. Обновлена функция `generateTrendsTable`

- **Приоритет глобальных переменных**: Сначала пытаемся получить средние цены из глобальных переменных `window.avgMinSalePrice`, `window.avgMaxSalePrice`, `window.avgMinRentPrice`, `window.avgMaxRentPrice`
- **Fallback на API**: Если глобальные переменные недоступны, используем API эндпоинт `/api/property_data/average_prices`
- **Расчет средних цен**: Для текущего месяца цены рассчитываются как `(avgMin + avgMax) / 2`

### 2. Улучшено определение текущего месяца

- **Использование поля `date`**: Вместо полей `property_year` и `property_month` используется поле `date` для корректного определения текущего месяца
- **Логика определения**: Тренд считается текущим месяцем, если его год и месяц совпадают с текущей датой

### 3. Добавлено логирование для отладки

- **Логирование глобальных переменных**: Выводится информация о доступности и значениях глобальных переменных
- **Логирование обновления цен**: При обновлении цен для текущего месяца выводится детальная информация
- **Логирование анализа дат**: Показывается процесс определения текущего месяца для каждого тренда

## Формулы расчета

### Цена продажи для текущего месяца
```
avgSalePrice = Math.round((avgMinSalePrice + avgMaxSalePrice) / 2)
```

### Цена аренды для текущего месяца
```
avgRentPrice = Math.round((avgMinRentPrice + avgMaxRentPrice) / 2)
```

## Логика работы

1. **Текущий месяц**: Цены рассчитываются как средние значения из глобальных переменных
2. **Исторические месяцы**: Используются оригинальные значения из трендов
3. **Будущие месяцы (прогноз)**: Используются оригинальные значения из трендов

## Файлы изменений

- `webapp_object_evaluation.html` - основная логика таблицы трендов
- `test_trends_calculation.html` - тестовый файл для проверки логики

## Тестирование

Создан тестовый файл `test_trends_calculation.html` для проверки:
- Глобальных переменных
- Расчетов средних цен
- Определения текущего месяца
- Обновления данных трендов

## Результат

Теперь таблица "Детальные данные трендов" корректно отображает:
- Обновленные цены для текущего месяца на основе средних значений
- Исторические данные без изменений
- Прогнозные данные без изменений
- Визуальное выделение текущего месяца (синий фон)
