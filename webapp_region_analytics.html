<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aaadviser - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–µ–≥–∏–æ–Ω–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
        }

        .header {
            background: white;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .logo {
            width: 110px;
            height: auto;
            display: block;
            margin: 0 auto 8px;
            cursor: pointer;
        }

        .slogan {
            font-size: 15px;
            color: #888;
            font-style: italic;
        }

        .page-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            text-align: center;
            margin: 20px 0 10px 0;
            padding: 0 20px;
        }

        .page-description {
            font-size: 16px;
            color: #666;
            text-align: center;
            margin: 0 0 30px 0;
            padding: 0 20px;
            line-height: 1.5;
        }

        .location-section {
            padding: 0 20px 20px 20px;
        }

        .location-group {
            margin-bottom: 20px;
        }

        .location-label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .location-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            color: #333;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .location-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .location-select:disabled {
            background: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }

        .confirm-button {
            width: 100%;
            padding: 14px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-bottom: 20px;
        }

        .confirm-button:hover:not(:disabled) {
            background: #5a6fd8;
        }

        .confirm-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .back-button {
            display: block;
            width: 100%;
            padding: 14px 20px;
            background: #28a745;
            color: white;
            text-decoration: none;
            text-align: center;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s ease;
            margin-top: 20px;
        }

        .back-button:hover {
            background: #218838;
        }

        .selected-location {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            display: none;
        }

        .selected-location.show {
            display: block;
        }

        .selected-location-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .selected-location-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 8px;
        }

        .admin-ids {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .admin-ids-title {
            font-size: 16px;
            font-weight: 600;
            color: #856404;
            margin-bottom: 10px;
        }

        .admin-ids-text {
            font-size: 14px;
            color: #856404;
            font-family: monospace;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 20px;
            color: #721c24;
            text-align: center;
        }

        /* Region Data Section Styles */
        .region-data-section {
            padding: 0 20px 20px 20px;
        }

        .data-section-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
        }

        .loading-state {
            text-align: center;
            padding: 40px 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 16px;
            color: #666;
        }

        .data-content {
            display: none;
        }

        /* Analytics Cards - New Design */
        .analytics-card {
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 16px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .analytics-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .card-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 16px 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .card-header:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
        }

        .card-icon {
            font-size: 24px;
            margin-right: 12px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .card-toggle {
            font-size: 18px;
            color: #667eea;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .card-toggle.expanded {
            transform: rotate(180deg);
        }

        .card-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-content.expanded {
            max-height: 2000px;
            padding: 20px;
        }

        /* General Data Card - Always Visible */
        .general-data .card-content {
            max-height: none;
            padding: 20px;
        }

        .general-data .card-header {
            cursor: default;
        }

        .general-data .card-header:hover {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        /* Block 1: General Data - Two Column Layout */
        .general-data .card-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }

        .data-column {
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }

        .data-column.rent {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .data-column.sale {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            color: white;
        }

        .data-column h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .data-column p {
            font-size: 14px;
            margin: 8px 0;
            opacity: 0.9;
        }

        .data-footer {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-top: 16px;
        }

        .yield {
            color: #27ae60;
            font-weight: 600;
        }

        .updated {
            color: #7f8c8d;
            font-size: 12px;
        }

        /* Block 2: House Types - Horizontal Scroll */
        .scroll-container {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            padding: 8px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .scroll-container::-webkit-scrollbar {
            display: none;
        }

        .type-card {
            min-width: 140px;
            padding: 16px;
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .type-card:hover {
            transform: scale(1.02);
        }

        .type-card h3 {
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 12px;
            color: #333;
        }

        .metrics {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }

        .metrics .rent {
            color: #3498db;
            font-weight: 600;
        }

        .metrics .sale {
            color: #e67e22;
            font-weight: 600;
        }

        .metrics .yield {
            color: #27ae60;
            font-weight: 600;
        }

        .type-card p {
            font-size: 12px;
            text-align: center;
            color: #666;
            margin: 4px 0;
        }

        /* Block 3: Floor Segments - Grid Layout */
        .floor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
        }

        .floor-card {
            padding: 16px;
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .floor-card:hover {
            transform: scale(1.02);
        }

        .floor-card .icon {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }

        .floor-card .data {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .floor-card .rent {
            color: #3498db;
            font-weight: 600;
            font-size: 16px;
        }

        .floor-card .sale {
            color: #e67e22;
            font-weight: 600;
            font-size: 16px;
        }

        .floor-card p {
            font-size: 12px;
            color: #666;
            margin: 0;
        }

        /* Block 4: Age Data - Progress Bars */
        .progress-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .progress-block {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
        }

        .progress-block h3 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 16px;
        }

        .progress-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .progress-row span:first-child {
            min-width: 60px;
            font-size: 14px;
            color: #666;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-bar.rent {
            background: #3498db;
        }

        .progress-bar.sale {
            background: #e67e22;
        }

        .progress-row span:last-child {
            min-width: 40px;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            text-align: right;
        }

        /* Block 5: Heating Data - Highlight Cards */
        .highlight-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .highlight-card {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .highlight-card:hover {
            transform: scale(1.02);
        }

        .heating-type {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .metric {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            opacity: 0.9;
        }

        .highlight-card p {
            font-size: 14px;
            margin: 8px 0;
            opacity: 0.8;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .general-data .card-content {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .data-footer {
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }

            .floor-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .highlight-container {
                grid-template-columns: 1fr;
            }
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .data-label {
            font-size: 16px;
            color: #333;
            font-weight: 500;
        }

        .data-value {
            font-size: 16px;
            color: #667eea;
            font-weight: 600;
        }

        .data-chart {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }

        .chart-placeholder {
            font-size: 14px;
            color: #666;
            font-style: italic;
        }

        .no-data {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .error-state {
            text-align: center;
            padding: 40px 20px;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            margin: 20px 0;
        }

        .error-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .error-text {
            font-size: 16px;
            color: #721c24;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header with Logo -->
        <div class="header">
            <img src="logo-flt.png" alt="Aaadviser Logo" class="logo" onclick="goToMainMenu()" />
            <div class="slogan" id="slogan">–ò–Ω—Å–∞–π—Ç—ã —Ä—ã–Ω–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</div>
        </div>

        <!-- Page Title -->
        <div class="page-title" id="pageTitle">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–µ–≥–∏–æ–Ω–∞</div>

        <!-- Page Description -->
        <div class="page-description" id="pageDescription">
            –ü–æ–ª—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ä–µ–≥–∏–æ–Ω–µ —Å –ø—Ä–æ–≥–Ω–æ–∑–∞–º–∏ —Ü–µ–Ω
        </div>

        <!-- Location Selection Section -->
        <div class="location-section">
            <!-- Country Selection -->
            <div class="location-group">
                <label class="location-label" id="countryLabel">–°—Ç—Ä–∞–Ω–∞:</label>
                <select class="location-select" id="countrySelect" onchange="onCountryChange()">
                    <option value="" id="countryPlaceholder">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                </select>
            </div>

            <!-- City Selection -->
            <div class="location-group">
                <label class="location-label" id="cityLabel">–ì–æ—Ä–æ–¥:</label>
                <select class="location-select" id="citySelect" onchange="onCityChange()" disabled>
                    <option value="" id="cityPlaceholder">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                </select>
            </div>

            <!-- County Selection -->
            <div class="location-group">
                <label class="location-label" id="countyLabel">–û–±–ª–∞—Å—Ç—å/–†–µ–≥–∏–æ–Ω:</label>
                <select class="location-select" id="countySelect" onchange="onCountyChange()" disabled>
                    <option value="" id="countyPlaceholder">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                </select>
            </div>

            <!-- District Selection -->
            <div class="location-group">
                <label class="location-label" id="districtLabel">–†–∞–π–æ–Ω:</label>
                <select class="location-select" id="districtSelect" onchange="onDistrictChange()" disabled>
                    <option value="" id="districtPlaceholder">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å</option>
                </select>
            </div>

            <!-- Confirm Button -->
            <button class="confirm-button" id="confirmButton" onclick="confirmLocationSelection()" disabled>
                <span id="confirmButtonText">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä</span>
            </button>
        </div>

        <!-- Selected Location Display -->
        <div class="selected-location" id="selectedLocation">
            <div class="selected-location-title" id="selectedLocationTitle">–í—ã–±—Ä–∞–Ω–Ω–∞—è –ª–æ–∫–∞—Ü–∏—è:</div>
            <div class="selected-location-text" id="selectedLocationText"></div>
            <div class="admin-ids" id="adminIds" style="display: none;">
                <div class="admin-ids-title" id="adminIdsTitle">ID –¥–ª—è –∞–¥–º–∏–Ω–æ–≤:</div>
                <div class="admin-ids-text" id="adminIdsText"></div>
            </div>
        </div>

        <!-- Region Data Analysis -->
        <div class="region-data-section" id="regionDataSection" style="display: none;">
            
            <!-- Loading State -->
            <div class="loading-state" id="loadingState">
                <div class="loading-spinner"></div>
                <div class="loading-text" id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
            </div>
            
            <!-- Data Content -->
            <div class="data-content" id="dataContent" style="display: none;">
                <!-- Block 1: General Data (Always Visible) -->
                <div class="analytics-card general-data" id="generalDataCard">
                    <div class="card-header">
                        <div class="card-icon">üìä</div>
                        <div class="card-title" id="generalDataTitle">–û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ</div>
                    </div>
                    <div class="card-content" id="generalDataContent">
                        <!-- General data will be populated here -->
                    </div>
                </div>
                 
                <!-- Block 2: House Types (Horizontal Scroll) -->
                <div class="analytics-card accordion" id="houseTypeDataCard">
                    <div class="card-header" onclick="toggleAccordion('houseTypeDataCard')">
                        <div class="card-icon">üè†</div>
                        <div class="card-title" id="houseTypeDataTitle">–¢–∏–ø—ã –¥–æ–º–æ–≤</div>
                        <div class="card-toggle" id="houseTypeDataToggle">‚ñº</div>
                    </div>
                    <div class="card-content" id="houseTypeDataContent">
                        <div class="scroll-container" id="houseTypeScroll">
                            <!-- House type cards will be populated here -->
                        </div>
                    </div>
                </div>
                 
                <!-- Block 3: Floor Segments (Compact Icons) -->
                <div class="analytics-card accordion" id="floorSegmentDataCard">
                    <div class="card-header" onclick="toggleAccordion('floorSegmentDataCard')">
                        <div class="card-icon">üè¢</div>
                        <div class="card-title" id="floorSegmentDataTitle">–≠—Ç–∞–∂–∏</div>
                        <div class="card-toggle" id="floorSegmentDataToggle">‚ñº</div>
                    </div>
                    <div class="card-content" id="floorSegmentDataContent">
                        <div class="floor-grid" id="floorGrid">
                            <!-- Floor cards will be populated here -->
                        </div>
                    </div>
                </div>
                 
                <!-- Block 4: Age Data (Progress Bars) -->
                <div class="analytics-card accordion" id="ageDataCard">
                    <div class="card-header" onclick="toggleAccordion('ageDataCard')">
                        <div class="card-icon">üìÖ</div>
                        <div class="card-title" id="ageDataTitle">–í–æ–∑—Ä–∞—Å—Ç –æ–±—ä–µ–∫—Ç–æ–≤</div>
                        <div class="card-toggle" id="ageDataToggle">‚ñº</div>
                    </div>
                    <div class="card-content" id="ageDataContent">
                        <div class="progress-container" id="ageProgress">
                            <!-- Progress bars will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Block 5: Heating Data (Highlight Card) -->
                <div class="analytics-card accordion" id="heatingDataCard">
                    <div class="card-header" onclick="toggleAccordion('heatingDataCard')">
                        <div class="card-icon">üî•</div>
                        <div class="card-title" id="heatingDataTitle">–û—Ç–æ–ø–ª–µ–Ω–∏–µ</div>
                        <div class="card-toggle" id="heatingDataToggle">‚ñº</div>
                    </div>
                    <div class="card-content" id="heatingDataContent">
                        <div class="highlight-container" id="heatingHighlight">
                            <!-- Heating highlight cards will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Error State -->
            <div class="error-state" id="errorState" style="display: none;">
                <div class="error-icon">‚ùå</div>
                <div class="error-text" id="errorText">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>
            </div>
        </div>

        <!-- Back Button -->
        <a href="/webapp_main" class="back-button" id="backButton">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</a>
    </div>

    <script>
        // Telegram WebApp initialization
        let tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // Current language
        let currentLanguage = 'ru';

        // Selected location data
        let selectedLocation = {
            country_id: null,
            city_id: null,
            county_id: null,
            district_id: null,
            country_name: '',
            city_name: '',
            county_name: '',
            district_name: ''
        };

        // Localization data
        const locales = {
            'ru': {
                'slogan': '–ò–Ω—Å–∞–π—Ç—ã —Ä—ã–Ω–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏',
                'pageTitle': '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–µ–≥–∏–æ–Ω–∞',
                'pageDescription': '–ü–æ–ª—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ä–µ–≥–∏–æ–Ω–µ —Å –ø—Ä–æ–≥–Ω–æ–∑–∞–º–∏ —Ü–µ–Ω',
                'countryLabel': '–°—Ç—Ä–∞–Ω–∞:',
                'cityLabel': '–ì–æ—Ä–æ–¥:',
                'countyLabel': '–û–±–ª–∞—Å—Ç—å/–†–µ–≥–∏–æ–Ω:',
                'districtLabel': '–†–∞–π–æ–Ω:',
                'countryPlaceholder': '–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É',
                'cityPlaceholder': '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É',
                'countyPlaceholder': '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥',
                'districtPlaceholder': '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å',
                'confirmButtonText': '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä',
                'backButton': '‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
                'selectedLocationTitle': '–í—ã–±—Ä–∞–Ω–Ω–∞—è –ª–æ–∫–∞—Ü–∏—è:',
                'adminIdsTitle': 'ID –¥–ª—è –∞–¥–º–∏–Ω–æ–≤:',
                'loading': '–ó–∞–≥—Ä—É–∑–∫–∞...',
                'errorLoading': '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö',
                'dataSectionTitle': '–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞',
                'generalDataTitle': '–û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ',
                'houseTypeDataTitle': '–î–∞–Ω–Ω—ã–µ –ø–æ —Ç–∏–ø–∞–º –¥–æ–º–æ–≤',
                'floorSegmentDataTitle': '–î–∞–Ω–Ω—ã–µ –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞–º —ç—Ç–∞–∂–µ–π',
                            'ageDataTitle': '–î–∞–Ω–Ω—ã–µ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É –æ–±—ä–µ–∫—Ç–æ–≤',
                'heatingDataTitle': '–î–∞–Ω–Ω—ã–µ –ø–æ –æ—Ç–æ–ø–ª–µ–Ω–∏—é',
                'loadingText': '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...',
                'errorText': '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö',
                                 'totalProperties': '–í—Å–µ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤:',
                 'averagePrice': '–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞:',
                 'priceRange': '–î–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω:',
                 'noDataAvailable': '–î–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã',
                 'rent': '–ê—Ä–µ–Ω–¥–∞',
                 'sale': '–ü—Ä–æ–¥–∞–∂–∞',
                 'quantity': '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ',
                 'avgPrice': '–°—Ä–µ–¥.—Ü–µ–Ω–∞',
                 'area': '–ü–ª–æ—â–∞–¥—å',
                 'duration': '–°—Ä–æ–∫',
                 'yield': '–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å',
                 'updated': '–û–±–Ω–æ–≤–ª–µ–Ω–æ',
                 'objects': '–æ–±—ä–µ–∫—Ç–æ–≤',
                 'days': '–¥–Ω–µ–π'
            },
            'en': {
                'slogan': 'Real Estate Market Insights',
                'pageTitle': 'Region Analytics',
                'pageDescription': 'Get a detailed analysis of the real estate market in the selected region with price forecasts',
                'countryLabel': 'Country:',
                'cityLabel': 'City:',
                'countyLabel': 'Region/Area:',
                'districtLabel': 'District:',
                'countryPlaceholder': 'Select country',
                'cityPlaceholder': 'First select country',
                'countyPlaceholder': 'First select city',
                'districtPlaceholder': 'First select region',
                'confirmButtonText': 'Confirm selection',
                'backButton': '‚Üê Back to main menu',
                'selectedLocationTitle': 'Selected location:',
                'adminIdsTitle': 'IDs for admins:',
                'loading': 'Loading...',
                'errorLoading': 'Error loading data',
                'dataSectionTitle': 'Regional Data Analysis',
                'generalDataTitle': 'General Data',
                'houseTypeDataTitle': 'House Type Data',
                'floorSegmentDataTitle': 'Floor Segment Data',
            'ageDataTitle': 'Age Data',
                'heatingDataTitle': 'Heating Data',
                'loadingText': 'Loading data...',
                'errorText': 'Error loading data',
                                 'totalProperties': 'Total properties:',
                 'averagePrice': 'Average price:',
                 'priceRange': 'Price range:',
                 'noDataAvailable': 'Data not available',
                 'rent': 'Rent',
                 'sale': 'Sale',
                 'quantity': 'Quantity',
                 'avgPrice': 'Avg.Price',
                 'area': 'Area',
                 'duration': 'Duration',
                 'yield': 'Yield',
                 'updated': 'Updated',
                 'objects': 'objects',
                 'days': 'days'
            },
            'de': {
                'slogan': 'Immobilienmarkt-Einblicke',
                'pageTitle': 'Regionsanalyse',
                'pageDescription': 'Erhalten Sie eine detaillierte Analyse des Immobilienmarkts in der ausgew√§hlten Region mit Preisprognosen',
                'countryLabel': 'Land:',
                'cityLabel': 'Stadt:',
                'countyLabel': 'Region/Bereich:',
                'districtLabel': 'Bezirk:',
                'countryPlaceholder': 'Land ausw√§hlen',
                'cityPlaceholder': 'Zuerst Land ausw√§hlen',
                'countyPlaceholder': 'Zuerst Stadt ausw√§hlen',
                'districtPlaceholder': 'Zuerst Region ausw√§hlen',
                'confirmButtonText': 'Auswahl best√§tigen',
                'backButton': '‚Üê Zur√ºck zum Hauptmen√º',
                'selectedLocationTitle': 'Ausgew√§hlte Lage:',
                'adminIdsTitle': 'IDs f√ºr Administratoren:',
                'loading': 'Laden...',
                'errorLoading': 'Fehler beim Laden der Daten',
                'dataSectionTitle': 'Regionale Datenanalyse',
                'generalDataTitle': 'Allgemeine Daten',
                'houseTypeDataTitle': 'Haus-Typ-Daten',
                'floorSegmentDataTitle': 'Etagen-Segment-Daten',
            'ageDataTitle': 'Altersdaten',
                'heatingDataTitle': 'Heizungsdaten',
                'loadingText': 'Daten werden geladen...',
                'errorText': 'Fehler beim Laden der Daten',
                                 'totalProperties': 'Gesamtobjekte:',
                 'averagePrice': 'Durchschnittspreis:',
                 'priceRange': 'Preisbereich:',
                 'noDataAvailable': 'Daten nicht verf√ºgbar',
                 'rent': 'Miete',
                 'sale': 'Verkauf',
                 'quantity': 'Menge',
                 'avgPrice': 'Durchs.Preis',
                 'area': 'Fl√§che',
                 'duration': 'Dauer',
                 'yield': 'Rendite',
                 'updated': 'Aktualisiert',
                 'objects': 'Objekte',
                 'days': 'Tage'
            },
            'fr': {
                'slogan': 'Aper√ßus du march√© immobilier',
                'pageTitle': 'Analyse de r√©gion',
                'pageDescription': 'Obtenez une analyse d√©taill√©e du march√© immobilier dans la r√©gion s√©lectionn√©e avec des pr√©visions de prix',
                'countryLabel': 'Pays :',
                'cityLabel': 'Ville :',
                'countyLabel': 'R√©gion/Zone :',
                'districtLabel': 'District :',
                'countryPlaceholder': 'S√©lectionner un pays',
                'cityPlaceholder': 'D\'abord s√©lectionner un pays',
                'countyPlaceholder': 'D\'abord s√©lectionner une ville',
                'districtPlaceholder': 'D\'abord s√©lectionner une r√©gion',
                'confirmButtonText': 'Confirmer la s√©lection',
                'backButton': '‚Üê Retour au menu principal',
                'selectedLocationTitle': 'Emplacement s√©lectionn√© :',
                'adminIdsTitle': 'IDs pour les administrateurs :',
                'loading': 'Chargement...',
                'errorLoading': 'Erreur de chargement des donn√©es',
                'dataSectionTitle': 'Analyse des donn√©es r√©gionales',
                'generalDataTitle': 'Donn√©es g√©n√©rales',
                'houseTypeDataTitle': 'Donn√©es des types de maisons',
                'floorSegmentDataTitle': 'Donn√©es des segments d\'√©tages',
            'ageDataTitle': 'Donn√©es d\'√¢ge',
                'heatingDataTitle': 'Donn√©es de chauffage',
                'loadingText': 'Chargement des donn√©es...',
                'errorText': 'Erreur de chargement des donn√©es',
                                 'totalProperties': 'Total des propri√©t√©s :',
                 'averagePrice': 'Prix moyen :',
                 'priceRange': 'Fourchette de prix :',
                 'noDataAvailable': 'Donn√©es non disponibles',
                 'rent': 'Location',
                 'sale': 'Vente',
                 'quantity': 'Quantit√©',
                 'avgPrice': 'Prix moy.',
                 'area': 'Surface',
                 'duration': 'Dur√©e',
                 'yield': 'Rendement',
                 'updated': 'Mis √† jour',
                 'objects': 'objets',
                 'days': 'jours'
            },
            'tr': {
                'slogan': 'Gayrimenkul Piyasa ƒ∞√ßg√∂r√ºleri',
                'pageTitle': 'B√∂lge Analizi',
                'pageDescription': 'Se√ßilen b√∂lgede gayrimenkul piyasasƒ±nƒ±n fiyat tahminleriyle detaylƒ± analizini alƒ±n',
                'countryLabel': '√úlke:',
                'cityLabel': '≈ûehir:',
                'countyLabel': 'B√∂lge/Alan:',
                'districtLabel': 'ƒ∞l√ße:',
                'countryPlaceholder': '√úlke se√ßin',
                'cityPlaceholder': '√ñnce √ºlke se√ßin',
                'countyPlaceholder': '√ñnce ≈üehir se√ßin',
                'districtPlaceholder': '√ñnce b√∂lge se√ßin',
                'confirmButtonText': 'Se√ßimi onayla',
                'backButton': '‚Üê Ana men√ºye d√∂n',
                'selectedLocationTitle': 'Se√ßilen konum:',
                'adminIdsTitle': 'Y√∂neticiler i√ßin ID\'ler:',
                'loading': 'Y√ºkleniyor...',
                'errorLoading': 'Veri y√ºkleme hatasƒ±',
                'dataSectionTitle': 'B√∂lgesel Veri Analizi',
                'generalDataTitle': 'Genel Veriler',
                'houseTypeDataTitle': 'Ev Tipi Verileri',
                'floorSegmentDataTitle': 'Kat Segmenti Verileri',
            'ageDataTitle': 'Ya≈ü Verileri',
                'heatingDataTitle': 'Isƒ±tma Verileri',
                'loadingText': 'Veriler y√ºkleniyor...',
                'errorText': 'Veri y√ºkleme hatasƒ±',
                                 'totalProperties': 'Toplam m√ºlk:',
                 'averagePrice': 'Ortalama fiyat:',
                 'priceRange': 'Fiyat aralƒ±ƒüƒ±:',
                 'noDataAvailable': 'Veri mevcut deƒüil',
                 'rent': 'Kiralƒ±k',
                 'sale': 'Satƒ±lƒ±k',
                 'quantity': 'Miktar',
                 'avgPrice': 'Ort.Fiyat',
                 'area': 'Alan',
                 'duration': 'S√ºre',
                 'yield': 'Getiri',
                 'updated': 'G√ºncellendi',
                 'objects': 'nesne',
                 'days': 'g√ºn'
            }
        };

        // Get localized text
        function getText(key) {
            return locales[currentLanguage][key] || key;
        }

        // Update page text based on current language
        function updatePageText() {
            document.getElementById('slogan').textContent = getText('slogan');
            document.getElementById('pageTitle').textContent = getText('pageTitle');
            document.getElementById('pageDescription').textContent = getText('pageDescription');
            document.getElementById('countryLabel').textContent = getText('countryLabel');
            document.getElementById('cityLabel').textContent = getText('cityLabel');
            document.getElementById('countyLabel').textContent = getText('countyLabel');
            document.getElementById('districtLabel').textContent = getText('districtLabel');
            document.getElementById('countryPlaceholder').textContent = getText('countryPlaceholder');
            document.getElementById('cityPlaceholder').textContent = getText('cityPlaceholder');
            document.getElementById('countyPlaceholder').textContent = getText('countyPlaceholder');
            document.getElementById('districtPlaceholder').textContent = getText('districtPlaceholder');
            document.getElementById('confirmButtonText').textContent = getText('confirmButtonText');
            document.getElementById('backButton').textContent = getText('backButton');
            document.getElementById('selectedLocationTitle').textContent = getText('selectedLocationTitle');
            document.getElementById('adminIdsTitle').textContent = getText('adminIdsTitle');
            
            // Update new data section elements
            const dataSectionTitle = document.getElementById('dataSectionTitle');
            if (dataSectionTitle) {
                dataSectionTitle.textContent = getText('dataSectionTitle');
            }
            
            const generalDataTitle = document.getElementById('generalDataTitle');
            if (generalDataTitle) {
                generalDataTitle.textContent = getText('generalDataTitle');
            }
            
            const houseTypeDataTitle = document.getElementById('houseTypeDataTitle');
            if (houseTypeDataTitle) {
                houseTypeDataTitle.textContent = getText('houseTypeDataTitle');
            }
            
            const floorSegmentDataTitle = document.getElementById('floorSegmentDataTitle');
            if (floorSegmentDataTitle) {
                floorSegmentDataTitle.textContent = getText('floorSegmentDataTitle');
            }
            
                        const ageDataTitle = document.getElementById('ageDataTitle');
            if (ageDataTitle) {
                ageDataTitle.textContent = getText('ageDataTitle');
            }

            const heatingDataTitle = document.getElementById('heatingDataTitle');
            if (heatingDataTitle) {
                heatingDataTitle.textContent = getText('heatingDataTitle');
            }

            const loadingText = document.getElementById('loadingText');
            if (loadingText) {
                loadingText.textContent = getText('loadingText');
            }
            
            const errorText = document.getElementById('errorText');
            if (errorText) {
                errorText.textContent = getText('errorText');
            }
        }

        // Load countries from API
        async function loadCountries() {
            try {
                const response = await fetch('/api/locations/countries');
                const data = await response.json();
                
                if (data.success) {
                    const countrySelect = document.getElementById('countrySelect');
                    countrySelect.innerHTML = `<option value="">${getText('countryPlaceholder')}</option>`;
                    
                    data.countries.forEach(([id, name]) => {
                        const option = document.createElement('option');
                        option.value = id;
                        option.textContent = name;
                        countrySelect.appendChild(option);
                    });
                } else {
                    console.error('Failed to load countries:', data.error);
                }
            } catch (error) {
                console.error('Error loading countries:', error);
            }
        }

        // Load cities based on selected country
        async function loadCities(countryId) {
            try {
                const response = await fetch('/api/locations/cities', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ country_id: countryId })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const citySelect = document.getElementById('citySelect');
                    citySelect.innerHTML = `<option value="">${getText('cityPlaceholder')}</option>`;
                    
                    data.cities.forEach(([id, name]) => {
                        const option = document.createElement('option');
                        option.value = id;
                        option.textContent = name;
                        citySelect.appendChild(option);
                    });
                    
                    citySelect.disabled = false;
                } else {
                    console.error('Failed to load cities:', data.error);
                }
            } catch (error) {
                console.error('Error loading cities:', error);
            }
        }

        // Load counties based on selected city
        async function loadCounties(cityId) {
            try {
                const response = await fetch('/api/locations/counties', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ city_id: cityId })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const countySelect = document.getElementById('countySelect');
                    countySelect.innerHTML = `<option value="">${getText('countyPlaceholder')}</option>`;
                    
                    data.counties.forEach(([id, name]) => {
                        const option = document.createElement('option');
                        option.value = id;
                        option.textContent = name;
                        countySelect.appendChild(option);
                    });
                    
                    countySelect.disabled = false;
                } else {
                    console.error('Failed to load counties:', data.error);
                }
            } catch (error) {
                console.error('Error loading counties:', error);
            }
        }

        // Load districts based on selected county
        async function loadDistricts(countyId) {
            try {
                const response = await fetch('/api/locations/districts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ county_id: countyId })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const districtSelect = document.getElementById('districtSelect');
                    districtSelect.innerHTML = `<option value="">${getText('districtPlaceholder')}</option>`;
                    
                    // Add "No value" option
                    const noValueOption = document.createElement('option');
                    noValueOption.value = 'none';
                    noValueOption.textContent = '–ù–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è';
                    districtSelect.appendChild(noValueOption);
                    
                    data.districts.forEach(([id, name]) => {
                        const option = document.createElement('option');
                        option.value = id;
                        option.textContent = name;
                        districtSelect.appendChild(option);
                    });
                    
                    districtSelect.disabled = false;
                } else {
                    console.error('Failed to load districts:', data.error);
                }
            } catch (error) {
                console.error('Error loading districts:', error);
            }
        }

        // Handle country selection change
        function onCountryChange() {
            const countrySelect = document.getElementById('countrySelect');
            const citySelect = document.getElementById('citySelect');
            const countySelect = document.getElementById('countySelect');
            const districtSelect = document.getElementById('districtSelect');
            
            const countryId = countrySelect.value;
            const countryName = countrySelect.options[countrySelect.selectedIndex].text;
            
            // Reset dependent selects
            citySelect.innerHTML = `<option value="">${getText('cityPlaceholder')}</option>`;
            citySelect.disabled = true;
            countySelect.innerHTML = `<option value="">${getText('countyPlaceholder')}</option>`;
            countySelect.disabled = true;
            districtSelect.innerHTML = `<option value="">${getText('districtPlaceholder')}</option>`;
            districtSelect.disabled = true;
            
            // Update selected location
            selectedLocation.country_id = countryId;
            selectedLocation.country_name = countryName;
            selectedLocation.city_id = null;
            selectedLocation.city_name = '';
            selectedLocation.county_id = null;
            selectedLocation.county_name = '';
            selectedLocation.district_id = null;
            selectedLocation.district_name = '';
            
            // Load cities if country is selected
            if (countryId) {
                loadCities(countryId);
            }
            
            updateConfirmButton();
        }

        // Handle city selection change
        function onCityChange() {
            const citySelect = document.getElementById('citySelect');
            const countySelect = document.getElementById('countySelect');
            const districtSelect = document.getElementById('districtSelect');
            
            const cityId = citySelect.value;
            const cityName = citySelect.options[citySelect.selectedIndex].text;
            
            // Reset dependent selects
            countySelect.innerHTML = `<option value="">${getText('countyPlaceholder')}</option>`;
            countySelect.disabled = true;
            districtSelect.innerHTML = `<option value="">${getText('districtPlaceholder')}</option>`;
            districtSelect.disabled = true;
            
            // Update selected location
            selectedLocation.city_id = cityId;
            selectedLocation.city_name = cityName;
            selectedLocation.county_id = null;
            selectedLocation.county_name = '';
            selectedLocation.district_id = null;
            selectedLocation.district_name = '';
            
            // Load counties if city is selected
            if (cityId) {
                loadCounties(cityId);
            }
            
            updateConfirmButton();
        }

        // Handle county selection change
        function onCountyChange() {
            const countySelect = document.getElementById('countySelect');
            const districtSelect = document.getElementById('districtSelect');
            
            const countyId = countySelect.value;
            const countyName = countySelect.options[countySelect.selectedIndex].text;
            
            // Reset dependent selects
            districtSelect.innerHTML = `<option value="">${getText('districtPlaceholder')}</option>`;
            districtSelect.disabled = true;
            
            // Update selected location
            selectedLocation.county_id = countyId;
            selectedLocation.county_name = countyName;
            selectedLocation.district_id = null;
            selectedLocation.district_name = '';
            
            // Load districts if county is selected
            if (countyId) {
                loadDistricts(countyId);
            }
            
            updateConfirmButton();
        }

        // Handle district selection change
        function onDistrictChange() {
            const districtSelect = document.getElementById('districtSelect');
            
            const districtId = districtSelect.value;
            const districtName = districtSelect.options[districtSelect.selectedIndex].text;
            
            // Update selected location
            selectedLocation.district_id = districtId === 'none' ? null : districtId;
            selectedLocation.district_name = districtId === 'none' ? '–ù–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è' : districtName;
            
            updateConfirmButton();
        }

        // Update confirm button state
        function updateConfirmButton() {
            const confirmButton = document.getElementById('confirmButton');
            const hasSelection = selectedLocation.country_id && 
                               selectedLocation.city_id && 
                               selectedLocation.county_id;
            
            confirmButton.disabled = !hasSelection;
        }

        // Confirm location selection
        function confirmLocationSelection() {
            if (!selectedLocation.country_id || !selectedLocation.city_id || !selectedLocation.county_id) {
                return;
            }
            
            // Show selected location
            const selectedLocationDiv = document.getElementById('selectedLocation');
            const selectedLocationText = document.getElementById('selectedLocationText');
            const adminIdsDiv = document.getElementById('adminIds');
            const adminIdsText = document.getElementById('adminIdsText');
            
            // Build location text
            let locationText = `${selectedLocation.country_name}`;
            if (selectedLocation.city_name) {
                locationText += `, ${selectedLocation.city_name}`;
            }
            if (selectedLocation.county_name) {
                locationText += `, ${selectedLocation.county_name}`;
            }
            if (selectedLocation.district_name && selectedLocation.district_id !== 'none') {
                locationText += `, ${selectedLocation.district_name}`;
            }
            
            selectedLocationText.textContent = locationText;
            
            // Build admin IDs text
            let adminIdsString = `country_id: ${selectedLocation.country_id}\n`;
            adminIdsString += `city_id: ${selectedLocation.city_id}\n`;
            adminIdsString += `county_id: ${selectedLocation.county_id}\n`;
            if (selectedLocation.district_id && selectedLocation.district_id !== 'none') {
                adminIdsString += `district_id: ${selectedLocation.district_id}`;
            } else {
                adminIdsString += `district_id: none`;
            }
            
            adminIdsText.textContent = adminIdsString;
            
            // Show the selected location section
            selectedLocationDiv.classList.add('show');
            adminIdsDiv.style.display = 'block';
            
            // Load region data
            loadRegionData();
        }

        // Load region data from API
        async function loadRegionData() {
            try {
                // Show data section and loading state
                const regionDataSection = document.getElementById('regionDataSection');
                const loadingState = document.getElementById('loadingState');
                const dataContent = document.getElementById('dataContent');
                const errorState = document.getElementById('errorState');
                
                regionDataSection.style.display = 'block';
                loadingState.style.display = 'block';
                dataContent.style.display = 'none';
                errorState.style.display = 'none';
                
                // Prepare request data
                const requestData = {
                    country_id: selectedLocation.country_id,
                    city_id: selectedLocation.city_id,
                    county_id: selectedLocation.county_id,
                    district_id: selectedLocation.district_id
                };
                
                // Make API request
                const response = await fetch('/api/region_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Hide loading state
                    loadingState.style.display = 'none';
                    
                    // Display data
                    displayRegionData(data);
                    
                    // Show data content
                    dataContent.style.display = 'block';
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
                
            } catch (error) {
                console.error('Error loading region data:', error);
                
                // Hide loading state
                document.getElementById('loadingState').style.display = 'none';
                
                // Show error state
                const errorState = document.getElementById('errorState');
                const errorText = document.getElementById('errorText');
                errorText.textContent = getText('errorText');
                errorState.style.display = 'block';
            }
        }

        // Display region data
        function displayRegionData(data) {
            console.log('Received data:', data);
            
            // Display general data
            displayGeneralData(data.general_data);
            
            // Display house type data
            displayHouseTypeData(data.house_type_data);
            
            // Display floor segment data
            displayFloorSegmentData(data.floor_segment_data);
            
            // Display age data
            displayAgeData(data.age_data);

            // Display heating data
            displayHeatingData(data.heating_data);
            
            // Auto-expand the first card (General Data) by default
            setTimeout(() => {
                // General data is always visible, so we don't need to toggle it
                // But we can expand the second card (House Types) by default
                toggleAccordion('houseTypeDataCard');
            }, 100);
        }

        // Display general data
        function displayGeneralData(generalData) {
            const content = document.getElementById('generalDataContent');
            
            if (!generalData || generalData.length === 0) {
                content.innerHTML = `<div class="no-data">${getText('noDataAvailable')}</div>`;
                return;
            }
            
            const data = generalData[0]; // Take first record
            
            // Create two-column layout for rent and sale data
            let html = `
                <div class="data-column rent">
                    <h3>${getText('rent')}</h3>
                    <p>${getText('quantity')}: ${data.rent_count || data.total_rent || 0}</p>
                    <p>${getText('avgPrice')}: ${formatPrice(data.rent_avg_price || data.avg_rent_price || 0)}/–º–µ—Å</p>
                    <p>${getText('area')}: ${data.rent_avg_area || data.avg_rent_area || 0}–º¬≤</p>
                    <p>${getText('duration')}: ${data.rent_avg_duration || data.avg_rent_duration || 0} –¥–Ω.</p>
                </div>
                <div class="data-column sale">
                    <h3>${getText('sale')}</h3>
                    <p>${getText('quantity')}: ${data.sale_count || data.total_sale || 0}</p>
                    <p>${getText('avgPrice')}: ${formatPrice(data.sale_avg_price || data.avg_sale_price || 0)}</p>
                    <p>${getText('area')}: ${data.sale_avg_area || data.avg_sale_area || 0}–º¬≤</p>
                    <p>${getText('duration')}: ${data.sale_avg_duration || data.avg_sale_duration || 0} –¥–Ω.</p>
                </div>
                <div class="data-footer">
                    <span class="yield">${getText('yield')}: ${data.yield || data.avg_yield || 0}%</span>
                    <span class="updated">${getText('updated')}: ${formatDate(data.updated_at || data.created_at || new Date())}</span>
                </div>
            `;
            
            content.innerHTML = html;
        }

        // Display house type data
        function displayHouseTypeData(houseTypeData) {
            const content = document.getElementById('houseTypeScroll');
            
            console.log('House type data:', houseTypeData);
            
            if (!houseTypeData || houseTypeData.length === 0) {
                content.innerHTML = `<div class="no-data">${getText('noDataAvailable')}</div>`;
                return;
            }
            
            let html = '';
            
            houseTypeData.forEach(item => {
                console.log('House type item:', item);
                const typeField = item.house_type || item.type || item.house_type_name || item.name;
                const rentCount = item.rent_count || item.count || 0;
                const saleCount = item.sale_count || item.total || 0;
                const yield = item.yield || item.avg_yield || 0;
                const rentPrice = item.rent_avg_price || item.avg_rent_price || 0;
                const salePrice = item.sale_avg_price || item.avg_sale_price || 0;
                const rentArea = item.rent_avg_area || item.avg_rent_area || 0;
                const saleArea = item.sale_avg_area || item.avg_sale_area || 0;
                
                html += `
                    <div class="type-card">
                        <h3>${typeField || 'N/A'}</h3>
                        <div class="metrics">
                            ${rentCount > 0 ? `<div class="rent">${getText('rent')}: ${rentCount}</div>` : ''}
                            ${saleCount > 0 ? `<div class="sale">${getText('sale')}: ${saleCount}</div>` : ''}
                            ${yield > 0 ? `<div class="yield">${yield}%</div>` : ''}
                        </div>
                        <p>${rentPrice > 0 ? formatPrice(rentPrice) + '/–º–µ—Å' : ''} ${salePrice > 0 ? '| ' + formatPrice(salePrice) : ''}</p>
                        <p>${rentArea > 0 ? rentArea + '–º¬≤' : ''} ${saleArea > 0 ? '| ' + saleArea + '–º¬≤' : ''}</p>
                    </div>
                `;
            });
            
            content.innerHTML = html;
        }

        // Display floor segment data
        function displayFloorSegmentData(floorSegmentData) {
            const content = document.getElementById('floorGrid');
            
            console.log('Floor segment data:', floorSegmentData);
            
            if (!floorSegmentData || floorSegmentData.length === 0) {
                content.innerHTML = `<div class="no-data">${getText('noDataAvailable')}</div>`;
                return;
            }
            
            let html = '';
            
            floorSegmentData.forEach(item => {
                console.log('Floor segment item:', item);
                const segmentField = item.floor_segment || item.segment || item.floor_segment_name || item.name;
                const rentCount = item.rent_count || item.count || 0;
                const saleCount = item.sale_count || item.total || 0;
                const rentPrice = item.rent_avg_price || item.avg_rent_price || 0;
                const salePrice = item.sale_avg_price || item.avg_sale_price || 0;
                
                html += `
                    <div class="floor-card">
                        <div class="icon">${segmentField || 'N/A'}</div>
                        <div class="data">
                            ${rentCount > 0 ? `<span class="rent">${rentCount}</span>` : ''}
                            ${saleCount > 0 ? `<span class="sale">${saleCount}</span>` : ''}
                            <p>${rentPrice > 0 ? formatPrice(rentPrice) : ''} ${salePrice > 0 ? '| ' + formatPrice(salePrice) : ''}</p>
                        </div>
                    </div>
                `;
            });
            
            content.innerHTML = html;
        }

                // Display age data
        function displayAgeData(ageData) {
            const content = document.getElementById('ageProgress');

            console.log('Age data:', ageData);

            if (!ageData || ageData.length === 0) {
                content.innerHTML = `<div class="no-data">${getText('noDataAvailable')}</div>`;
                return;
            }

            let html = '';

            ageData.forEach(item => {
                console.log('Age item:', item);
                const ageField = item.age_category || item.age || item.age_category_name || item.name;
                const rentCount = item.rent_count || item.count || 0;
                const saleCount = item.sale_count || item.total || 0;
                const totalCount = rentCount + saleCount;
                
                if (totalCount > 0) {
                    const rentPercentage = totalCount > 0 ? Math.round((rentCount / totalCount) * 100) : 0;
                    const salePercentage = totalCount > 0 ? Math.round((saleCount / totalCount) * 100) : 0;
                    
                    html += `
                        <div class="progress-block">
                            <h3>${ageField || 'N/A'}</h3>
                            ${rentCount > 0 ? `
                                <div class="progress-row">
                                    <span>${getText('rent')}</span>
                                    <div class="progress-bar rent" style="width: ${rentPercentage}%"></div>
                                    <span>${rentPercentage}%</span>
                                </div>
                            ` : ''}
                            ${saleCount > 0 ? `
                                <div class="progress-row">
                                    <span>${getText('sale')}</span>
                                    <div class="progress-bar sale" style="width: ${salePercentage}%"></div>
                                    <span>${salePercentage}%</span>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }
            });

            content.innerHTML = html;
        }

        // Display heating data
        function displayHeatingData(heatingData) {
            const content = document.getElementById('heatingHighlight');

            console.log('Heating data:', heatingData);

            if (!heatingData || heatingData.length === 0) {
                content.innerHTML = `<div class="no-data">${getText('noDataAvailable')}</div>`;
                return;
            }

            let html = '';

            heatingData.forEach(item => {
                console.log('Heating item:', item);
                const heatingField = item.heating_type || item.heating || item.heating_type_name || item.name;
                const countField = item.count || item.quantity || item.total;
                const avgPrice = item.avg_price || item.average_price || 0;
                const avgDuration = item.avg_duration || item.average_duration || 0;
                
                html += `
                    <div class="highlight-card">
                        <div class="heating-type">${heatingField || 'N/A'}</div>
                        <div class="metric">${countField} ${getText('objects')}</div>
                        <p>${getText('avgPrice')}: ${formatPrice(avgPrice)}</p>
                        <p>${getText('duration')}: ${avgDuration} ${getText('days')}</p>
                    </div>
                `;
            });

            content.innerHTML = html;
        }

        // Go to main menu
        function goToMainMenu() {
            window.location.href = '/webapp_main';
        }

        // Initialize the page
        function init() {
            // Set language based on Telegram WebApp
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const userLang = tg.initDataUnsafe.user.language_code;
                if (userLang && locales[userLang]) {
                    currentLanguage = userLang;
                }
            }
            
            // Update page text
            updatePageText();
            
            // Load countries
            loadCountries();
        }

        // Helper functions for data formatting
        function formatPrice(price) {
            if (!price || price === 0) return '0';
            if (price >= 1000) {
                return (price / 1000).toFixed(1) + 'K';
            }
            return price.toString();
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return 'N/A';
            
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) {
                return '–≤—á–µ—Ä–∞';
            } else if (diffDays < 7) {
                return `${diffDays} –¥–Ω. –Ω–∞–∑–∞–¥`;
            } else {
                return date.toLocaleDateString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        // Toggle accordion functionality
        function toggleAccordion(cardId) {
            const card = document.getElementById(cardId);
            const content = card.querySelector('.card-content');
            const toggle = card.querySelector('.card-toggle');
            
            if (content.classList.contains('expanded')) {
                // Collapse
                content.classList.remove('expanded');
                toggle.classList.remove('expanded');
                toggle.textContent = '‚ñº';
            } else {
                // Expand
                content.classList.add('expanded');
                toggle.classList.add('expanded');
                toggle.textContent = '‚ñ≤';
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
