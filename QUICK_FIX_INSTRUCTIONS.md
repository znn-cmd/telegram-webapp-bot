# Краткая инструкция по исправлению проблем

## Проблема 1: Автоинкремент ID в таблице currency

**Ошибка**: `Key (id)=(40) already exists` - последовательность сбросилась

**Решение**: Выполните в Supabase SQL Editor:

```sql
-- Сбрасываем последовательность на максимальное значение + 1
SELECT setval(pg_get_serial_sequence('currency', 'id'), (SELECT MAX(id) FROM currency) + 1);
```

## Проблема 2: RLS политика блокирует вставку

**Ошибка**: `new row violates row-level security policy for table "currency"`

**Решение**: Выполните в Supabase SQL Editor:

```sql
ALTER TABLE currency DISABLE ROW LEVEL SECURITY;
```

## Проблема 3: Ошибка формирования отчета

**Ошибка**: `'list' object has no attribute 'get'`

**Решение**: ✅ Уже исправлено в коде - добавлено логирование и проверки типов

## Порядок исправления:

1. **Сначала исправьте автоинкремент** (Проблема 1)
2. **Затем отключите RLS** (Проблема 2)
3. **Перезапустите приложение**
4. **Проверьте генерацию отчета**

## Файлы для исправления:
- `fix_currency_sequence.sql` - для исправления автоинкремента
- `fix_currency_rls.sql` - для исправления RLS политики

## После исправления:
✅ Курсы валют будут сохраняться в базу без конфликтов ID  
✅ Отчеты будут формироваться без ошибок  
✅ В логах будет подробная информация для отладки
