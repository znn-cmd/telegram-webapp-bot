<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitleTag">Полный отчет - Aaadviser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 25px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .content {
            padding: 30px 25px;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 1px solid #e9ecef;
        }

        .section h2 {
            color: #495057;
            font-size: 22px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h3 {
            color: #6c757d;
            font-size: 18px;
            margin-bottom: 15px;
            margin-top: 20px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .info-label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .info-value {
            color: #333;
            font-size: 16px;
            font-weight: 500;
        }

        .highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .highlight h3 {
            color: white;
            margin-bottom: 15px;
        }

        .highlight .value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .highlight .description {
            opacity: 0.9;
            font-size: 14px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            margin: 20px 0;
        }

        .chart-placeholder {
            height: 200px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 16px;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 150px;
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #6c757d;
            border: 2px solid #e9ecef;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            border-color: #dee2e6;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            color: #721c24;
            text-align: center;
        }

        .additional-data-badge {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .price-comparison-section {
            margin-top: 25px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .price-comparison-section h3 {
            color: #495057;
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
        }

        .comparison-item, .final-comparison, .price-conclusion {
            margin-bottom: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .comparison-label, .conclusion-label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .comparison-values, .conclusion-value {
            color: #333;
            font-size: 16px;
            font-weight: 500;
            line-height: 1.4;
        }

        .final-comparison {
            background: #e8f4fd;
            border-left-color: #17a2b8;
        }

        .price-conclusion {
            background: #fff3cd;
            border-left-color: #ffc107;
        }

        .currency-info {
            background: #fff3e0;
            border-left-color: #ff9800;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        /* Стили для анализа динамики цен */
        .price-chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .price-chart-container h3 {
            color: #495057;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .chart-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
        }
        
        .trend-analysis {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .trend-item {
            margin-bottom: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .trend-label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .trend-value {
            color: #333;
            font-size: 16px;
            font-weight: 500;
            line-height: 1.4;
        }
        
        /* Компактные стили для блока "Информация об объекте" */
        .section.object-info {
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .section.object-info h2 {
            font-size: 20px;
            margin-bottom: 15px;
            gap: 8px;
        }
        
        .section.object-info h2::before {
            font-size: 18px;
        }
        
        .section.object-info .info-grid {
            gap: 12px;
            margin-bottom: 15px;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        }
        
        /* На больших экранах делаем более компактное расположение */
        @media (min-width: 1200px) {
            .section.object-info .info-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
            }
        }
        
        /* На очень больших экранах делаем 5 колонок */
        @media (min-width: 1400px) {
            .section.object-info .info-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 8px;
            }
        }
        
        /* На средних экранах делаем 3 колонки */
        @media (min-width: 768px) and (max-width: 1199px) {
            .section.object-info .info-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
        }
        
        .section.object-info .info-item {
            padding: 12px;
            border-radius: 8px;
        }
        
        .section.object-info .info-label {
            font-size: 12px;
            margin-bottom: 4px;
            line-height: 1.2;
        }
        
        .section.object-info .info-value {
            font-size: 14px;
            line-height: 1.3;
        }
        
        /* Дополнительные компактные стили для значений */
        .section.object-info .info-value:empty::before {
            content: '-';
            color: #6c757d;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 25px 20px;
            }
            
            .content {
                padding: 25px 20px;
            }
            
            .section {
                padding: 20px;
            }
            
            .section.object-info {
                padding: 15px;
            }
            
            .section.object-info .info-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .section.object-info .info-item {
                padding: 10px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Дополнительные компактные стили для очень маленьких экранов */
        @media (max-width: 480px) {
            .section.object-info {
                padding: 12px;
                margin-bottom: 20px;
            }
            
            .section.object-info h2 {
                font-size: 18px;
                margin-bottom: 12px;
            }
            
            .section.object-info .info-grid {
                gap: 8px;
            }
            
            .section.object-info .info-item {
                padding: 8px;
            }
            
            .section.object-info .info-label {
                font-size: 11px;
                margin-bottom: 3px;
            }
            
            .section.object-info .info-value {
                font-size: 13px;
            }
        }
        
        /* Стили для портретной ориентации на мобильных устройствах */
        @media (max-width: 480px) and (orientation: portrait) {
            .section.object-info .info-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
            }
            
            .section.object-info .info-item {
                padding: 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="pageTitle">📊 Полный отчет</h1>
            <p id="pageDescription">Детальный анализ объекта недвижимости</p>
        </div>

        <div class="content">
            <div id="loading" class="loading">
                <h3 id="loadingTitle">🔄 Формируем полный отчет...</h3>
                <p id="loadingText">Пожалуйста, подождите</p>
            </div>

            <div id="error" class="error" style="display: none;">
                <h3 id="errorTitle">❌ Ошибка загрузки отчета</h3>
                <p id="error-message">Произошла ошибка при формировании отчета</p>
            </div>

            <div id="report-content" style="display: none;">
                <!-- Основная информация об объекте -->
                <div class="section object-info">
                    <h2 id="objectInfoTitle">🏠 Информация об объекте</h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label" id="addressLabel">Адрес</div>
                            <div class="info-value" id="object-address">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="bedroomsLabel">Спальни</div>
                            <div class="info-value" id="object-bedrooms">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="priceLabel">Цена</div>
                            <div class="info-value" id="object-price">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="ageLabel">Возраст объекта</div>
                            <div class="info-value" id="object-age">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="floorLabel">Этаж</div>
                            <div class="info-value" id="object-floor">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="heatingLabel">Отопление</div>
                            <div class="info-value" id="object-heating">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="areaLabel">Площадь объекта</div>
                            <div class="info-value" id="object-area">-</div>
                        </div>
                    </div>
                </div>

                <!-- Рыночный анализ -->
                <div class="section">
                    <h2 id="marketAnalysisTitle">📊 Рыночный анализ</h2>
                    
                    <!-- Сравнение цен по критериям -->
                    <div class="price-comparison-section">
                        <h3 id="priceComparisonTitle">📊 Сравнение с рыночными ценами</h3>
                        
                        <!-- Возраст объекта -->
                        <div class="comparison-item">
                            <div class="comparison-label" id="ageComparisonLabel">По возрасту объекта:</div>
                            <div class="comparison-values" id="age-comparison">-</div>
                        </div>
                        
                        <!-- Этаж -->
                        <div class="comparison-item">
                            <div class="comparison-label" id="floorComparisonLabel">По этажу:</div>
                            <div class="comparison-values" id="floor-comparison">-</div>
                        </div>
                        
                        <!-- Тип отопления -->
                        <div class="comparison-item">
                            <div class="comparison-label" id="heatingComparisonLabel">По типу отопления:</div>
                            <div class="comparison-values" id="heating-comparison">-</div>
                        </div>
                        
                        <!-- Тип дома - УБРАНО по требованию -->
                        
                        <!-- Итоговое сравнение -->
                        <div class="final-comparison">
                            <div class="comparison-label" id="finalComparisonLabel">Итоговое сравнение:</div>
                            <div class="comparison-values" id="final-comparison">-</div>
                        </div>
                        
                        <!-- Вывод по цене -->
                        <div class="price-conclusion">
                            <div class="conclusion-label" id="priceConclusionLabel">Вывод по цене:</div>
                            <div class="conclusion-value" id="price-conclusion">-</div>
                        </div>
                        
                        <!-- Информация о конвертации валют -->
                        <div class="currency-info" id="currency-info" style="display: none;">
                            <div class="info-label" id="currencyInfoLabel">💱 Конвертация валют:</div>
                            <div class="info-value" id="currency-info-value">-</div>
                        </div>
                    </div>
                </div>

                <!-- Анализ динамики цен -->
                <div class="section">
                    <h2 id="priceTrendsTitle">📊 Анализ динамики цен</h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label" id="priceTrendLabel">Тренд цен</div>
                            <div class="info-value" id="price-trend">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="priceChange3yLabel">Изменение за 3 года</div>
                            <div class="info-value" id="price-change-3y">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="priceForecastLabel">Прогноз на 3 месяца</div>
                            <div class="info-value" id="price-forecast">-</div>
                        </div>
                    </div>
                    
                    <!-- График динамики цен -->
                    <div class="price-chart-container" style="margin-top: 20px;">
                        <h3 id="priceChartTitle">📈 График изменения цен</h3>
                        <div class="chart-wrapper">
                            <canvas id="priceChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                    
                    <!-- Анализ тренда -->
                    <div class="trend-analysis" style="margin-top: 20px;">
                        <div class="trend-item">
                            <div class="trend-label" id="trendAnalysisLabel">Анализ тренда:</div>
                            <div class="trend-value" id="trend-analysis">-</div>
                        </div>
                        <div class="trend-item">
                            <div class="trend-label" id="trendRecommendationLabel">Рекомендация:</div>
                            <div class="trend-value" id="trend-recommendation">-</div>
                        </div>
                    </div>
                </div>

                <!-- Анализ аренды -->
                <div class="section">
                    <h2 id="rentalAnalysisTitle">🏠 Анализ аренды</h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label" id="maxRentalRateLabel">Максимальная ставка аренды</div>
                            <div class="info-value" id="max-rental-rate">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="annualRentalYieldLabel">Годовая доходность</div>
                            <div class="info-value" id="annual-rental-yield">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="rentalRecommendationLabel">Рекомендация по аренде</div>
                            <div class="info-value" id="rental-recommendation">-</div>
                        </div>
                    </div>
                </div>

                <!-- ROI анализ -->
                <div class="section">
                    <h2 id="roiAnalysisTitle">💰 ROI анализ</h2>
                    
                    <div class="highlight">
                        <h3 id="shortTermRentTitle">Краткосрочная аренда (Airbnb)</h3>
                        <div class="value" id="short-term-income">-</div>
                        <div class="description" id="shortTermIncomeDesc">Доход в месяц</div>
                    </div>

                    <div class="highlight">
                        <h3 id="longTermRentTitle">Долгосрочная аренда</h3>
                        <div class="value" id="long-term-income">-</div>
                        <div class="description" id="longTermIncomeDesc">Доход в год</div>
                    </div>

                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label" id="priceGrowthLabel">Рост цены (5 лет)</div>
                            <div class="info-value" id="price-growth">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="roiWithRentLabel">ROI с арендой</div>
                            <div class="info-value" id="roi-with-rent">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="roiWithoutRentLabel">ROI без аренды</div>
                            <div class="info-value" id="roi-without-rent">-</div>
                        </div>
                    </div>
                </div>

                <!-- Альтернативные инвестиции -->
                <div class="section">
                    <h2 id="alternativesTitle">📈 Альтернативные инвестиции</h2>
                    <div class="info-grid" id="alternatives-grid">
                        <!-- Альтернативы будут добавлены динамически -->
                    </div>
                </div>

                <!-- Макроэкономические данные -->
                <div class="section">
                    <h2 id="macroDataTitle">🌍 Макроэкономические данные</h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label" id="inflationLabel">Инфляция</div>
                            <div class="info-value" id="inflation">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="eurTryLabel">Курс EUR/TRY</div>
                            <div class="info-value" id="eur-try">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="gdpGrowthLabel">Рост ВВП</div>
                            <div class="info-value" id="gdp-growth">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="refiRateLabel">Ставка рефинансирования</div>
                            <div class="info-value" id="refi-rate">-</div>
                        </div>
                    </div>
                </div>

                <!-- Налоги и сборы -->
                <div class="section">
                    <h2 id="taxesTitle">🏛️ Налоги и сборы</h2>
                    <div class="info-grid" id="taxes-grid">
                        <!-- Налоги будут добавлены динамически -->
                    </div>
                </div>

                <!-- Риски и ликвидность -->
                <div class="section">
                    <h2 id="risksTitle">⚠️ Риски и ликвидность</h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label" id="liquidityLabel">Ликвидность</div>
                            <div class="info-value" id="liquidity">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label" id="districtLabel">Район</div>
                            <div class="info-value" id="district">-</div>
                        </div>
                    </div>
                    <div id="risks-list">
                        <!-- Риски будут добавлены динамически -->
                    </div>
                </div>

                <!-- Экономические графики -->
                <div class="section">
                    <h2 id="economicTrendsTitle">📊 Экономические тренды</h2>
                    <div class="chart-container">
                        <div class="chart-placeholder">
                            📈 График экономических показателей
                        </div>
                    </div>
                </div>

                <!-- Кнопки действий -->
                <div class="buttons">
                    <button class="btn btn-primary" onclick="downloadPDF()" id="downloadPdfBtn">
                        📥 Скачать PDF
                    </button>
                    <button class="btn btn-secondary" onclick="saveReport()" id="saveReportBtn">
                        💾 Сохранить отчет
                    </button>
                    <button class="btn btn-secondary" onclick="goBack()" id="backBtn">
                        ← Назад
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js для построения графиков -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Получаем данные из URL параметров
        const urlParams = new URLSearchParams(window.location.search);
        console.log('🔍 URL параметры:', Object.fromEntries(urlParams));
        
        const reportData = {
            address: urlParams.get('address') || 'Не указано',
            bedrooms: urlParams.get('bedrooms') || 'Не указано',
            price: urlParams.get('price') || 'Не указано',
            age: urlParams.get('age') || 'Не указано',
            floor: urlParams.get('floor') || 'Не указано',
            heating: urlParams.get('heating') || 'Не указано',
            area: urlParams.get('area') || 'Не указано',
            telegram_id: urlParams.get('telegram_id') || '',
            lat: urlParams.get('lat') || '',
            lng: urlParams.get('lng') || '',
            location_codes: JSON.parse(urlParams.get('location_codes') || '{}')
        };
        
        console.log('📋 reportData создан:', reportData);

        // Загружаем полный отчет
        async function loadFullReport() {
            console.log('🚀 Функция loadFullReport вызвана');
            try {
                // Проверяем, что reportData определен
                if (!reportData) {
                    throw new Error('Данные отчета не загружены');
                }
                
                console.log('📋 Данные для загрузки отчета:', reportData);
                
                // Проверяем наличие необходимых элементов DOM
                const loadingElement = document.getElementById('loading');
                const errorElement = document.getElementById('error');
                const reportContentElement = document.getElementById('report-content');
                
                if (!loadingElement || !errorElement || !reportContentElement) {
                    throw new Error('Не найдены необходимые элементы интерфейса');
                }
                
                // Показываем загрузку
                loadingElement.style.display = 'block';
                errorElement.style.display = 'none';
                reportContentElement.style.display = 'none';

                // Проверяем наличие необходимых параметров
                const requiredParams = ['address', 'bedrooms', 'price', 'location_codes'];
                for (const param of requiredParams) {
                    if (!reportData[param]) {
                        throw new Error(`Отсутствует обязательный параметр: ${param}`);
                    }
                }
                
                console.log('📤 Отправляем запрос на /api/full_report с параметрами:', {
                    address: reportData.address,
                    bedrooms: reportData.bedrooms,
                    price: reportData.price,
                    area: reportData.area,
                    lat: reportData.lat,
                    lng: reportData.lng,
                    telegram_id: reportData.telegram_id,
                    location_codes: reportData.location_codes,
                    additional_data: {
                        age: reportData.age,
                        floor: reportData.floor,
                        heating: reportData.heating
                    }
                });

                // Вызываем API для получения полного отчета
                const response = await fetch('/api/full_report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        address: reportData.address,
                        bedrooms: reportData.bedrooms,
                        price: reportData.price,
                        area: reportData.area,
                        lat: reportData.lat,
                        lng: reportData.lng,
                        telegram_id: reportData.telegram_id,
                        location_codes: reportData.location_codes,
                        additional_data: {
                            age: reportData.age,
                            floor: reportData.floor,
                            heating: reportData.heating
                        }
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('❌ HTTP ошибка full_report:', response.status, errorText);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('📊 Ответ API full_report:', data);

                if (data.error) {
                    throw new Error(data.error);
                }
                
                if (!data.full_report) {
                    throw new Error('Сервер не вернул данные полного отчета');
                }

                // Скрываем загрузку и показываем отчет
                loadingElement.style.display = 'none';
                reportContentElement.style.display = 'block';

                // Отладочная информация
                console.log('📊 Получены данные от сервера:', data);
                console.log('🔍 Структура full_report:', data.full_report);

                // Заполняем данные отчета
                try {
                fillReportData(data);
                    console.log('✅ Основной отчет заполнен успешно');
                } catch (error) {
                    console.error('❌ Ошибка заполнения основного отчета:', error);
                    // Показываем сообщение об ошибке
                    const errorElement = document.getElementById('error');
                    if (errorElement) {
                        errorElement.style.display = 'block';
                        document.getElementById('error-message').textContent = `Ошибка заполнения отчета: ${error.message}`;
                    }
                    return;
                }
                
                // Загружаем данные о динамике цен (не блокируем основной отчет)
                if (reportData && reportData.location_codes && reportData.area) {
                    try {
                        await loadPriceTrendsData();
            } catch (error) {
                    console.error('❌ Ошибка загрузки данных о трендах, но отчет продолжает загружаться:', error);
                    // Показываем сообщение об ошибке в блоке трендов
                    const trendAnalysisElement = document.getElementById('trend-analysis');
                    if (trendAnalysisElement) {
                        trendAnalysisElement.textContent = `${getText('trendsError')}: ${error.message}`;
                    }
                    
                    // Заполняем остальные поля значением "Недоступно"
                    const priceTrendElement = document.getElementById('price-trend');
                    if (priceTrendElement) {
                        priceTrendElement.textContent = getText('unavailable');
                    }
                    
                    const priceChangeElement = document.getElementById('price-change-3y');
                    if (priceChangeElement) {
                        priceChangeElement.textContent = getText('unavailable');
                    }
                    
                    const priceForecastElement = document.getElementById('price-forecast');
                    if (priceForecastElement) {
                        priceForecastElement.textContent = getText('unavailable');
                    }
                }
                } else {
                    console.log('⚠️ Отсутствуют необходимые данные для загрузки трендов:', {
                        hasLocationCodes: !!reportData?.location_codes,
                        hasArea: !!reportData?.area
                    });
                    // Показываем сообщение об отсутствии данных
                    const trendAnalysisElement = document.getElementById('trend-analysis');
                    if (trendAnalysisElement) {
                        trendAnalysisElement.textContent = getText('insufficientData');
                    }
                    
                    // Заполняем остальные поля значением "Недоступно"
                    const priceTrendElement = document.getElementById('price-trend');
                    if (priceTrendElement) {
                        priceTrendElement.textContent = getText('unavailable');
                    }
                    
                    const priceChangeElement = document.getElementById('price-change-3y');
                    if (priceChangeElement) {
                        priceChangeElement.textContent = getText('unavailable');
                    }
                    
                    const priceForecastElement = document.getElementById('price-forecast');
                    if (priceForecastElement) {
                        priceForecastElement.textContent = getText('unavailable');
                    }
                }

            } catch (error) {
                console.error('❌ Ошибка загрузки отчета:', error);
                
                // Показываем ошибку, если элементы найдены
                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }
                if (errorElement) {
                    errorElement.style.display = 'block';
                    const errorMessageElement = document.getElementById('error-message');
                    if (errorMessageElement) {
                        errorMessageElement.textContent = error.message || 'Неизвестная ошибка';
                    }
                }
            }
        }
        
        // Загружаем данные о динамике цен
        async function loadPriceTrendsData() {
            // Объявляем переменные в начале функции
            let timeoutId = null;
            let controller = null;
            
            try {
                // Проверяем, что reportData существует и содержит необходимые данные
                if (!reportData || !reportData.location_codes || !reportData.area) {
                    throw new Error('Отсутствуют необходимые данные для загрузки трендов');
                }
                
                console.log('📈 Загружаем данные о динамике цен...');
                console.log('📋 Отправляем данные:', {
                    location_codes: reportData.location_codes,
                    area: reportData.area
                });
                
                // Показываем индикатор загрузки в блоке трендов
                const trendAnalysisElement = document.getElementById('trend-analysis');
                if (trendAnalysisElement) {
                    trendAnalysisElement.textContent = getText('loadingText');
                }
                
                // Создаем AbortController для таймаута
                controller = new AbortController();
                timeoutId = setTimeout(() => {
                    console.log('⏰ Таймаут запроса price_trends (10 секунд)');
                    controller.abort();
                }, 10000); // 10 секунд таймаут
                
                const response = await fetch('/api/price_trends', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        location_codes: reportData.location_codes,
                        area: reportData.area
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                console.log('⏰ Таймаут очищен, ответ получен');

                console.log('📡 Ответ сервера получен, статус:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('❌ HTTP ошибка price_trends:', response.status, errorText);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const trendsData = await response.json();
                console.log('📊 Данные о динамике цен получены:', trendsData);

                if (trendsData.error) {
                    console.error('❌ API вернул ошибку:', trendsData.error);
                    throw new Error(trendsData.error);
                }
                
                if (!trendsData.trend && !trendsData.chart_data) {
                    console.log('⚠️ Сервер вернул пустые данные о трендах');
                    // Показываем сообщение об отсутствии данных
                    const trendAnalysisElement = document.getElementById('trend-analysis');
                    if (trendAnalysisElement) {
                        trendAnalysisElement.textContent = getText('noTrendsData');
                    }
                    
                    // Заполняем остальные поля значением "Недоступно"
                    const priceTrendElement = document.getElementById('price-trend');
                    if (priceTrendElement) {
                        priceTrendElement.textContent = getText('unavailable');
                    }
                    
                    const priceChangeElement = document.getElementById('price-change-3y');
                    if (priceChangeElement) {
                        priceChangeElement.textContent = getText('unavailable');
                    }
                    
                    const priceForecastElement = document.getElementById('price-forecast');
                    if (priceForecastElement) {
                        priceForecastElement.textContent = getText('unavailable');
                    }
                    
                    return;
                }

                // Проверяем, есть ли данные для отображения
                if (!trendsData.chart_data || trendsData.chart_data.length === 0) {
                    console.log('⚠️ Данные о трендах цен отсутствуют');
                    // Показываем сообщение об отсутствии данных
                    const trendAnalysisElement = document.getElementById('trend-analysis');
                    if (trendAnalysisElement) {
                        trendAnalysisElement.textContent = getText('noTrendsData');
                    }
                    
                    // Заполняем остальные поля значением "Недоступно"
                    const priceTrendElement = document.getElementById('price-trend');
                    if (priceTrendElement) {
                        priceTrendElement.textContent = getText('unavailable');
                    }
                    
                    const priceChangeElement = document.getElementById('price-change-3y');
                    if (priceChangeElement) {
                        priceChangeElement.textContent = getText('unavailable');
                    }
                    
                    const priceForecastElement = document.getElementById('price-forecast');
                    if (priceForecastElement) {
                        priceForecastElement.textContent = getText('unavailable');
                    }
                    
                    return;
                }

                // Заполняем данные о трендах
                fillPriceTrendsData(trendsData);
                
                // Строим график
                buildPriceChart(trendsData);
                
                console.log('✅ Загрузка данных о динамике цен завершена успешно');
                
            } catch (error) {
                console.error('❌ Ошибка загрузки данных о динамике цен:', error);
                
                // Очищаем таймаут в случае ошибки
                if (timeoutId) {
                    clearTimeout(timeoutId);
                }
                
                let errorMessage = getText('trendsError');
                if (error.name === 'AbortError') {
                    errorMessage = getText('timeoutError');
                } else if (error.message) {
                    errorMessage = `${getText('trendsError')}: ${error.message}`;
                }
                
                // Показываем сообщение об ошибке в блоке трендов
                const trendAnalysisElement = document.getElementById('trend-analysis');
                if (trendAnalysisElement) {
                    trendAnalysisElement.textContent = errorMessage;
                }
                
                // Также показываем ошибку в других элементах
                const priceTrendElement = document.getElementById('price-trend');
                if (priceTrendElement) {
                    priceTrendElement.textContent = getText('unavailable');
                }
                
                const priceChangeElement = document.getElementById('price-change-3y');
                if (priceChangeElement) {
                    priceChangeElement.textContent = getText('unavailable');
                }
                
                const priceForecastElement = document.getElementById('price-forecast');
                if (priceForecastElement) {
                    priceForecastElement.textContent = getText('unavailable');
                }
            }
        }
        
        // Заполняем данные о трендах цен
        function fillPriceTrendsData(trendsData) {
            try {
                console.log('🔧 Заполняем данные о трендах цен...');
                console.log('📊 Данные для заполнения:', trendsData);
                
                // Тренд цен
                const trendElement = document.getElementById('price-trend');
                if (trendElement && trendsData.trend) {
                    trendElement.textContent = trendsData.trend;
                } else {
                    console.warn('⚠️ Элемент price-trend не найден или данные тренда отсутствуют');
                }
                
                // Изменение за 3 года
                const change3yElement = document.getElementById('price-change-3y');
                if (change3yElement && trendsData.change_3y !== undefined) {
                    const changePercent = trendsData.change_3y;
                    const changeText = changePercent >= 0 ? 
                        `+${changePercent.toFixed(1)}%` : 
                        `${changePercent.toFixed(1)}%`;
                    change3yElement.textContent = changeText;
                } else {
                    console.warn('⚠️ Элемент price-change-3y не найден или данные изменения отсутствуют');
                }
                
                // Прогноз на 3 месяца
                const forecastElement = document.getElementById('price-forecast');
                if (forecastElement && trendsData.forecast_3m !== undefined) {
                    const forecastPercent = trendsData.forecast_3m;
                    const forecastText = forecastPercent >= 0 ? 
                        `+${forecastPercent.toFixed(1)}%` : 
                        `${forecastPercent.toFixed(1)}%`;
                    forecastElement.textContent = forecastText;
                } else {
                    console.warn('⚠️ Элемент price-forecast не найден или данные прогноза отсутствуют');
                }
                
                // Анализ тренда
                const analysisElement = document.getElementById('trend-analysis');
                if (analysisElement && trendsData.analysis) {
                    analysisElement.textContent = trendsData.analysis;
                } else {
                    console.warn('⚠️ Элемент trend-analysis не найден или данные анализа отсутствуют');
                }
                
                // Рекомендация по тренду
                const recommendationElement = document.getElementById('trend-recommendation');
                if (recommendationElement && trendsData.recommendation) {
                    recommendationElement.textContent = trendsData.recommendation;
                } else {
                    console.warn('⚠️ Элемент trend-recommendation не найден или данные рекомендации отсутствуют');
                }
                
                console.log('✅ Данные о трендах цен заполнены');
                
            } catch (error) {
                console.error('❌ Ошибка заполнения данных о трендах цен:', error);
                // Показываем сообщение об ошибке
                const trendAnalysisElement = document.getElementById('trend-analysis');
                if (trendAnalysisElement) {
                    trendAnalysisElement.textContent = `Ошибка заполнения данных: ${error.message}`;
                }
            }
        }
        
        // Строим график динамики цен
        function buildPriceChart(trendsData) {
            try {
                console.log('📊 Строим график динамики цен...');
                
                const ctx = document.getElementById('priceChart');
                if (!ctx) {
                    console.error('Canvas элемент не найден');
                    return;
                }
                
                // Уничтожаем предыдущий график, если он существует
                if (window.priceChart) {
                    window.priceChart.destroy();
                }
                
                const chartData = trendsData.chart_data || [];
                
                if (chartData.length === 0) {
                    console.warn('⚠️ Данные для графика отсутствуют');
                    return;
                }
                
                const labels = chartData.map(item => `${item.month}/${item.year}`);
                const prices = chartData.map(item => item.total_price);
                
                window.priceChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: getText('chartLabel'),
                            data: prices,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: getText('chartTitle')
                            },
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: getText('chartPrice')
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: getText('chartPeriod')
                                }
                            }
                        }
                    }
                });
                
                console.log('✅ График динамики цен построен');
                
            } catch (error) {
                console.error('❌ Ошибка построения графика:', error);
                // Показываем сообщение об ошибке в блоке трендов
                const trendAnalysisElement = document.getElementById('trend-analysis');
                if (trendAnalysisElement) {
                    trendAnalysisElement.textContent = `Ошибка построения графика: ${error.message}`;
                }
            }
        }

        // Заполняем данные отчета
        function fillReportData(data) {
            console.log('🔧 Начинаем заполнение отчета...');
            console.log('📊 Структура данных:', Object.keys(data));
            console.log('📋 Данные full_report:', data.full_report);
            
            // Проверяем существование элементов
            const elements = {
                'object-address': document.getElementById('object-address'),
                'object-bedrooms': document.getElementById('object-bedrooms'),
                'object-price': document.getElementById('object-price'),
                'object-age': document.getElementById('object-age'),
                'object-floor': document.getElementById('object-floor'),
                'object-heating': document.getElementById('object-heating')
            };
            
            // Проверяем, что все элементы найдены
            for (const [id, element] of Object.entries(elements)) {
                if (!element) {
                    console.error(`❌ Элемент ${id} не найден в DOM`);
                    return;
                }
            }
            
            // Основная информация об объекте
            elements['object-address'].textContent = reportData.address;
            elements['object-bedrooms'].textContent = reportData.bedrooms;
            elements['object-price'].textContent = `€${Number(reportData.price).toLocaleString('ru-RU')}`;
            
            // Площадь объекта
            const areaElement = document.getElementById('object-area');
            if (areaElement) {
                const areaValue = reportData.area && reportData.area !== 'unknown' ? 
                    `${reportData.area} м²` : getText('notSpecified');
                areaElement.textContent = areaValue;
            }
            
            // Дополнительные данные - используем новую структуру из full_report
            if (data.full_report && data.full_report.detailed_characteristics) {
                const characteristics = data.full_report.detailed_characteristics;
                console.log('🔍 Найдены характеристики:', characteristics);
                
                // Возраст объекта
                const ageText = characteristics.age && characteristics.age.name ? 
                    characteristics.age.name : 
                    (reportData.age === 'unknown' ? getText('notKnown') : getText('notSpecified'));
                elements['object-age'].textContent = ageText;
                
                // Этаж
                const floorText = characteristics.floor && characteristics.floor.name ? 
                    characteristics.floor.name : 
                    (reportData.floor === 'unknown' ? getText('notKnown') : getText('notSpecified'));
                elements['object-floor'].textContent = floorText;
                
                // Отопление
                const heatingText = characteristics.heating && characteristics.heating.name ? 
                    characteristics.heating.name : 
                    (reportData.heating === 'unknown' ? getText('notKnown') : getText('notSpecified'));
                elements['object-heating'].textContent = heatingText;
                
                console.log('✅ Характеристики объекта загружены:', { ageText, floorText, heatingText });
            } else {
                // Fallback на старые данные
                const ageText = reportData.age === 'unknown' ? getText('notKnown') : reportData.age;
                const floorText = reportData.floor === 'unknown' ? getText('notKnown') : reportData.floor;
                const heatingText = reportData.heating === 'unknown' ? getText('notKnown') : reportData.heating;
                
                elements['object-age'].textContent = ageText;
                elements['object-floor'].textContent = floorText;
                elements['object-heating'].textContent = heatingText;
                
                console.log('⚠️ Используются fallback данные:', { ageText, floorText, heatingText });
            }

            // Рыночный анализ - рыночные данные для сравнения цен
            if (data.full_report && data.full_report.simple_report) {
                const simpleReport = data.full_report.simple_report;
                console.log('📊 Рыночный анализ:', simpleReport);
            }
            
            // Рыночные данные для сравнения цен
            if (data.full_report && data.full_report.market_comparison) {
                const marketComparison = data.full_report.market_comparison;
                console.log('📊 Рыночные данные для сравнения:', marketComparison);
                
                // Заполняем сравнение по возрасту
                if (marketComparison.age) {
                    const ageComparison = marketComparison.age;
                    const ageText = `€${ageComparison.min_price.toLocaleString('ru-RU')} - €${Number(reportData.price).toLocaleString('ru-RU')} - €${ageComparison.max_price.toLocaleString('ru-RU')} (отклонение: ${ageComparison.deviation_min.toFixed(1)}% до ${ageComparison.deviation_max.toFixed(1)}%)`;
                    document.getElementById('age-comparison').textContent = ageText;
                }
                
                // Заполняем сравнение по этажу
                if (marketComparison.floor) {
                    const floorComparison = marketComparison.floor;
                    const floorText = `€${floorComparison.min_price.toLocaleString('ru-RU')} - €${Number(reportData.price).toLocaleString('ru-RU')} - €${floorComparison.max_price.toLocaleString('ru-RU')} (отклонение: ${floorComparison.deviation_min.toFixed(1)}% до ${floorComparison.deviation_max.toFixed(1)}%)`;
                    document.getElementById('floor-comparison').textContent = floorText;
                }
                
                // Заполняем сравнение по отоплению
                if (marketComparison.heating) {
                    const heatingComparison = marketComparison.heating;
                    const heatingText = `€${heatingComparison.min_price.toLocaleString('ru-RU')} - €${Number(reportData.price).toLocaleString('ru-RU')} - €${heatingComparison.max_price.toLocaleString('ru-RU')} (отклонение: ${heatingComparison.deviation_min.toFixed(1)}% до ${heatingComparison.deviation_max.toFixed(1)}%)`;
                    document.getElementById('heating-comparison').textContent = heatingText;
                }
                
                // Заполняем сравнение по типу дома - УБРАНО по требованию
                
                // Заполняем итоговое сравнение
                if (marketComparison.final) {
                    const finalComparison = marketComparison.final;
                    const finalText = `€${finalComparison.avg_min_price.toLocaleString('ru-RU')} - €${Number(reportData.price).toLocaleString('ru-RU')} - €${finalComparison.avg_max_price.toLocaleString('ru-RU')} (отклонение: ${finalComparison.deviation_min.toFixed(1)}% до ${finalComparison.deviation_max.toFixed(1)}%)`;
                    document.getElementById('final-comparison').textContent = finalText;
                }
                
                // Заполняем вывод по цене
                if (marketComparison.price_conclusion) {
                    document.getElementById('price-conclusion').textContent = marketComparison.price_conclusion;
                }
                
                // Показываем информацию о конвертации валют, если она применялась
                if (data.full_report && data.full_report.currency_info) {
                    const currencyInfo = data.full_report.currency_info;
                    if (currencyInfo.conversion_applied) {
                        const currencyElement = document.getElementById('currency-info');
                        const currencyValueElement = document.getElementById('currency-info-value');
                        
                        if (currencyInfo.currency_rate && currencyInfo.currency_rate.try) {
                            const tryRate = currencyInfo.currency_rate.try;
                            const date = new Date(currencyInfo.currency_rate.created_at).toLocaleDateString('ru-RU');
                            currencyValueElement.textContent = getText('currencyRateInfo').replace('{date}', date).replace('{rate}', tryRate.toFixed(4));
                        } else {
                            currencyValueElement.textContent = getText('currencyConverted');
                        }
                        
                        currencyElement.style.display = 'block';
                    }
                }
            }

            // Анализ динамики цен - теперь загружается отдельно через loadPriceTrendsData()

            // Анализ аренды
            if (data.full_report && data.full_report.rental_analysis) {
                const rentalAnalysis = data.full_report.rental_analysis;
                document.getElementById('max-rental-rate').textContent = rentalAnalysis.rental_recommendation || 'Не определен';
                document.getElementById('annual-rental-yield').textContent = rentalAnalysis.annual_yield || 'Не определен';
                document.getElementById('rental-recommendation').textContent = rentalAnalysis.rental_recommendation || 'Не определен';
            }

            // ROI данные
            if (data.full_report && data.full_report.roi) {
                const roiData = data.full_report.roi;
                if (roiData.short_term) {
                    document.getElementById('short-term-income').textContent = `€${roiData.short_term.monthly_income?.toLocaleString('ru-RU') || '-'}`;
                }
                if (roiData.long_term) {
                    document.getElementById('long-term-income').textContent = `€${roiData.long_term.annual_income?.toLocaleString('ru-RU') || '-'}`;
                }
                if (roiData.price_growth) {
                    document.getElementById('price-growth').textContent = `${(roiData.price_growth * 100).toFixed(1)}%`;
                }
                if (roiData.short_term?.roi) {
                    document.getElementById('roi-with-rent').textContent = `${roiData.short_term.roi.toFixed(1)}%`;
                }
                if (roiData.no_rent?.roi) {
                    document.getElementById('roi-without-rent').textContent = `${roiData.no_rent.roi.toFixed(1)}%`;
                }
            }

            // Альтернативные инвестиции
            if (data.full_report && data.full_report.alternatives) {
                const alternativesGrid = document.getElementById('alternatives-grid');
                alternativesGrid.innerHTML = '';
                
                data.full_report.alternatives.forEach(alt => {
                    const altItem = document.createElement('div');
                    altItem.className = 'info-item';
                    altItem.innerHTML = `
                        <div class="info-label">${alt.name}</div>
                        <div class="info-value">${(alt.yield * 100).toFixed(1)}%</div>
                    `;
                    alternativesGrid.appendChild(altItem);
                });
            }

            // Макроэкономические данные
            if (data.full_report && data.full_report.macro) {
                const macroData = data.full_report.macro;
                if (macroData.inflation !== undefined) {
                    document.getElementById('inflation').textContent = `${macroData.inflation.toFixed(1)}%`;
                }
                if (macroData.eur_try !== undefined) {
                    document.getElementById('eur-try').textContent = macroData.eur_try.toFixed(2);
                }
                if (macroData.gdp_growth !== undefined) {
                    document.getElementById('gdp-growth').textContent = `${macroData.gdp_growth.toFixed(1)}%`;
                }
                if (macroData.refi_rate !== undefined) {
                    document.getElementById('refi-rate').textContent = `${macroData.refi_rate.toFixed(1)}%`;
                }
            }

            // Налоги
            if (data.full_report && data.full_report.taxes) {
                const taxesGrid = document.getElementById('taxes-grid');
                taxesGrid.innerHTML = '';
                
                Object.entries(data.full_report.taxes).forEach(([key, value]) => {
                    const taxItem = document.createElement('div');
                    taxItem.className = 'info-item';
                    taxItem.innerHTML = `
                        <div class="info-label">${getTaxLabel(key)}</div>
                        <div class="info-value">${formatTaxValue(value)}</div>
                    `;
                    taxesGrid.appendChild(taxItem);
                });
            }

            // Риски и ликвидность
            if (data.full_report && data.full_report.liquidity) {
                document.getElementById('liquidity').textContent = data.full_report.liquidity;
            }
            if (data.full_report && data.full_report.district) {
                document.getElementById('district').textContent = data.full_report.district;
            }

            // Список рисков
            if (data.full_report && data.full_report.risks && Array.isArray(data.full_report.risks)) {
                const risksList = document.getElementById('risks-list');
                risksList.innerHTML = '';
                
                data.full_report.risks.forEach(risk => {
                    const riskItem = document.createElement('div');
                    riskItem.className = 'info-item';
                    riskItem.style.marginBottom = '10px';
                    riskItem.innerHTML = `
                        <div class="info-value">⚠️ ${risk}</div>
                    `;
                    risksList.appendChild(riskItem);
                });
            }
            
            console.log('✅ Заполнение отчета завершено успешно');
        }

        // Получаем читаемые названия налогов
        function getTaxLabel(key) {
            const labels = {
                'transfer_tax': getText('transferTax'),
                'stamp_duty': getText('stampDuty'),
                'notary': getText('notary'),
                'annual_property_tax': getText('annualPropertyTax'),
                'rental_income_tax': getText('rentalIncomeTax'),
                'capital_gains_tax': getText('capitalGainsTax')
            };
            return labels[key] || key;
        }

        // Форматируем значения налогов
        function formatTaxValue(value) {
            if (typeof value === 'number') {
                if (value < 1) {
                    return `${(value * 100).toFixed(1)}%`;
                } else {
                    return `€${value.toLocaleString('ru-RU')}`;
                }
            }
            return value;
        }

        // Скачать PDF
        function downloadPDF() {
            // Здесь будет логика скачивания PDF
            alert(getText('pdfDownloadSoon'));
        }

        // Сохранить отчет
        function saveReport() {
            // Здесь будет логика сохранения отчета
            alert(getText('saveReportSoon'));
        }

        // Вернуться назад
        function goBack() {
            window.history.back();
        }

        // Загружаем отчет при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 DOM загружен, вызываем loadFullReport');
            loadFullReport();
        });
    </script>

    <!-- Локализация -->
    <script>
        let currentLanguage = 'ru';
        
        // Получаем данные пользователя из Telegram
        async function getUserData() {
            try {
                const userData = window.Telegram.WebApp.initDataUnsafe.user;
                if (!userData) {
                    console.warn('Данные пользователя Telegram недоступны');
                    return null;
                }
                return userData;
            } catch (error) {
                console.error('Ошибка получения данных пользователя:', error);
                return null;
            }
        }
        
        // Словари локализации
        const locales = {
            ru: {
                pageTitleTag: 'Полный отчет - Aaadviser',
                pageTitle: '📊 Полный отчет',
                pageDescription: 'Детальный анализ объекта недвижимости',
                loadingTitle: '🔄 Формируем полный отчет...',
                loadingText: 'Пожалуйста, подождите',
                errorTitle: '❌ Ошибка загрузки отчета',
                objectInfoTitle: '🏠 Информация об объекте',
                addressLabel: 'Адрес',
                bedroomsLabel: 'Спальни',
                priceLabel: 'Цена',
                ageLabel: 'Возраст объекта',
                floorLabel: 'Этаж',
                heatingLabel: 'Отопление',
                areaLabel: 'Площадь объекта',
                marketAnalysisTitle: '📊 Рыночный анализ',
                priceComparisonTitle: '📊 Сравнение с рыночными ценами',
                ageComparisonLabel: 'По возрасту объекта:',
                floorComparisonLabel: 'По этажу:',
                heatingComparisonLabel: 'По типу отопления:',
                finalComparisonLabel: 'Итоговое сравнение:',
                priceConclusionLabel: 'Вывод по цене:',
                currencyInfoLabel: '💱 Конвертация валют:',
                priceTrendsTitle: '📊 Анализ динамики цен',
                priceTrendLabel: 'Тренд цен',
                priceChange3yLabel: 'Изменение за 3 года',
                priceForecastLabel: 'Прогноз на 3 месяца',
                priceChartTitle: '📈 График изменения цен',
                trendAnalysisLabel: 'Анализ тренда:',
                trendRecommendationLabel: 'Рекомендация:',
                rentalAnalysisTitle: '🏠 Анализ аренды',
                maxRentalRateLabel: 'Максимальная ставка аренды',
                annualRentalYieldLabel: 'Годовая доходность',
                rentalRecommendationLabel: 'Рекомендация по аренде',
                roiAnalysisTitle: '💰 ROI анализ',
                shortTermRentTitle: 'Краткосрочная аренда (Airbnb)',
                shortTermIncomeDesc: 'Доход в месяц',
                longTermRentTitle: 'Долгосрочная аренда',
                longTermIncomeDesc: 'Доход в год',
                priceGrowthLabel: 'Рост цены (5 лет)',
                roiWithRentLabel: 'ROI с арендой',
                roiWithoutRentLabel: 'ROI без аренды',
                alternativesTitle: '📈 Альтернативные инвестиции',
                macroDataTitle: '🌍 Макроэкономические данные',
                inflationLabel: 'Инфляция',
                eurTryLabel: 'Курс EUR/TRY',
                gdpGrowthLabel: 'Рост ВВП',
                refiRateLabel: 'Ставка рефинансирования',
                taxesTitle: '🏛️ Налоги и сборы',
                risksTitle: '⚠️ Риски и ликвидность',
                liquidityLabel: 'Ликвидность',
                districtLabel: 'Район',
                economicTrendsTitle: '📊 Экономические тренды',
                downloadPdfBtn: '📥 Скачать PDF',
                saveReportBtn: '💾 Сохранить отчет',
                backBtn: '← Назад',
                notSpecified: 'Не указано',
                notKnown: 'Не известно',
                unavailable: 'Недоступно',
                insufficientData: 'Недостаточно данных для анализа трендов',
                trendsError: 'Ошибка загрузки данных о трендах',
                timeoutError: 'Превышено время ожидания ответа сервера',
                noTrendsData: 'Данные о трендах цен для данной локации отсутствуют',
                chartTitle: 'Динамика цен за 3 года + прогноз на 3 месяца',
                chartLabel: 'Цена объекта (€)',
                chartPeriod: 'Период',
                chartPrice: 'Цена (€)',
                transferTax: 'Налог на передачу',
                stampDuty: 'Гербовый сбор',
                notary: 'Услуги нотариуса',
                annualPropertyTax: 'Годовой налог на недвижимость',
                rentalIncomeTax: 'Налог на доход от аренды',
                capitalGainsTax: 'Налог на прирост капитала',
                currencyRateInfo: 'Курс на {date}: 1 EUR = {rate} TRY. Все цены конвертированы в евро.',
                currencyConverted: 'Все цены конвертированы в евро.',
                pdfDownloadSoon: 'Функция скачивания PDF будет добавлена позже',
                saveReportSoon: 'Функция сохранения отчета будет добавлена позже'
            },
            en: {
                pageTitleTag: 'Full Report - Aaadviser',
                pageTitle: '📊 Full Report',
                pageDescription: 'Detailed real estate analysis',
                loadingTitle: '🔄 Generating full report...',
                loadingText: 'Please wait',
                errorTitle: '❌ Report loading error',
                objectInfoTitle: '🏠 Property Information',
                addressLabel: 'Address',
                bedroomsLabel: 'Bedrooms',
                priceLabel: 'Price',
                ageLabel: 'Property Age',
                floorLabel: 'Floor',
                heatingLabel: 'Heating',
                areaLabel: 'Property Area',
                marketAnalysisTitle: '📊 Market Analysis',
                priceComparisonTitle: '📊 Market Price Comparison',
                ageComparisonLabel: 'By property age:',
                floorComparisonLabel: 'By floor:',
                heatingComparisonLabel: 'By heating type:',
                finalComparisonLabel: 'Final comparison:',
                priceConclusionLabel: 'Price conclusion:',
                currencyInfoLabel: '💱 Currency conversion:',
                priceTrendsTitle: '📊 Price Trends Analysis',
                priceTrendLabel: 'Price trend',
                priceChange3yLabel: 'Change over 3 years',
                priceForecastLabel: '3-month forecast',
                priceChartTitle: '📈 Price Change Chart',
                trendAnalysisLabel: 'Trend analysis:',
                trendRecommendationLabel: 'Recommendation:',
                rentalAnalysisTitle: '🏠 Rental Analysis',
                maxRentalRateLabel: 'Maximum rental rate',
                annualRentalYieldLabel: 'Annual yield',
                rentalRecommendationLabel: 'Rental recommendation',
                roiAnalysisTitle: '💰 ROI Analysis',
                shortTermRentTitle: 'Short-term rental (Airbnb)',
                shortTermIncomeDesc: 'Monthly income',
                longTermRentTitle: 'Long-term rental',
                longTermIncomeDesc: 'Annual income',
                priceGrowthLabel: 'Price growth (5 years)',
                roiWithRentLabel: 'ROI with rental',
                roiWithoutRentLabel: 'ROI without rental',
                alternativesTitle: '📈 Alternative Investments',
                macroDataTitle: '🌍 Macroeconomic Data',
                inflationLabel: 'Inflation',
                eurTryLabel: 'EUR/TRY rate',
                gdpGrowthLabel: 'GDP growth',
                refiRateLabel: 'Refinancing rate',
                taxesTitle: '🏛️ Taxes and Fees',
                risksTitle: '⚠️ Risks and Liquidity',
                liquidityLabel: 'Liquidity',
                districtLabel: 'District',
                economicTrendsTitle: '📊 Economic Trends',
                downloadPdfBtn: '📥 Download PDF',
                saveReportBtn: '💾 Save Report',
                backBtn: '← Back',
                notSpecified: 'Not specified',
                notKnown: 'Not known',
                unavailable: 'Unavailable',
                insufficientData: 'Insufficient data for trend analysis',
                trendsError: 'Error loading trend data',
                timeoutError: 'Server response timeout',
                noTrendsData: 'Price trend data for this location is not available',
                chartTitle: 'Price dynamics over 3 years + 3-month forecast',
                chartLabel: 'Property price (€)',
                chartPeriod: 'Period',
                chartPrice: 'Price (€)',
                transferTax: 'Transfer tax',
                stampDuty: 'Stamp duty',
                notary: 'Notary services',
                annualPropertyTax: 'Annual property tax',
                rentalIncomeTax: 'Rental income tax',
                capitalGainsTax: 'Capital gains tax',
                currencyRateInfo: 'Rate as of {date}: 1 EUR = {rate} TRY. All prices converted to euros.',
                currencyConverted: 'All prices converted to euros.',
                pdfDownloadSoon: 'PDF download function will be added later',
                saveReportSoon: 'Report save function will be added later'
            },
            de: {
                pageTitleTag: 'Vollständiger Bericht - Aaadviser',
                pageTitle: '📊 Vollständiger Bericht',
                pageDescription: 'Detaillierte Immobilienanalyse',
                loadingTitle: '🔄 Vollständigen Bericht erstellen...',
                loadingText: 'Bitte warten',
                errorTitle: '❌ Fehler beim Laden des Berichts',
                objectInfoTitle: '🏠 Objektinformationen',
                addressLabel: 'Adresse',
                bedroomsLabel: 'Schlafzimmer',
                priceLabel: 'Preis',
                ageLabel: 'Objektalter',
                floorLabel: 'Etage',
                heatingLabel: 'Heizung',
                areaLabel: 'Objektfläche',
                marketAnalysisTitle: '📊 Marktanalyse',
                priceComparisonTitle: '📊 Marktpreisvergleich',
                ageComparisonLabel: 'Nach Objektalter:',
                floorComparisonLabel: 'Nach Etage:',
                heatingComparisonLabel: 'Nach Heizungstyp:',
                finalComparisonLabel: 'Endvergleich:',
                priceConclusionLabel: 'Preisbewertung:',
                currencyInfoLabel: '💱 Währungsumrechnung:',
                priceTrendsTitle: '📊 Preistrendanalyse',
                priceTrendLabel: 'Preistrend',
                priceChange3yLabel: 'Änderung über 3 Jahre',
                priceForecastLabel: '3-Monats-Prognose',
                priceChartTitle: '📈 Preisentwicklungsdiagramm',
                trendAnalysisLabel: 'Trendanalyse:',
                trendRecommendationLabel: 'Empfehlung:',
                rentalAnalysisTitle: '🏠 Mietanalyse',
                maxRentalRateLabel: 'Maximale Mietrate',
                annualRentalYieldLabel: 'Jährliche Rendite',
                rentalRecommendationLabel: 'Mietempfehlung',
                roiAnalysisTitle: '💰 ROI-Analyse',
                shortTermRentTitle: 'Kurzzeitmiete (Airbnb)',
                shortTermIncomeDesc: 'Monatliches Einkommen',
                longTermRentTitle: 'Langzeitmiete',
                longTermIncomeDesc: 'Jährliches Einkommen',
                priceGrowthLabel: 'Preiswachstum (5 Jahre)',
                roiWithRentLabel: 'ROI mit Miete',
                roiWithoutRentLabel: 'ROI ohne Miete',
                alternativesTitle: '📈 Alternative Investitionen',
                macroDataTitle: '🌍 Makroökonomische Daten',
                inflationLabel: 'Inflation',
                eurTryLabel: 'EUR/TRY-Kurs',
                gdpGrowthLabel: 'BIP-Wachstum',
                refiRateLabel: 'Refinanzierungssatz',
                taxesTitle: '🏛️ Steuern und Gebühren',
                risksTitle: '⚠️ Risiken und Liquidität',
                liquidityLabel: 'Liquidität',
                districtLabel: 'Bezirk',
                economicTrendsTitle: '📊 Wirtschaftstrends',
                downloadPdfBtn: '📥 PDF herunterladen',
                saveReportBtn: '💾 Bericht speichern',
                backBtn: '← Zurück',
                notSpecified: 'Nicht angegeben',
                notKnown: 'Nicht bekannt',
                unavailable: 'Nicht verfügbar',
                insufficientData: 'Unzureichende Daten für Trendanalyse',
                trendsError: 'Fehler beim Laden der Trenddaten',
                timeoutError: 'Serverantwort-Timeout',
                noTrendsData: 'Preistrenddaten für diesen Standort sind nicht verfügbar',
                chartTitle: 'Preisdynamik über 3 Jahre + 3-Monats-Prognose',
                chartLabel: 'Objektpreis (€)',
                chartPeriod: 'Zeitraum',
                chartPrice: 'Preis (€)',
                transferTax: 'Übertragungssteuer',
                stampDuty: 'Stempelsteuer',
                notary: 'Notardienstleistungen',
                annualPropertyTax: 'Jährliche Grundsteuer',
                rentalIncomeTax: 'Mieteinkommensteuer',
                capitalGainsTax: 'Kapitalgewinnsteuer',
                currencyRateInfo: 'Kurs vom {date}: 1 EUR = {rate} TRY. Alle Preise in Euro umgerechnet.',
                currencyConverted: 'Alle Preise in Euro umgerechnet.',
                pdfDownloadSoon: 'PDF-Download-Funktion wird später hinzugefügt',
                saveReportSoon: 'Bericht-Speicherfunktion wird später hinzugefügt'
            },
            fr: {
                pageTitleTag: 'Rapport Complet - Aaadviser',
                pageTitle: '📊 Rapport Complet',
                pageDescription: 'Analyse détaillée de l\'immobilier',
                loadingTitle: '🔄 Génération du rapport complet...',
                loadingText: 'Veuillez patienter',
                errorTitle: '❌ Erreur de chargement du rapport',
                objectInfoTitle: '🏠 Informations sur le bien',
                addressLabel: 'Adresse',
                bedroomsLabel: 'Chambres',
                priceLabel: 'Prix',
                ageLabel: 'Âge du bien',
                floorLabel: 'Étage',
                heatingLabel: 'Chauffage',
                areaLabel: 'Surface du bien',
                marketAnalysisTitle: '📊 Analyse du marché',
                priceComparisonTitle: '📊 Comparaison des prix du marché',
                ageComparisonLabel: 'Par âge du bien:',
                floorComparisonLabel: 'Par étage:',
                heatingComparisonLabel: 'Par type de chauffage:',
                finalComparisonLabel: 'Comparaison finale:',
                priceConclusionLabel: 'Conclusion sur le prix:',
                currencyInfoLabel: '💱 Conversion de devise:',
                priceTrendsTitle: '📊 Analyse des tendances de prix',
                priceTrendLabel: 'Tendance des prix',
                priceChange3yLabel: 'Évolution sur 3 ans',
                priceForecastLabel: 'Prévision 3 mois',
                priceChartTitle: '📈 Graphique d\'évolution des prix',
                trendAnalysisLabel: 'Analyse de tendance:',
                trendRecommendationLabel: 'Recommandation:',
                rentalAnalysisTitle: '🏠 Analyse de location',
                maxRentalRateLabel: 'Taux de location maximum',
                annualRentalYieldLabel: 'Rendement annuel',
                rentalRecommendationLabel: 'Recommandation de location',
                roiAnalysisTitle: '💰 Analyse ROI',
                shortTermRentTitle: 'Location courte durée (Airbnb)',
                shortTermIncomeDesc: 'Revenus mensuels',
                longTermRentTitle: 'Location longue durée',
                longTermIncomeDesc: 'Revenus annuels',
                priceGrowthLabel: 'Croissance des prix (5 ans)',
                roiWithRentLabel: 'ROI avec location',
                roiWithoutRentLabel: 'ROI sans location',
                alternativesTitle: '📈 Investissements alternatifs',
                macroDataTitle: '🌍 Données macroéconomiques',
                inflationLabel: 'Inflation',
                eurTryLabel: 'Taux EUR/TRY',
                gdpGrowthLabel: 'Croissance du PIB',
                refiRateLabel: 'Taux de refinancement',
                taxesTitle: '🏛️ Taxes et frais',
                risksTitle: '⚠️ Risques et liquidité',
                liquidityLabel: 'Liquidité',
                districtLabel: 'Quartier',
                economicTrendsTitle: '📊 Tendances économiques',
                downloadPdfBtn: '📥 Télécharger PDF',
                saveReportBtn: '💾 Sauvegarder rapport',
                backBtn: '← Retour',
                notSpecified: 'Non spécifié',
                notKnown: 'Non connu',
                unavailable: 'Non disponible',
                insufficientData: 'Données insuffisantes pour l\'analyse des tendances',
                trendsError: 'Erreur de chargement des données de tendance',
                timeoutError: 'Délai d\'attente de réponse du serveur',
                noTrendsData: 'Données de tendance des prix pour cet emplacement non disponibles',
                chartTitle: 'Dynamique des prix sur 3 ans + prévision 3 mois',
                chartLabel: 'Prix du bien (€)',
                chartPeriod: 'Période',
                chartPrice: 'Prix (€)',
                transferTax: 'Taxe de transfert',
                stampDuty: 'Droit de timbre',
                notary: 'Services de notaire',
                annualPropertyTax: 'Taxe foncière annuelle',
                rentalIncomeTax: 'Taxe sur les revenus locatifs',
                capitalGainsTax: 'Taxe sur les plus-values',
                currencyRateInfo: 'Taux au {date}: 1 EUR = {rate} TRY. Tous les prix convertis en euros.',
                currencyConverted: 'Tous les prix convertis en euros.',
                pdfDownloadSoon: 'Fonction de téléchargement PDF sera ajoutée plus tard',
                saveReportSoon: 'Fonction de sauvegarde du rapport sera ajoutée plus tard'
            },
            tr: {
                pageTitleTag: 'Tam Rapor - Aaadviser',
                pageTitle: '📊 Tam Rapor',
                pageDescription: 'Detaylı emlak analizi',
                loadingTitle: '🔄 Tam rapor oluşturuluyor...',
                loadingText: 'Lütfen bekleyin',
                errorTitle: '❌ Rapor yükleme hatası',
                objectInfoTitle: '🏠 Mülk Bilgileri',
                addressLabel: 'Adres',
                bedroomsLabel: 'Yatak odası',
                priceLabel: 'Fiyat',
                ageLabel: 'Mülk yaşı',
                floorLabel: 'Kat',
                heatingLabel: 'Isıtma',
                areaLabel: 'Mülk alanı',
                marketAnalysisTitle: '📊 Pazar Analizi',
                priceComparisonTitle: '📊 Pazar Fiyat Karşılaştırması',
                ageComparisonLabel: 'Mülk yaşına göre:',
                floorComparisonLabel: 'Kata göre:',
                heatingComparisonLabel: 'Isıtma tipine göre:',
                finalComparisonLabel: 'Final karşılaştırma:',
                priceConclusionLabel: 'Fiyat sonucu:',
                currencyInfoLabel: '💱 Döviz çevirisi:',
                priceTrendsTitle: '📊 Fiyat Trend Analizi',
                priceTrendLabel: 'Fiyat trendi',
                priceChange3yLabel: '3 yıldaki değişim',
                priceForecastLabel: '3 aylık tahmin',
                priceChartTitle: '📈 Fiyat Değişim Grafiği',
                trendAnalysisLabel: 'Trend analizi:',
                trendRecommendationLabel: 'Öneri:',
                rentalAnalysisTitle: '🏠 Kiralama Analizi',
                maxRentalRateLabel: 'Maksimum kiralama oranı',
                annualRentalYieldLabel: 'Yıllık getiri',
                rentalRecommendationLabel: 'Kiralama önerisi',
                roiAnalysisTitle: '💰 ROI Analizi',
                shortTermRentTitle: 'Kısa vadeli kiralama (Airbnb)',
                shortTermIncomeDesc: 'Aylık gelir',
                longTermRentTitle: 'Uzun vadeli kiralama',
                longTermIncomeDesc: 'Yıllık gelir',
                priceGrowthLabel: 'Fiyat artışı (5 yıl)',
                roiWithRentLabel: 'Kiralama ile ROI',
                roiWithoutRentLabel: 'Kiralama olmadan ROI',
                alternativesTitle: '📈 Alternatif Yatırımlar',
                macroDataTitle: '🌍 Makroekonomik Veriler',
                inflationLabel: 'Enflasyon',
                eurTryLabel: 'EUR/TRY kuru',
                gdpGrowthLabel: 'GSYİH büyümesi',
                refiRateLabel: 'Refinansman oranı',
                taxesTitle: '🏛️ Vergiler ve Harçlar',
                risksTitle: '⚠️ Riskler ve Likidite',
                liquidityLabel: 'Likidite',
                districtLabel: 'İlçe',
                economicTrendsTitle: '📊 Ekonomik Trendler',
                downloadPdfBtn: '📥 PDF İndir',
                saveReportBtn: '💾 Raporu Kaydet',
                backBtn: '← Geri',
                notSpecified: 'Belirtilmemiş',
                notKnown: 'Bilinmiyor',
                unavailable: 'Mevcut değil',
                insufficientData: 'Trend analizi için yetersiz veri',
                trendsError: 'Trend verilerini yükleme hatası',
                timeoutError: 'Sunucu yanıt zaman aşımı',
                noTrendsData: 'Bu konum için fiyat trend verileri mevcut değil',
                chartTitle: '3 yıllık fiyat dinamikleri + 3 aylık tahmin',
                chartLabel: 'Mülk fiyatı (€)',
                chartPeriod: 'Dönem',
                chartPrice: 'Fiyat (€)',
                transferTax: 'Transfer vergisi',
                stampDuty: 'Damga vergisi',
                notary: 'Noter hizmetleri',
                annualPropertyTax: 'Yıllık emlak vergisi',
                rentalIncomeTax: 'Kiralama gelir vergisi',
                capitalGainsTax: 'Sermaye kazancı vergisi',
                currencyRateInfo: '{date} tarihli kur: 1 EUR = {rate} TRY. Tüm fiyatlar euroya çevrildi.',
                currencyConverted: 'Tüm fiyatlar euroya çevrildi.',
                pdfDownloadSoon: 'PDF indirme işlevi daha sonra eklenecek',
                saveReportSoon: 'Rapor kaydetme işlevi daha sonra eklenecek'
            }
        };
        
        // Функция получения текста по ключу
        function getText(key) {
            return locales[currentLanguage][key] || key;
        }
        
        // Функция обновления текста на странице
        function updatePageText() {
            // Обновляем title
            document.getElementById('pageTitleTag').textContent = getText('pageTitleTag');
            
            // Обновляем основные элементы
            const elements = [
                'pageTitle', 'pageDescription', 'loadingTitle', 'loadingText', 'errorTitle',
                'objectInfoTitle', 'addressLabel', 'bedroomsLabel', 'priceLabel', 'ageLabel',
                'floorLabel', 'heatingLabel', 'areaLabel', 'marketAnalysisTitle', 'priceComparisonTitle',
                'ageComparisonLabel', 'floorComparisonLabel', 'heatingComparisonLabel', 'finalComparisonLabel',
                'priceConclusionLabel', 'currencyInfoLabel', 'priceTrendsTitle', 'priceTrendLabel',
                'priceChange3yLabel', 'priceForecastLabel', 'priceChartTitle', 'trendAnalysisLabel',
                'trendRecommendationLabel', 'rentalAnalysisTitle', 'maxRentalRateLabel', 'annualRentalYieldLabel',
                'rentalRecommendationLabel', 'roiAnalysisTitle', 'shortTermRentTitle', 'shortTermIncomeDesc',
                'longTermRentTitle', 'longTermIncomeDesc', 'priceGrowthLabel', 'roiWithRentLabel',
                'roiWithoutRentLabel', 'alternativesTitle', 'macroDataTitle', 'inflationLabel',
                'eurTryLabel', 'gdpGrowthLabel', 'refiRateLabel', 'taxesTitle', 'risksTitle',
                'liquidityLabel', 'districtLabel', 'economicTrendsTitle', 'downloadPdfBtn',
                'saveReportBtn', 'backBtn'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = getText(id);
                }
            });
        }
        
        // Функция инициализации локализации
        async function initLocalization() {
            try {
                const userData = await getUserData();
                if (userData && userData.language_code) {
                    // Проверяем, является ли пользователь админом
                    const response = await fetch('/api/user', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            telegram_id: userData.id,
                            username: userData.username,
                            tg_name: userData.first_name,
                            last_name: userData.last_name,
                            language_code: userData.language_code
                        })
                    });
                    
                    if (response.ok) {
                        const userInfo = await response.json();
                        
                        // Устанавливаем язык в зависимости от статуса пользователя
                        if (userInfo.user_status === 'admin' && userInfo.language) {
                            // Для админов используем язык из базы данных
                            currentLanguage = userInfo.language;
                        } else if (userData.language_code) {
                            // Для обычных пользователей используем язык из Telegram
                            currentLanguage = userData.language_code;
                        }
                        
                        // Обновляем текст на странице с новым языком
                        updatePageText();
                    }
                }
            } catch (error) {
                console.error('Ошибка инициализации локализации:', error);
                // Используем русский язык по умолчанию
                currentLanguage = 'ru';
                updatePageText();
            }
        }
        
        // Инициализируем локализацию при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            initLocalization();
        });
    </script>
    <script src="/i18n-manager.js"></script>
</body>
</html>
