<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="/i18n-manager.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n-title="common.help">–ü–æ–º–æ—â—å ‚Äî Aaadviser</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f8f9fa; margin: 0; }
        .container { max-width: 400px; margin: 40px auto; background: #fff; border-radius: 16px; box-shadow: 0 2px 12px rgba(102,126,234,0.10); padding: 32px 20px 24px 20px; text-align: center; }
        .logo { width: 110px; height: auto; display: block; margin: 0 auto 18px auto; cursor: pointer; transition: transform 0.2s; }
        .logo:hover { transform: scale(1.05); }
        .title { font-size: 1.3em; font-weight: bold; margin-bottom: 18px; color: #333; }
        .help-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border: none; border-radius: 12px; padding: 18px 20px; font-size: 16px; font-weight: 500; cursor: pointer; margin: 12px 0; width: 100%; text-align: left; transition: all 0.2s; box-shadow: 0 2px 8px rgba(102,126,234,0.15); display: flex; align-items: center; gap: 12px; }
        .help-btn:hover { background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); }
        .help-btn-icon { font-size: 20px; margin-right: 10px; }
        .back-btn { margin-top: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border: none; border-radius: 10px; padding: 14px 28px; font-size: 1em; font-weight: 500; cursor: pointer; transition: background 0.2s; width: 100%; }
        .back-btn:hover { background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); }
    </style>
</head>
<body>
    <div class="container">
        <img src="logo-flt.png" alt="Aaadviser" class="logo" onclick="goToMainMenu()">
        <div class="title" id="helpTitle">–ü–æ–º–æ—â—å</div>
        <button class="help-btn" onclick="aboutApp()" id="aboutAppBtn"><span class="help-btn-icon">‚ÑπÔ∏è</span>–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</button>
        <button class="help-btn" onclick="showInstruction()" id="instructionBtn"><span class="help-btn-icon">üìñ</span>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</button>
        <button class="help-btn" onclick="showGeo()" id="geographyBtn"><span class="help-btn-icon">üåç</span>–ù–∞—à–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏—è</button>
        <button class="help-btn" onclick="showSupport()" id="supportBtn"><span class="help-btn-icon">üõ†Ô∏è</span>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</button>
        <button class="back-btn" onclick="goToMainMenu()" id="backBtn">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
    </div>
    <script>
        let currentLanguage = 'ru';

        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function getUserData() {
            let tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
            if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                return tg.initDataUnsafe.user;
            }
            return null;
        }

        // –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
        const locales = {
            'ru': {
                'helpTitle': '–ü–æ–º–æ—â—å',
                'aboutAppBtn': '–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏',
                'instructionBtn': '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è',
                'geographyBtn': '–ù–∞—à–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏—è',
                'supportBtn': '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞',
                'backBtn': '–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é'
            },
            'en': {
                'helpTitle': 'Help',
                'aboutAppBtn': 'About the App',
                'instructionBtn': 'Instructions',
                'geographyBtn': 'Our Geography',
                'supportBtn': 'Technical Support',
                'backBtn': 'Back to Main Menu'
            },
            'de': {
                'helpTitle': 'Hilfe',
                'aboutAppBtn': '√úber die App',
                'instructionBtn': 'Anleitung',
                'geographyBtn': 'Unsere Geographie',
                'supportBtn': 'Technischer Support',
                'backBtn': 'Zur√ºck zum Hauptmen√º'
            },
            'fr': {
                'helpTitle': 'Aide',
                'aboutAppBtn': '√Ä propos de l\'app',
                'instructionBtn': 'Instructions',
                'geographyBtn': 'Notre g√©ographie',
                'supportBtn': 'Support technique',
                'backBtn': 'Retour au menu principal'
            },
            'tr': {
                'helpTitle': 'Yardƒ±m',
                'aboutAppBtn': 'Uygulama Hakkƒ±nda',
                'instructionBtn': 'Talimatlar',
                'geographyBtn': 'Coƒürafyamƒ±z',
                'supportBtn': 'Teknik Destek',
                'backBtn': 'Ana Men√ºye D√∂n'
            }
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
        function getText(key) {
            const locale = locales[currentLanguage] || locales['ru'];
            return locale[key] || key;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function updatePageText() {
            document.getElementById('helpTitle').textContent = getText('helpTitle');
            document.getElementById('aboutAppBtn').textContent = getText('aboutAppBtn');
            document.getElementById('instructionBtn').textContent = getText('instructionBtn');
            document.getElementById('geographyBtn').textContent = getText('geographyBtn');
            document.getElementById('supportBtn').textContent = getText('supportBtn');
            document.getElementById('backBtn').textContent = getText('backBtn');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function init() {
            const userData = getUserData();
            if (!userData) {
                updatePageText();
                return;
            }

            try {
                const response = await fetch('/api/user', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        telegram_id: userData.id,
                        username: userData.username,
                        tg_name: userData.tg_name,
                        last_name: userData.last_name,
                        language_code: userData.language_code || 'ru'
                    })
                });

                if (response.ok) {
                    const userInfo = await response.json();
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —è–∑—ã–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    if (userInfo.user_status === 'admin' && userInfo.language) {
                        // –î–ª—è –∞–¥–º–∏–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º —è–∑—ã–∫ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                        currentLanguage = userInfo.language;
                    } else if (userData.language_code) {
                        // –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º —è–∑—ã–∫ –∏–∑ Telegram
                        currentLanguage = userData.language_code;
                    }
                }
            } catch (error) {
                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —è–∑—ã–∫ –∏–∑ Telegram
                if (userData.language_code) {
                    currentLanguage = userData.language_code;
                }
            }
            
            updatePageText();
        }

        function goToMainMenu() {
            window.location.href = '/webapp';
        }
        function aboutApp() {
            window.location.href = '/webapp_about';
        }
        function showInstruction() {
            window.location.href = '/webapp_instruction';
        }
        function showGeo() {
            window.location.href = '/webapp_geography';
        }
        function showSupport() {
            window.location.href = '/webapp_support';
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
        init();
    </script>
</body>
</html> 