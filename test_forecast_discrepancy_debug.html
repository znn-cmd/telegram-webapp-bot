<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ—Ç–ª–∞–¥–∫–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –≤ –ø—Ä–æ–≥–Ω–æ–∑–µ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .discrepancy-highlight {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .data-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .data-panel {
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 5px;
        }
        .data-panel h3 {
            margin-top: 0;
            color: #495057;
        }
        .data-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #f8f9fa;
        }
        .data-row:last-child {
            border-bottom: none;
        }
        .price-value {
            font-weight: bold;
            color: #28a745;
        }
        .price-diff {
            color: #dc3545;
            font-weight: bold;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .console-output {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç –æ—Ç–ª–∞–¥–∫–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –≤ –ø—Ä–æ–≥–Ω–æ–∑–µ</h1>
    
    <div class="test-section">
        <h2>–ü—Ä–æ–±–ª–µ–º–∞</h2>
        <div class="discrepancy-highlight">
            <strong>–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ:</strong><br>
            ‚Ä¢ <strong>–¢–∞–±–ª–∏—Ü–∞</strong> –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–ª—è –∏—é–ª—è 2025: <span class="price-value">‚Ç∫50,933.66</span><br>
            ‚Ä¢ <strong>–ì—Ä–∞—Ñ–∏–∫</strong> –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–ª—è –∏—é–ª—è 2025: <span class="price-value">‚Ç∫48,035.00</span><br>
            ‚Ä¢ <strong>–†–∞–∑–Ω–∏—Ü–∞:</strong> <span class="price-diff">‚Ç∫2,898.66</span>
        </div>
        
        <p>–≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É —Ç–∞–±–ª–∏—Ü–∞ –∏ –≥—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ –¥–∞–Ω–Ω—ã—Ö.</p>
    </div>

    <div class="test-section">
        <h2>–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
        <p>–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ –∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:</p>
        
        <div class="data-comparison">
            <div class="data-panel">
                <h3>–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (property_trends)</h3>
                <div class="data-row">
                    <span>–ò—é–ª—å 2025 - unit_price_for_sale:</span>
                    <span class="price-value">‚Ç∫48,035.00</span>
                </div>
                <div class="data-row">
                    <span>–ò—é–ª—å 2025 - unit_price_for_rent:</span>
                    <span class="price-value">‚Ç∫197.06</span>
                </div>
                <div class="data-row">
                    <span>–ò—é–ª—å 2025 - price_change_sale:</span>
                    <span>+2.25%</span>
                </div>
                <div class="data-row">
                    <span>–ò—é–ª—å 2025 - price_change_rent:</span>
                    <span>+1.85%</span>
                </div>
            </div>
            
            <div class="data-panel">
                <h3>–ë–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã (–∏–∑ 4 —Ç–∞–±–ª–∏—Ü)</h3>
                <div class="data-row">
                    <span>–ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏:</span>
                    <span class="price-value">‚Ç∫50,933.66</span>
                </div>
                <div class="data-row">
                    <span>–ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã:</span>
                    <span class="price-value">‚Ç∫204.81</span>
                </div>
                <div class="data-row">
                    <span>–ò—Å—Ç–æ—á–Ω–∏–∫:</span>
                    <span>age_data, floor_segment_data, heating_data, house_type_data</span>
                </div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ä–∞—Å—á–µ—Ç–∞</h2>
        <button onclick="testCalculationLogic()">–¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ —Ä–∞—Å—á–µ—Ç–∞</button>
        <button onclick="testDataFlow()">–¢–µ—Å—Ç –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö</button>
        <button onclick="clearConsole()">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å</button>
        
        <div class="console-output" id="consoleOutput">
            <div>–ö–æ–Ω—Å–æ–ª—å –æ—Ç–ª–∞–¥–∫–∏...</div>
        </div>
    </div>

    <div class="test-section">
        <h2>–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã</h2>
        <h3>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è:</h3>
        <ol>
            <li><strong>–†–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö:</strong> –¢–∞–±–ª–∏—Ü–∞ –∏ –≥—Ä–∞—Ñ–∏–∫ –º–æ–≥—É—Ç –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è</li>
            <li><strong>–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–ª–∞–≥–æ–º is_price_calculated:</strong> –í–æ–∑–º–æ–∂–Ω–æ, —Ñ–ª–∞–≥ –Ω–µ –≤—Å–µ–≥–¥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è</li>
            <li><strong>–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:</strong> –ì—Ä–∞—Ñ–∏–∫ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</li>
            <li><strong>–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:</strong> –¢–∞–±–ª–∏—Ü–∞ –∏ –≥—Ä–∞—Ñ–∏–∫ –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è</li>
        </ol>
        
        <h3>–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –º–æ–º–µ–Ω—Ç—ã:</h3>
        <ul>
            <li>‚úÖ –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω –≤ prepareTrendsWithHistoricalPrices</li>
            <li>‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ is_price_calculated</li>
            <li>‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ calculated_sale_price vs unit_price_for_sale</li>
            <li>‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–µ–π –∏ –≥—Ä–∞—Ñ–∏–∫–æ–º</li>
        </ul>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª—å
        function log(message, type = 'info') {
            const consoleOutput = document.getElementById('consoleOutput');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #6c757d;">[${timestamp}]</span> ${message}`;
            
            if (type === 'error') {
                logEntry.style.color = '#dc3545';
            } else if (type === 'warning') {
                logEntry.style.color = '#ffc107';
            } else if (type === 'success') {
                logEntry.style.color = '#28a745';
            }
            
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        // –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Å–æ–ª–∏
        function clearConsole() {
            document.getElementById('consoleOutput').innerHTML = '<div>–ö–æ–Ω—Å–æ–ª—å –æ—á–∏—â–µ–Ω–∞...</div>';
        }

        // –¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ —Ä–∞—Å—á–µ—Ç–∞
        function testCalculationLogic() {
            log('üßÆ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω...', 'info');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ property_trends
            const originalTrend = {
                property_year: 2025,
                property_month: 7,
                unit_price_for_sale: 48035.00,
                unit_price_for_rent: 197.06,
                price_change_sale: 0.0225, // 2.25%
                price_change_rent: 0.0185  // 1.85%
            };
            
            log(`üìä –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏—é–ª—è 2025:`, 'info');
            log(`   - unit_price_for_sale: ‚Ç∫${originalTrend.unit_price_for_sale.toLocaleString('ru-RU')}`, 'info');
            log(`   - unit_price_for_rent: ‚Ç∫${originalTrend.unit_price_for_rent.toLocaleString('ru-RU')}`, 'info');
            log(`   - price_change_sale: ${(originalTrend.price_change_sale * 100).toFixed(2)}%`, 'info');
            log(`   - price_change_rent: ${(originalTrend.price_change_rent * 100).toFixed(2)}%`, 'info');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –±–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã –∏–∑ 4 —Ç–∞–±–ª–∏—Ü
            const basePrices = {
                sale_price: 50933.66,
                rent_price: 204.81
            };
            
            log(`üí∞ –ë–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã –∏–∑ 4 —Ç–∞–±–ª–∏—Ü:`, 'info');
            log(`   - sale_price: ‚Ç∫${basePrices.sale_price.toLocaleString('ru-RU')}`, 'info');
            log(`   - rent_price: ‚Ç∫${basePrices.rent_price.toLocaleString('ru-RU')}`, 'info');
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É —Ä–∞—Å—á–µ—Ç–∞
            log(`üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É —Ä–∞—Å—á–µ—Ç–∞:`, 'info');
            
            // –î–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞ (–∏—é–ª—å 2025) –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã
            const isCurrentMonth = true; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –∏—é–ª—å 2025 - —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
            
            if (isCurrentMonth) {
                log(`   ‚úÖ –ò—é–ª—å 2025 - —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü, –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã`, 'success');
                log(`   - calculated_sale_price: ‚Ç∫${basePrices.sale_price.toLocaleString('ru-RU')}`, 'success');
                log(`   - calculated_rent_price: ‚Ç∫${basePrices.rent_price.toLocaleString('ru-RU')}`, 'success');
                log(`   - is_price_calculated: true`, 'success');
            } else {
                log(`   ‚ùå –ò—é–ª—å 2025 - –Ω–µ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü`, 'error');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—É—á–∏—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
            log(`üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:`, 'info');
            log(`   - –¢–∞–±–ª–∏—Ü–∞ (calculated_sale_price): ‚Ç∫${basePrices.sale_price.toLocaleString('ru-RU')}`, 'info');
            log(`   - –ì—Ä–∞—Ñ–∏–∫ (unit_price_for_sale): ‚Ç∫${originalTrend.unit_price_for_sale.toLocaleString('ru-RU')}`, 'info');
            log(`   - –†–∞–∑–Ω–∏—Ü–∞: ‚Ç∫${(basePrices.sale_price - originalTrend.unit_price_for_sale).toLocaleString('ru-RU')}`, 'warning');
            
            log(`üéØ –í—ã–≤–æ–¥: –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏–∑-–∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö!`, 'warning');
        }

        // –¢–µ—Å—Ç –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function testDataFlow() {
            log('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö...', 'info');
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
            log(`1Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ property_trends`, 'info');
            log(`2Ô∏è‚É£ –í—ã–∑–æ–≤ prepareTrendsWithHistoricalPrices()`, 'info');
            log(`3Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ü–µ–Ω –∏–∑ 4 —Ç–∞–±–ª–∏—Ü`, 'info');
            log(`4Ô∏è‚É£ –†–∞—Å—á–µ—Ç —Ü–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞`, 'info');
            log(`5Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ is_price_calculated`, 'info');
            log(`6Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å calculated_sale_price`, 'info');
            log(`7Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π is_price_calculated`, 'info');
            
            log(`‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —à–∞–≥–µ 5Ô∏è‚É£ –∏–ª–∏ 7Ô∏è‚É£`, 'warning');
            log(`   - –§–ª–∞–≥ is_price_calculated –º–æ–∂–µ—Ç –±—ã—Ç—å false`, 'warning');
            log(`   - –ì—Ä–∞—Ñ–∏–∫ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å unit_price_for_sale –≤–º–µ—Å—Ç–æ calculated_sale_price`, 'warning');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é', 'success');
            log('üí° –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤', 'info');
        });
    </script>
</body>
</html>
