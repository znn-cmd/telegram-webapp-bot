<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aaadviser - –û—Ü–µ–Ω–∫–∞ –æ–±—ä–µ–∫—Ç–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* Header Styles */
        .page-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            text-align: center;
            margin: 20px 0 10px 0;
        }

        .page-description {
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        /* Form Styles */
        .location-form {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
        }

        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            color: #333;
        }

        .form-group select:disabled {
            background: #f5f5f5;
            color: #999;
            cursor: not-allowed;
        }

        .confirm-button {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .confirm-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .confirm-button:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        /* Listing Type Selection Styles */
        .listing-type-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #e0e0e0;
        }

        .listing-type-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            text-align: center;
        }

        .listing-type-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .listing-type-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }
        
        .listing-type-select:hover {
            border-color: #667eea;
        }

        .listing-type-group {
            margin-bottom: 15px;
        }

        .listing-type-subtitle {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
            padding-left: 4px;
        }

        /* Selected Location Styles */
        .selected-location {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .location-title {
            font-size: 16px;
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .location-details {
            font-size: 14px;
            color: #333;
            line-height: 1.4;
        }

        .selected-property-types {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #4caf50;
        }

        .property-types-title {
            font-size: 14px;
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 8px;
        }

        .property-types-details {
            font-size: 13px;
            color: #333;
            line-height: 1.4;
        }

        .property-type-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            border-bottom: 1px solid #e8f5e8;
        }

        .property-type-item:last-child {
            border-bottom: none;
        }

        .property-type-label {
            font-weight: 500;
            color: #2e7d32;
        }

        .property-type-value {
            color: #333;
            font-weight: 600;
        }

        .admin-ids {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #4caf50;
        }

        .admin-title {
            font-size: 14px;
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 5px;
        }

        .admin-details {
            font-size: 12px;
            color: #666;
            font-family: monospace;
        }

        /* Key Metrics Styles */
        .key-metrics-section {
            margin-bottom: 20px;
        }

        .key-metrics-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            text-align: center;
            margin-bottom: 15px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .metric-card {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .metric-card.yield-card {
            grid-column: 1 / -1;
            background: #f0f0f0;
        }

        .metric-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            line-height: 1.2;
        }

        .metric-value {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .yield-label {
            font-size: 17px;
        }

        .yield-value {
            font-size: 17px;
        }

        /* Insights Styles */
        .insights-section {
            margin: 20px 0;
        }

        .insights-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .insights-header {
            background: #f8f9fa;
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .insights-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .insights-content {
            padding: 15px;
        }

        .insights-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 20px;
        }

        .loading-spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            font-size: 14px;
            color: #666;
            text-align: center;
        }

        .insights-text {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
            padding: 8px 0;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            max-width: 100%;
        }

        .insights-error {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px;
            color: #721c24;
        }

        .insights-error .error-icon {
            font-size: 24px;
        }

        .insights-error .error-text {
            font-size: 14px;
            text-align: center;
        }

        /* Data Card Styles */
        .data-content {
            margin-bottom: 20px;
        }

        .data-section {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 20px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .data-section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin: 0 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .data-section-content {
            padding: 0;
        }
        
        .data-item {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .data-item-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin: 0 0 12px 0;
        }
        
        .data-available {
            padding: 15px;
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 6px;
            color: #2e7d32;
            font-size: 14px;
            text-align: center;
            font-weight: 500;
        }
        
        .summary-table {
            margin-top: 20px;
        }
        
        .summary-table th {
            background: #667eea;
            color: white;
            padding: 12px 8px;
            font-weight: 600;
            text-align: center;
        }
        
        .summary-table td {
            padding: 10px 8px;
            text-align: center;
        }
        
        .summary-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .section-header {
            background: #667eea !important;
            color: white;
            font-weight: 700;
            text-align: center;
        }
        
        .sale-header {
            background: #28a745 !important;
        }
        
        .rent-header {
            background: #17a2b8 !important;
        }
        
        .yield-header {
            background: #ffc107 !important;
            color: #212529;
            font-weight: 800;
            font-size: 18px;
        }
        
        .yield-data {
            background: #fff3cd !important;
        }
        
        .yield-label {
            font-weight: 700;
            color: #856404;
        }
        
        .yield-value {
            font-weight: 700;
            color: #856404;
        }
        
        /* Property Trends Styles */
        .trends-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .trend-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .trend-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .trend-title {
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }
        
        .trend-value {
            font-size: 18px;
            font-weight: 700;
            color: #28a745;
            margin-bottom: 5px;
        }
        
        .trend-period {
            font-size: 12px;
            color: #6c757d;
            font-style: italic;
        }
        
        .trend-details {
            margin-top: 8px;
        }
        
        .trend-change {
            font-size: 11px;
            color: #495057;
            margin-bottom: 4px;
            line-height: 1.3;
        }
        
        .trend-date {
            font-size: 10px;
            color: #6c757d;
            font-style: italic;
        }
        
                .trend-card-price_trend {
            border-left: 4px solid #28a745;
        }

        .trend-card-price {
            border-left: 4px solid #28a745;
        }

        .trend-card-yield_trend {
            border-left: 4px solid #ffc107;
        }

        .trend-card-count_trend {
            border-left: 4px solid #17a2b8;
        }

        .price-comparison {
            font-size: 12px;
            color: #495057;
            margin-top: 6px;
            line-height: 1.3;
            padding: 4px 8px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 3px solid #28a745;
        }
        
        /* Trends Table Styles */
        .trends-table-section {
            margin-top: 25px;
        }
        
        .trends-table-title {
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .trends-table-container {
            overflow-x: auto;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .trends-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 13px;
        }
        
        .trends-table th {
            background: #667eea;
            color: white;
            padding: 10px 8px;
            text-align: center;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .trends-table td {
            padding: 8px 6px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
        }
        
        .trends-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .trends-table tr:hover {
            background: #e9ecef;
        }
        
        .trends-table .current-month-row {
            background-color: #f0f8ff !important;
            font-weight: bold;
        }
        
        .trends-table .current-month-row td {
            font-weight: bold;
            color: #2c3e50;
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            margin-top: 10px;
            table-layout: fixed;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .data-table td {
            padding: 6px 8px;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: top;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 0;
        }

        .data-table td:first-child {
            font-weight: 500;
            color: #555;
            width: 60%;
            text-align: left;
        }

        .data-table td:last-child {
            text-align: right;
            font-weight: 600;
            color: #333;
            width: 40%;
        }

        /* Sub-card Styles */
        .sub-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow: hidden;
        }

        .sub-card h3 {
            font-size: 15px;
            font-weight: 600;
            color: #333;
            margin: 0 0 8px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #f0f0f0;
        }

        .sub-card h4 {
            font-size: 14px;
            font-weight: 600;
            color: #555;
            margin: 8px 0 6px 0;
        }

        /* Error State Styles */
        .error-state {
            text-align: center;
            padding: 20px 15px;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 6px;
            margin: 15px 0;
        }

        .error-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .error-text {
            font-size: 14px;
            color: #721c24;
        }

        /* Back Button Styles */
        .back-button {
            display: block;
            width: 100%;
            padding: 15px 20px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
        }

        /* Animations */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile responsive for insights */
        @media (max-width: 480px) {
            .insights-card {
                padding: 12px;
            }
            
            .insights-title {
                font-size: 16px;
            }
            
            .insights-text {
                font-size: 14px;
                word-wrap: break-word;
                overflow-wrap: break-word;
                white-space: normal;
                max-width: 100%;
            }
            
            .insights-section {
                margin: 15px 0;
            }
            
            /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–π –¥–∞–Ω–Ω—ã—Ö */
            .data-section {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .data-section-title {
                font-size: 16px;
                margin-bottom: 12px;
                padding-bottom: 8px;
            }
            
            .data-item {
                padding: 12px;
                margin-bottom: 15px;
            }
            
            .data-item-title {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .summary-table th,
            .summary-table td {
                padding: 8px 6px;
                font-size: 12px;
            }
            
            .section-header td {
                font-size: 13px;
                padding: 10px 6px;
            }
            
            .yield-header {
                font-size: 16px;
            }
            
            .trends-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .trend-card {
                padding: 12px;
            }
            
            .trend-title {
                font-size: 13px;
            }
            
            .trend-value {
                font-size: 16px;
            }
            
            .trend-period {
                font-size: 11px;
            }
            
            .trend-details {
                margin-top: 6px;
            }
            
            .trend-change {
                font-size: 10px;
                margin-bottom: 3px;
            }
            
            .trend-date {
                font-size: 9px;
            }
            
            .trends-table-title {
                font-size: 14px;
                margin-bottom: 12px;
            }
            
            .trends-table {
                font-size: 11px;
            }
            
            .trends-table th,
            .trends-table td {
                padding: 6px 4px;
            }
            
            .data-available {
                padding: 12px;
                font-size: 13px;
            }
        }

        /* Price and Area Input Styles */
        .listing-type-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            color: #333;
            margin-bottom: 10px;
        }

        .listing-type-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        /* Currency Buttons Styles */
        .currency-buttons-container {
            margin-bottom: 12px;
        }

        .currency-buttons-title {
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .currency-buttons {
            display: flex;
            gap: 6px;
            justify-content: center;
        }

        .currency-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 40px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 4px;
        }

        .currency-button:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .currency-button.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .currency-button.active .currency-flag,
        .currency-button.active .currency-code {
            color: white;
        }

        .currency-flag {
            font-size: 18px;
            margin-right: 4px;
        }

        .currency-code {
            font-size: 12px;
            font-weight: 600;
            color: #666;
        }
        
        /* Hide data-currency attribute display */
        .currency-button::before,
        .currency-button::after {
            content: none !important;
        }
        
        /* Ensure only span content is visible */
        .currency-button {
            position: relative;
        }
        
        .currency-button * {
            position: relative;
            z-index: 1;
        }

        /* Mobile responsive for listing type selection */
        @media (max-width: 480px) {
            .listing-type-section {
                padding: 12px;
                margin: 12px 0;
            }
            
            .listing-type-title {
                font-size: 13px;
                margin-bottom: 10px;
            }
            
            .listing-type-subtitle {
                font-size: 11px;
                margin-bottom: 6px;
            }
            
            .listing-type-select {
                padding: 8px 10px;
                font-size: 13px;
            }
            
            .listing-type-input {
                padding: 8px 10px;
                font-size: 13px;
                margin-bottom: 8px;
            }
            
            .currency-buttons {
                gap: 4px;
            }
            
            .currency-button {
                width: 45px;
                height: 35px;
                padding: 3px;
            }
            
            .currency-flag {
                font-size: 16px;
                margin-right: 3px;
            }
            
            .currency-code {
                font-size: 10px;
            }
            
            .selected-property-types {
                margin-top: 12px;
                padding-top: 12px;
            }
            
            .property-types-title {
                font-size: 13px;
                margin-bottom: 6px;
            }
            
            .property-types-details {
                font-size: 12px;
            }
            
            .property-type-item {
                padding: 3px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –õ–æ–≥–æ—Ç–∏–ø -->
        <div style="display:flex;flex-direction:column;align-items:center;margin-top:18px;margin-bottom:10px;">
            <img src="logo-flt.png" alt="Aaadviser Logo" style="width:110px;height:auto;display:block;margin-bottom:8px;cursor:pointer;" onclick="goToMainMenu()" />
            <div style="font-size:15px;color:#888;font-style:italic;" id="slogan">–ò–Ω—Å–∞–π—Ç—ã —Ä—ã–Ω–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</div>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <div class="page-title" id="pageTitle">–û—Ü–µ–Ω–∫–∞ –æ–±—ä–µ–∫—Ç–∞</div>
        <div class="page-description" id="pageDescription">–ü–æ–ª—É—á–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –æ—Ü–µ–Ω–∫—É —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ä–µ–≥–∏–æ–Ω–µ</div>

        <!-- –§–æ—Ä–º–∞ –≤—ã–±–æ—Ä–∞ –ª–æ–∫–∞—Ü–∏–∏ -->
        <div class="location-form" id="locationForm">
            <div class="form-group">
                <label for="countrySelect" id="countryLabel">–°—Ç—Ä–∞–Ω–∞:</label>
                <select id="countrySelect" onchange="onCountryChange()">
                    <option value="" id="countryPlaceholder">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                </select>
            </div>

            <div class="form-group">
                <label for="citySelect" id="cityLabel">–ì–æ—Ä–æ–¥:</label>
                <select id="citySelect" disabled onchange="onCityChange()">
                    <option value="" id="cityPlaceholder">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                </select>
            </div>

            <div class="form-group">
                <label for="countySelect" id="countyLabel">–û–±–ª–∞—Å—Ç—å/–†–µ–≥–∏–æ–Ω:</label>
                <select id="countySelect" disabled onchange="onCountyChange()">
                    <option value="" id="countyPlaceholder">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                </select>
            </div>

            <div class="form-group">
                <label for="districtSelect" id="districtLabel">–†–∞–π–æ–Ω:</label>
                <select id="districtSelect" disabled onchange="onDistrictChange()">
                    <option value="" id="districtPlaceholder">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å</option>
                </select>
            </div>

                            <!-- Listing Type Selection -->
                <div class="listing-type-section" id="listingTypeSection" style="display: none;">
                    <div class="listing-type-title" id="listingTypeTitle">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:</div>
                    
                    <!-- House Type Listing Types -->
                    <div class="listing-type-group">
                        <div class="listing-type-subtitle" id="houseTypeSubtitle">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∞–ª–µ–Ω:</div>
                        <select class="listing-type-select" id="houseTypeSelect">
                            <option value="" id="houseTypePlaceholder">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∞–ª–µ–Ω</option>
                        </select>
                    </div>

                    <!-- Floor Segment Listing Types -->
                    <div class="listing-type-group">
                        <div class="listing-type-subtitle" id="floorSegmentSubtitle">–≠—Ç–∞–∂:</div>
                        <select class="listing-type-select" id="floorSegmentSelect">
                            <option value="" id="floorSegmentPlaceholder">–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–∂</option>
                        </select>
                    </div>

                    <!-- Age Data Listing Types -->
                    <div class="listing-type-group">
                        <div class="listing-type-subtitle" id="ageDataSubtitle">–í–æ–∑—Ä–∞—Å—Ç –æ–±—ä–µ–∫—Ç–∞:</div>
                        <select class="listing-type-select" id="ageDataSelect">
                            <option value="" id="ageDataPlaceholder">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç –æ–±—ä–µ–∫—Ç–∞</option>
                        </select>
                    </div>

                    <!-- Heating Data Listing Types -->
                    <div class="listing-type-group">
                        <div class="listing-type-subtitle" id="heatingDataSubtitle">–¢–∏–ø –æ—Ç–æ–ø–ª–µ–Ω–∏—è:</div>
                        <select class="listing-type-select" id="heatingDataSelect">
                            <option value="" id="heatingDataPlaceholder">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ç–æ–ø–ª–µ–Ω–∏—è</option>
                        </select>
                    </div>

                    <!-- Price Object -->
                    <div class="listing-type-group">
                        <div class="listing-type-subtitle" id="priceObjectSubtitle">–¶–µ–Ω–∞ –æ–±—ä–µ–∫—Ç–∞:</div>
                        <input type="number" id="priceObjectInput" class="listing-type-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É">
                        
                        <!-- Currency Selection -->
                        <div class="currency-buttons-container">
                            <div class="currency-buttons-title" id="currencyTitle">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É:</div>
                            <div class="currency-buttons">
                                <button type="button" class="currency-button" data-currency="TRY">
                                    <span class="currency-flag">üáπüá∑</span>
                                    <span class="currency-code">‚Ç∫</span>
                                </button>
                                <button type="button" class="currency-button" data-currency="EUR">
                                    <span class="currency-flag">üá™üá∫</span>
                                    <span class="currency-code">‚Ç¨</span>
                                </button>
                                <button type="button" class="currency-button" data-currency="USD">
                                    <span class="currency-flag">üá∫üá∏</span>
                                    <span class="currency-code">$</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Area Object -->
                    <div class="listing-type-group">
                        <div class="listing-type-subtitle" id="areaObjectSubtitle">–ü–ª–æ—â–∞–¥—å –æ–±—ä–µ–∫—Ç–∞ (–º¬≤):</div>
                        <input type="number" id="areaObjectInput" class="listing-type-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–ª–æ—â–∞–¥—å" min="10" max="1000">
                    </div>
                </div>

            <button class="confirm-button" id="confirmButton" onclick="confirmLocation()" disabled>
                <span id="confirmButtonText">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä</span>
            </button>
        </div>

        <!-- –í—ã–±—Ä–∞–Ω–Ω–∞—è –ª–æ–∫–∞—Ü–∏—è -->
        <div class="selected-location" id="selectedLocation" style="display: none;">
            <div class="location-title" id="selectedLocationTitle">–í—ã–±—Ä–∞–Ω–Ω–∞—è –ª–æ–∫–∞—Ü–∏—è:</div>
            <div class="location-details" id="locationDetails"></div>
            
            <!-- –í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ -->
            <div class="selected-property-types" id="selectedPropertyTypes" style="display: none;">
                <div class="property-types-title" id="propertyTypesTitle">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –æ–±—ä–µ–∫—Ç–∞:</div>
                <div class="property-types-details" id="propertyTypesDetails"></div>
            </div>
            
            <div class="admin-ids" id="adminIds" style="display: none;">
                <div class="admin-title" id="adminIdsTitle">ID –¥–ª—è –∞–¥–º–∏–Ω–æ–≤:</div>
                <div class="admin-details" id="adminDetails"></div>
            </div>
        </div>

        <!-- –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ - —Å–∫—Ä—ã—Ç—ã -->
        <div class="key-metrics-section" id="keyMetricsSection" style="display: none;">
            <!-- –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–∫—Ä—ã—Ç—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü–∞ "–°—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è" -->
        </div>

        <!-- AI Insights Section -->
        <div class="insights-section" id="insightsSection" style="display: none;">
            <div class="insights-card">
                <div class="insights-header">
                    <div class="insights-title" id="insightsTitle">–°–∞–º–º–∞—Ä–∏</div>
                </div>
                <div class="insights-content" id="insightsContent">
                    <div class="insights-loading" id="insightsLoading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text" id="insightsLoadingText"></div>
                    </div>
                    <div class="insights-text" id="insightsText" style="display: none;"></div>
                    <div class="insights-error" id="insightsError" style="display: none;">
                        <div class="error-icon">‚ö†Ô∏è</div>
                        <div class="error-text" id="insightsErrorText"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Content -->
        <div class="data-content" id="dataContent" style="display: none;">
            <!-- Market Indicators Table -->
            <div class="data-section" id="summaryDataSection">
                <h3 class="data-section-title" id="summaryDataTitle"></h3>
                <div class="data-section-content" id="summaryDataContent">
                    <!-- Market indicators data will be populated here -->
                </div>
            </div>
        </div>

        <!-- Error State -->
        <div class="error-state" id="errorState" style="display: none;">
            <div class="error-icon">‚ùå</div>
            <div class="error-text" id="errorText">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>
        </div>

        <!-- Back Button -->
        <a href="/webapp_main" class="back-button" id="backButton">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</a>
    </div>

    <script>
        // Telegram WebApp initialization
        let tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // Current language
        let currentLanguage = 'ru';

        // Selected location data
        let selectedLocation = {
            country_id: null,
            city_id: null,
            county_id: null,
            district_id: null,
            country_name: '',
            city_name: '',
            county_name: '',
            district_name: ''
        };

        // User language
        let userLanguage = 'ru';

        // Selected listing types
        let selectedListingTypes = {
            house_type: null,
            floor_segment: null,
            age: null,
            heating: null
        };

        // Localization data
        const locales = {
            'ru': {
                'slogan': '–ò–Ω—Å–∞–π—Ç—ã —Ä—ã–Ω–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏',
                'pageTitle': '–û—Ü–µ–Ω–∫–∞ –æ–±—ä–µ–∫—Ç–∞',
                'pageDescription': '–ü–æ–ª—É—á–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –æ—Ü–µ–Ω–∫—É —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ä–µ–≥–∏–æ–Ω–µ',
                'countryLabel': '–°—Ç—Ä–∞–Ω–∞:',
                'cityLabel': '–ì–æ—Ä–æ–¥:',
                'countyLabel': '–û–±–ª–∞—Å—Ç—å/–†–µ–≥–∏–æ–Ω:',
                'districtLabel': '–†–∞–π–æ–Ω:',
                'countryPlaceholder': '–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É',
                'cityPlaceholder': '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É',
                'countyPlaceholder': '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥',
                'districtPlaceholder': '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å',
                'confirmButtonText': '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä',
                'backButton': '‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
                'selectedLocationTitle': '–í—ã–±—Ä–∞–Ω–Ω–∞—è –ª–æ–∫–∞—Ü–∏—è:',
                'adminIdsTitle': 'ID –¥–ª—è –∞–¥–º–∏–Ω–æ–≤:',
                'loading': '–ó–∞–≥—Ä—É–∑–∫–∞...',
                'errorLoading': '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö',
                'dataSectionTitle': '–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞',
                'loadingText': '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...',
                'errorText': '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö',
                'totalProperties': '–í—Å–µ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤:',
                'averagePrice': '–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞:',
                'priceRange': '–î–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω:',
                'noDataAvailable': '–î–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã',
                'keyMetricsTitle': '–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏',
                'avgSalePriceLabel': '–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –º¬≤',
                'avgRentPriceLabel': '–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã –∑–∞ –º¬≤',
                'listingPeriodSaleLabel': '–ü–µ—Ä–∏–æ–¥ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è (–ø—Ä–æ–¥–∞–∂–∞)',
                'listingPeriodRentLabel': '–ü–µ—Ä–∏–æ–¥ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è (–∞—Ä–µ–Ω–¥–∞)',
                'yieldLabel': '–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å',
                'insightsTitle': '–°–∞–º–º–∞—Ä–∏',
                'insightsLoading': '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ...',
                'insightsError': '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –¥–∞–Ω–Ω—ã—Ö',
                'listingTypeTitle': '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:',
                'houseTypeSubtitle': '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∞–ª–µ–Ω:',
                'floorSegmentSubtitle': '–≠—Ç–∞–∂:',
                'ageDataSubtitle': '–í–æ–∑—Ä–∞—Å—Ç –æ–±—ä–µ–∫—Ç–∞:',
                'heatingDataSubtitle': '–¢–∏–ø –æ—Ç–æ–ø–ª–µ–Ω–∏—è:',
                'priceObjectSubtitle': '–¶–µ–Ω–∞ –æ–±—ä–µ–∫—Ç–∞:',
                'areaObjectSubtitle': '–ü–ª–æ—â–∞–¥—å –æ–±—ä–µ–∫—Ç–∞ (–º¬≤):',
                'selectBedrooms': '–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∞–ª–µ–Ω',
                'selectFloor': '—ç—Ç–∞–∂',
                'selectAge': '–≤–æ–∑—Ä–∞—Å—Ç –æ–±—ä–µ–∫—Ç–∞',
                'selectHeating': '—Ç–∏–ø –æ—Ç–æ–ø–ª–µ–Ω–∏—è',
                'propertyTypesTitle': '–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –æ–±—ä–µ–∫—Ç–∞:',
                'bedroomsLabel': '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∞–ª–µ–Ω',
                'floorLabel': '–≠—Ç–∞–∂',
                'ageLabel': '–í–æ–∑—Ä–∞—Å—Ç –æ–±—ä–µ–∫—Ç–∞',
                'heatingLabel': '–¢–∏–ø –æ—Ç–æ–ø–ª–µ–Ω–∏—è',
                'marketIndicatorsTitle': '–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Ä—ã–Ω–∫–∞',
                'marketTrendsTitle': '–¢—Ä–µ–Ω–¥—ã —Ä—ã–Ω–∫–∞',
                'saleHeader': '–ü—Ä–æ–¥–∞–∂–∞',
                'rentHeader': '–ê—Ä–µ–Ω–¥–∞',
                'currencyTitle': '–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É:',
                'pricePlaceholder': '–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É',
                'areaPlaceholder': '–í–≤–µ–¥–∏—Ç–µ –ø–ª–æ—â–∞–¥—å',
                'marketPriceTrendTitle': '–†—ã–Ω–æ—á–Ω—ã–π —Ç—Ä–µ–Ω–¥ —Ü–µ–Ω—ã –ø–æ –≤–∞—à–µ–º—É –æ–±—ä–µ–∫—Ç—É:',
                'saleTrendLabel': '–ü—Ä–æ–¥–∞–∂–∞',
                'rentTrendLabel': '–ê—Ä–µ–Ω–¥–∞',
                'yourPriceAbove': '–í–∞—à–∞ —Ü–µ–Ω–∞ –≤—ã—à–µ —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –Ω–∞',
                'yourPriceBelow': '–í–∞—à–∞ —Ü–µ–Ω–∞ –Ω–∏–∂–µ —Ç—Ä–µ–Ω–¥–æ–≤–æ–π –Ω–∞',
                'yourPriceEqual': '–í–∞—à–∞ —Ü–µ–Ω–∞ —Ä–∞–≤–Ω–∞ —Ç—Ä–µ–Ω–¥–æ–≤–æ–π',
                'trendBy': '–Ω–∞',
                'noDataMessage': '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è',
                'tableDateHeader': '–î–∞—Ç–∞',
                'tableSalePriceHeader': '–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏',
                'tableSaleChangeHeader': '–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏',
                'tableRentPriceHeader': '–¶–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã',
                'tableRentChangeHeader': '–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥—ã',
                'tableYieldHeader': '–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å'
            },
            'en': {
                'slogan': 'Real Estate Market Insights',
                'pageTitle': 'Object Evaluation',
                'pageDescription': 'Get a professional property valuation in the selected region',
                'countryLabel': 'Country:',
                'cityLabel': 'City:',
                'countyLabel': 'Region/Area:',
                'districtLabel': 'District:',
                'countryPlaceholder': 'Select country',
                'cityPlaceholder': 'First select country',
                'countyPlaceholder': 'First select city',
                'districtPlaceholder': 'First select region',
                'confirmButtonText': 'Confirm selection',
                'backButton': '‚Üê Back to main menu',
                'selectedLocationTitle': 'Selected location:',
                'adminIdsTitle': 'IDs for admins:',
                'loading': 'Loading...',
                'errorLoading': 'Error loading data',
                'dataSectionTitle': 'Regional Data Analysis',
                'loadingText': 'Loading data...',
                'errorText': 'Error loading data',
                'totalProperties': 'Total properties:',
                'averagePrice': 'Average price:',
                'priceRange': 'Price range:',
                'noDataAvailable': 'Data not available',
                'keyMetricsTitle': 'Key Metrics',
                'avgSalePriceLabel': 'Average Sale Price per m¬≤',
                'avgRentPriceLabel': 'Average Rent Price per m¬≤',
                'listingPeriodSaleLabel': 'Listing Period (Sale)',
                'listingPeriodRentLabel': 'Listing Period (Rent)',
                'yieldLabel': 'Yield',
                'insightsTitle': 'Summary',
                'insightsLoading': 'Analyzing data...',
                'insightsError': 'Error analyzing data',
                'listingTypeTitle': 'Select property type for analysis:',
                'houseTypeSubtitle': 'Bedroom count:',
                'floorSegmentSubtitle': 'Floor:',
                'ageDataSubtitle': 'Property age:',
                'heatingDataSubtitle': 'Heating type:',
                'priceObjectSubtitle': 'Property price:',
                'areaObjectSubtitle': 'Property area (m¬≤):',
                'selectBedrooms': 'bedroom count',
                'selectFloor': 'floor',
                'selectAge': 'property age',
                'selectHeating': 'heating type',
                'propertyTypesTitle': 'Property characteristics:',
                'bedroomsLabel': 'Bedroom count',
                'floorLabel': 'Floor',
                'ageLabel': 'Property age',
                'heatingLabel': 'Heating type',
                'marketIndicatorsTitle': 'Market Indicators',
                'marketTrendsTitle': 'Market Trends',
                'saleHeader': 'Sale',
                'rentHeader': 'Rent',
                'currencyTitle': 'Select currency:',
                'pricePlaceholder': 'Enter price',
                'areaPlaceholder': 'Enter area',
                'marketPriceTrendTitle': 'Market price trend for your property:',
                'saleTrendLabel': 'Sale',
                'rentTrendLabel': 'Rent',
                'yourPriceAbove': 'Your price is above the trend by',
                'yourPriceBelow': 'Your price is below the trend by',
                'yourPriceEqual': 'Your price equals the trend',
                'trendBy': 'by',
                'noDataMessage': 'No data to display',
                'tableDateHeader': 'Date',
                'tableSalePriceHeader': 'Sale Price',
                'tableSaleChangeHeader': 'Sale Change',
                'tableRentPriceHeader': 'Rent Price',
                'tableRentChangeHeader': 'Rent Change',
                'tableYieldHeader': 'Yield'
            },
            'de': {
                'slogan': 'Immobilienmarkt-Einblicke',
                'pageTitle': 'Objektbewertung',
                'pageDescription': 'Erhalten Sie eine professionelle Immobilienbewertung in der ausgew√§hlten Region',
                'countryLabel': 'Land:',
                'cityLabel': 'Stadt:',
                'countyLabel': 'Region/Bereich:',
                'districtLabel': 'Bezirk:',
                'countryPlaceholder': 'Land ausw√§hlen',
                'cityPlaceholder': 'Zuerst Land ausw√§hlen',
                'countyPlaceholder': 'Zuerst Stadt ausw√§hlen',
                'districtPlaceholder': 'Zuerst Region ausw√§hlen',
                'confirmButtonText': 'Auswahl best√§tigen',
                'backButton': '‚Üê Zur√ºck zum Hauptmen√º',
                'selectedLocationTitle': 'Ausgew√§hlte Lage:',
                'adminIdsTitle': 'IDs f√ºr Administratoren:',
                'loading': 'Laden...',
                'errorLoading': 'Fehler beim Laden der Daten',
                'dataSectionTitle': 'Regionale Datenanalyse',
                'generalDataTitle': 'Allgemeine Daten',
                'houseTypeDataTitle': 'Schlafzimmer-Anzahl-Daten',
                'floorSegmentDataTitle': 'Etagen-Daten',
                'ageDataTitle': 'Altersdaten',
                'heatingDataTitle': 'Heizungstyp-Daten',
                'loadingText': 'Daten werden geladen...',
                'errorText': 'Fehler beim Laden der Daten',
                'totalProperties': 'Gesamtobjekte:',
                'averagePrice': 'Durchschnittspreis:',
                'priceRange': 'Preisbereich:',
                'noDataAvailable': 'Daten nicht verf√ºgbar',
                'keyMetricsTitle': 'Wichtige Kennzahlen',
                'avgSalePriceLabel': 'Durchschnittlicher Verkaufspreis pro m¬≤',
                'avgRentPriceLabel': 'Durchschnittlicher Mietpreis pro m¬≤',
                'listingPeriodSaleLabel': 'Angebotsdauer (Verkauf)',
                'listingPeriodRentLabel': 'Angebotsdauer (Vermietung)',
                'yieldLabel': 'Rendite',
                'insightsTitle': 'Zusammenfassung',
                'insightsLoading': 'Daten werden analysiert...',
                'insightsError': 'Fehler bei der Datenanalyse'
            },
            'fr': {
                'slogan': 'Aper√ßus du march√© immobilier',
                'pageTitle': '√âvaluation d\'objet',
                'pageDescription': 'Obtenez une √©valuation professionnelle de propri√©t√© dans la r√©gion s√©lectionn√©e',
                'countryLabel': 'Pays :',
                'cityLabel': 'Ville :',
                'countyLabel': 'R√©gion/Zone :',
                'districtLabel': 'District :',
                'countryPlaceholder': 'S√©lectionner un pays',
                'cityPlaceholder': 'D\'abord s√©lectionner un pays',
                'countyPlaceholder': 'D\'abord s√©lectionner une ville',
                'districtPlaceholder': 'D\'abord s√©lectionner une r√©gion',
                'confirmButtonText': 'Confirmer la s√©lection',
                'backButton': '‚Üê Retour au menu principal',
                'selectedLocationTitle': 'Emplacement s√©lectionn√© :',
                'adminIdsTitle': 'IDs pour les administrateurs :',
                'loading': 'Chargement...',
                'errorLoading': 'Erreur de chargement des donn√©es',
                'dataSectionTitle': 'Analyse des donn√©es r√©gionales',
                'generalDataTitle': 'Donn√©es g√©n√©rales',
                'houseTypeDataTitle': 'Donn√©es du nombre de chambres',
                'floorSegmentDataTitle': 'Donn√©es d\'√©tage',
                'ageDataTitle': 'Donn√©es d\'√¢ge',
                'heatingDataTitle': 'Donn√©es du type de chauffage',
                'loadingText': 'Chargement des donn√©es...',
                'errorText': 'Erreur de chargement des donn√©es',
                'totalProperties': 'Total des propri√©t√©s :',
                'averagePrice': 'Prix moyen :',
                'priceRange': 'Fourchette de prix :',
                'noDataAvailable': 'Donn√©es non disponibles',
                'keyMetricsTitle': 'M√©triques cl√©s',
                'avgSalePriceLabel': 'Prix de vente moyen par m¬≤',
                'avgRentPriceLabel': 'Prix de location moyen par m¬≤',
                'listingPeriodSaleLabel': 'P√©riode d\'inscription (vente)',
                'listingPeriodRentLabel': 'P√©riode d\'inscription (location)',
                'yieldLabel': 'Rendement',
                'insightsTitle': 'R√©sum√©',
                'insightsLoading': 'Analyse des donn√©es...',
                'insightsError': 'Erreur lors de l\'analyse des donn√©es'
            },
            'tr': {
                'slogan': 'Gayrimenkul Piyasa ƒ∞√ßg√∂r√ºleri',
                'pageTitle': 'Nesne Deƒüerlendirmesi',
                'pageDescription': 'Se√ßilen b√∂lgede profesyonel gayrimenkul deƒüerlendirmesi alƒ±n',
                'countryLabel': '√úlke:',
                'cityLabel': '≈ûehir:',
                'countyLabel': 'B√∂lge/Alan:',
                'districtLabel': 'ƒ∞l√ße:',
                'countryPlaceholder': '√úlke se√ßin',
                'cityPlaceholder': '√ñnce √ºlke se√ßin',
                'countyPlaceholder': '√ñnce ≈üehir se√ßin',
                'districtPlaceholder': '√ñnce b√∂lge se√ßin',
                'confirmButtonText': 'Se√ßimi onayla',
                'backButton': '‚Üê Ana men√ºye d√∂n',
                'selectedLocationTitle': 'Se√ßilen konum:',
                'adminIdsTitle': 'Y√∂neticiler i√ßin ID\'ler:',
                'loading': 'Y√ºkleniyor...',
                'errorLoading': 'Veri y√ºkleme hatasƒ±',
                'dataSectionTitle': 'B√∂lgesel Veri Analizi',
                'generalDataTitle': 'Genel Veriler',
                'houseTypeDataTitle': 'Yatak Odasƒ± Sayƒ±sƒ± Verileri',
                'floorSegmentDataTitle': 'Kat Verileri',
                'ageDataTitle': 'Ya≈ü Verileri',
                'heatingDataTitle': 'Isƒ±tma Tipi Verileri',
                'loadingText': 'Veriler y√ºkleniyor...',
                'errorText': 'Veri y√ºkleme hatasƒ±',
                'totalProperties': 'Toplam m√ºlk:',
                'averagePrice': 'Ortalama fiyat:',
                'priceRange': 'Fiyat aralƒ±ƒüƒ±:',
                'noDataAvailable': 'Veri mevcut deƒüil',
                'keyMetricsTitle': 'Ana Metrikler',
                'avgSalePriceLabel': 'm¬≤ ba≈üƒ±na ortalama satƒ±≈ü fiyatƒ±',
                'avgRentPriceLabel': 'm¬≤ ba≈üƒ±na ortalama kiralama fiyatƒ±',
                'listingPeriodSaleLabel': 'ƒ∞lan s√ºresi (satƒ±≈ü)',
                'listingPeriodRentLabel': 'ƒ∞lan s√ºresi (kiralama)',
                'yieldLabel': 'Getiri',
                'insightsTitle': '√ñzet',
                'insightsLoading': 'Veriler analiz ediliyor...',
                'insightsError': 'Veri analizi hatasƒ±',
                'propertyTypesTitle': 'Gayrimenkul √∂zellikleri:',
                'noDataMessage': 'G√∂r√ºnt√ºlenecek veri yok',
                'tableDateHeader': 'Tarih',
                'tableSalePriceHeader': 'Satƒ±≈ü Fiyatƒ±',
                'tableSaleChangeHeader': 'Satƒ±≈ü Deƒüi≈üimi',
                'tableRentPriceHeader': 'Kiralama Fiyatƒ±',
                'tableRentChangeHeader': 'Kiralama Deƒüi≈üimi',
                'tableYieldHeader': 'Getiri'
            },
            'de': {
                'slogan': 'Immobilienmarkt-Einblicke',
                'pageTitle': 'Objektbewertung',
                'pageDescription': 'Erhalten Sie eine professionelle Immobilienbewertung in der ausgew√§hlten Region',
                'countryLabel': 'Land:',
                'cityLabel': 'Stadt:',
                'countyLabel': 'Region/Bereich:',
                'districtLabel': 'Bezirk:',
                'countryPlaceholder': 'Land ausw√§hlen',
                'cityPlaceholder': 'Zuerst Land ausw√§hlen',
                'countyPlaceholder': 'Zuerst Stadt ausw√§hlen',
                'districtPlaceholder': 'Zuerst Region ausw√§hlen',
                'confirmButtonText': 'Auswahl best√§tigen',
                'backButton': '‚Üê Zur√ºck zum Hauptmen√º',
                'selectedLocationTitle': 'Ausgew√§hlte Lage:',
                'adminIdsTitle': 'IDs f√ºr Administratoren:',
                'loading': 'Laden...',
                'errorLoading': 'Fehler beim Laden der Daten',
                'dataSectionTitle': 'Regionale Datenanalyse',
                'generalDataTitle': 'Allgemeine Daten',
                'houseTypeDataTitle': 'Schlafzimmer-Anzahl-Daten',
                'floorSegmentDataTitle': 'Etagen-Daten',
                'ageDataTitle': 'Altersdaten',
                'heatingDataTitle': 'Heizungstyp-Daten',
                'loadingText': 'Daten werden geladen...',
                'errorText': 'Fehler beim Laden der Daten',
                'totalProperties': 'Gesamtobjekte:',
                'averagePrice': 'Durchschnittspreis:',
                'priceRange': 'Preisbereich:',
                'noDataAvailable': 'Daten nicht verf√ºgbar',
                'keyMetricsTitle': 'Wichtige Kennzahlen',
                'avgSalePriceLabel': 'Durchschnittlicher Verkaufspreis pro m¬≤',
                'avgRentPriceLabel': 'Durchschnittlicher Mietpreis pro m¬≤',
                'listingPeriodSaleLabel': 'Angebotsdauer (Verkauf)',
                'listingPeriodRentLabel': 'Angebotsdauer (Vermietung)',
                'yieldLabel': 'Rendite',
                'insightsTitle': 'Zusammenfassung',
                'insightsLoading': 'Daten werden analysiert...',
                'insightsError': 'Fehler bei der Datenanalyse'
            },
            'fr': {
                'slogan': 'Aper√ßus du march√© immobilier',
                'pageTitle': '√âvaluation d\'objet',
                'pageDescription': 'Obtenez une √©valuation professionnelle de propri√©t√© dans la r√©gion s√©lectionn√©e',
                'countryLabel': 'Pays :',
                'cityLabel': 'Ville :',
                'countyLabel': 'R√©gion/Zone :',
                'districtLabel': 'District :',
                'countryPlaceholder': 'S√©lectionner un pays',
                'cityPlaceholder': 'D\'abord s√©lectionner un pays',
                'countyPlaceholder': 'D\'abord s√©lectionner une ville',
                'districtPlaceholder': 'D\'abord s√©lectionner une r√©gion',
                'confirmButtonText': 'Confirmer la s√©lection',
                'backButton': '‚Üê Retour au menu principal',
                'selectedLocationTitle': 'Emplacement s√©lectionn√© :',
                'adminIdsTitle': 'IDs pour les administrateurs :',
                'loading': 'Chargement...',
                'errorLoading': 'Erreur de chargement des donn√©es',
                'dataSectionTitle': 'Analyse des donn√©es r√©gionales',
                'generalDataTitle': 'Donn√©es g√©n√©rales',
                'houseTypeDataTitle': 'Donn√©es du nombre de chambres',
                'floorSegmentDataTitle': 'Donn√©es d\'√©tage',
                'ageDataTitle': 'Donn√©es d\'√¢ge',
                'heatingDataTitle': 'Donn√©es du type de chauffage',
                'loadingText': 'Chargement des donn√©es...',
                'errorText': 'Erreur de chargement des donn√©es',
                'totalProperties': 'Total des propri√©t√©s :',
                'averagePrice': 'Prix moyen :',
                'priceRange': 'Fourchette de prix :',
                'noDataAvailable': 'Donn√©es non disponibles',
                'keyMetricsTitle': 'M√©triques cl√©s',
                'avgSalePriceLabel': 'Prix de vente moyen par m¬≤',
                'avgRentPriceLabel': 'Prix de location moyen par m¬≤',
                'listingPeriodSaleLabel': 'P√©riode d\'inscription (vente)',
                'listingPeriodRentLabel': 'P√©riode d\'inscription (location)',
                'yieldLabel': 'Rendement',
                'insightsTitle': 'R√©sum√©',
                'insightsLoading': 'Analyse des donn√©es...',
                'insightsError': 'Erreur lors de l\'analyse des donn√©es'
            },
            'tr': {
                'slogan': 'Gayrimenkul Piyasa ƒ∞√ßg√∂r√ºleri',
                'pageTitle': 'Nesne Deƒüerlendirmesi',
                'pageDescription': 'Se√ßilen b√∂lgede profesyonel gayrimenkul deƒüerlendirmesi alƒ±n',
                'countryLabel': '√úlke:',
                'cityLabel': '≈ûehir:',
                'countyLabel': 'B√∂lge/Alan:',
                'districtLabel': 'ƒ∞l√ße:',
                'countryPlaceholder': '√úlke se√ßin',
                'cityPlaceholder': '√ñnce √ºlke se√ßin',
                'countyPlaceholder': '√ñnce ≈üehir se√ßin',
                'districtPlaceholder': '√ñnce b√∂lge se√ßin',
                'confirmButtonText': 'Se√ßimi onayla',
                'backButton': '‚Üê Ana men√ºye d√∂n',
                'selectedLocationTitle': 'Se√ßilen konum:',
                'adminIdsTitle': 'Y√∂neticiler i√ßin ID\'ler:',
                'loading': 'Y√ºkleniyor...',
                'errorLoading': 'Veri y√ºkleme hatasƒ±',
                'dataSectionTitle': 'B√∂lgesel Veri Analizi',
                'generalDataTitle': 'Genel Veriler',
                'houseTypeDataTitle': 'Yatak Odasƒ± Sayƒ±sƒ± Verileri',
                'floorSegmentDataTitle': 'Kat Verileri',
                'ageDataTitle': 'Ya≈ü Verileri',
                'heatingDataTitle': 'Isƒ±tma Tipi Verileri',
                'loadingText': 'Veriler y√ºkleniyor...',
                'errorText': 'Veri y√ºkleme hatasƒ±',
                'totalProperties': 'Toplam m√ºlk:',
                'averagePrice': 'Ortalama fiyat:',
                'priceRange': 'Fiyat aralƒ±ƒüƒ±:',
                'noDataAvailable': 'Veri mevcut deƒüil',
                'keyMetricsTitle': 'Ana Metrikler',
                'avgSalePriceLabel': 'm¬≤ ba≈üƒ±na ortalama satƒ±≈ü fiyatƒ±',
                'avgRentPriceLabel': 'm¬≤ ba≈üƒ±na ortalama kiralama fiyatƒ±',
                'listingPeriodSaleLabel': 'ƒ∞lan s√ºresi (satƒ±≈ü)',
                'listingPeriodRentLabel': 'ƒ∞lan s√ºresi (kiralama)',
                'yieldLabel': 'Getiri',
                'insightsTitle': '√ñzet',
                'insightsLoading': 'Veriler analiz ediliyor...',
                'insightsError': 'Veri analizi hatasƒ±'
            }
        };

        // Get localized text
        function getText(key) {
            return locales[currentLanguage][key] || key;
        }

        // Update page text based on current language
        function updatePageText() {
            document.getElementById('slogan').textContent = getText('slogan');
            document.getElementById('pageTitle').textContent = getText('pageTitle');
            document.getElementById('pageDescription').textContent = getText('pageDescription');
            document.getElementById('countryLabel').textContent = getText('countryLabel');
            document.getElementById('cityLabel').textContent = getText('cityLabel');
            document.getElementById('countyLabel').textContent = getText('countyLabel');
            document.getElementById('districtLabel').textContent = getText('districtLabel');
            document.getElementById('countryPlaceholder').textContent = getText('countryPlaceholder');
            document.getElementById('cityPlaceholder').textContent = getText('cityPlaceholder');
            document.getElementById('countyPlaceholder').textContent = getText('countyPlaceholder');
            document.getElementById('districtPlaceholder').textContent = getText('districtPlaceholder');
            document.getElementById('confirmButtonText').textContent = getText('confirmButtonText');
            document.getElementById('backButton').textContent = getText('backButton');
            document.getElementById('selectedLocationTitle').textContent = getText('selectedLocationTitle');
            document.getElementById('adminIdsTitle').textContent = getText('adminIdsTitle');
            
            // Update new data section elements
            const dataSectionTitle = document.getElementById('dataSectionTitle');
            if (dataSectionTitle) {
                dataSectionTitle.textContent = getText('dataSectionTitle');
            }
            
            const summaryDataTitle = document.getElementById('summaryDataTitle');
            if (summaryDataTitle) {
                summaryDataTitle.textContent = getText('marketIndicatorsTitle');
            }

            const loadingText = document.getElementById('loadingText');
            if (loadingText) {
                loadingText.textContent = getText('loadingText');
            }
            
            const errorText = document.getElementById('errorText');
            if (errorText) {
                errorText.textContent = getText('errorText');
            }
            
            // Update key metrics labels
            const keyMetricsTitle = document.getElementById('keyMetricsTitle');
            if (keyMetricsTitle) {
                keyMetricsTitle.textContent = getText('keyMetricsTitle');
            }
            
            const avgSalePriceLabel = document.getElementById('avgSalePriceLabel');
            if (avgSalePriceLabel) {
                avgSalePriceLabel.textContent = getText('avgSalePriceLabel');
            }
            
            const avgRentPriceLabel = document.getElementById('avgRentPriceLabel');
            if (avgRentPriceLabel) {
                avgRentPriceLabel.textContent = getText('avgRentPriceLabel');
            }
            
            const listingPeriodSaleLabel = document.getElementById('listingPeriodSaleLabel');
            if (listingPeriodSaleLabel) {
                listingPeriodSaleLabel.textContent = getText('listingPeriodSaleLabel');
            }
            
            const listingPeriodRentLabel = document.getElementById('listingPeriodRentLabel');
            if (listingPeriodRentLabel) {
                listingPeriodRentLabel.textContent = getText('listingPeriodRentLabel');
            }
            
            const yieldLabel = document.getElementById('yieldLabel');
            if (yieldLabel) {
                yieldLabel.textContent = getText('yieldLabel');
            }
            
            // Update insights title
            const insightsTitle = document.getElementById('insightsTitle');
            if (insightsTitle) {
                insightsTitle.textContent = getText('insightsTitle');
            }
            
            // Update insights loading and error text
            const insightsLoadingText = document.getElementById('insightsLoadingText');
            if (insightsLoadingText) {
                insightsLoadingText.textContent = getText('insightsLoading');
            }
            
            // Update listing type selection elements
            const listingTypeTitle = document.getElementById('listingTypeTitle');
            if (listingTypeTitle) { listingTypeTitle.textContent = getText('listingTypeTitle'); }
            const houseTypeSubtitle = document.getElementById('houseTypeSubtitle');
            if (houseTypeSubtitle) { houseTypeSubtitle.textContent = getText('houseTypeSubtitle'); }
            const floorSegmentSubtitle = document.getElementById('floorSegmentSubtitle');
            if (floorSegmentSubtitle) { floorSegmentSubtitle.textContent = getText('floorSegmentSubtitle'); }
            const ageDataSubtitle = document.getElementById('ageDataSubtitle');
            if (ageDataSubtitle) { ageDataSubtitle.textContent = getText('ageDataSubtitle'); }
            const heatingDataSubtitle = document.getElementById('heatingDataSubtitle');
            if (heatingDataSubtitle) { heatingDataSubtitle.textContent = getText('heatingDataSubtitle'); }
            
            // Update new fields
            const priceObjectSubtitle = document.getElementById('priceObjectSubtitle');
            if (priceObjectSubtitle) { priceObjectSubtitle.textContent = getText('priceObjectSubtitle'); }
            const areaObjectSubtitle = document.getElementById('areaObjectSubtitle');
            if (areaObjectSubtitle) { areaObjectSubtitle.textContent = getText('areaObjectSubtitle'); }
            
            // Update currency title
            const currencyTitle = document.getElementById('currencyTitle');
            if (currencyTitle) { currencyTitle.textContent = getText('currencyTitle'); }
            
            // Update placeholders
            const priceObjectInput = document.getElementById('priceObjectInput');
            if (priceObjectInput) { priceObjectInput.placeholder = getText('pricePlaceholder'); }
            const areaObjectInput = document.getElementById('areaObjectInput');
            if (areaObjectInput) { areaObjectInput.placeholder = getText('areaPlaceholder'); }
            
            // Update placeholder texts
            const houseTypePlaceholder = document.getElementById('houseTypePlaceholder');
            if (houseTypePlaceholder) { houseTypePlaceholder.textContent = getText('selectBedrooms'); }
            const floorSegmentPlaceholder = document.getElementById('floorSegmentPlaceholder');
            if (floorSegmentPlaceholder) { floorSegmentPlaceholder.textContent = getText('selectFloor'); }
            const ageDataPlaceholder = document.getElementById('ageDataPlaceholder');
            if (ageDataPlaceholder) { ageDataPlaceholder.textContent = getText('selectAge'); }
            const heatingDataPlaceholder = document.getElementById('heatingDataPlaceholder');
            if (heatingDataPlaceholder) { heatingDataPlaceholder.textContent = getText('selectHeating'); }
            
            // Update property types section
            const propertyTypesTitle = document.getElementById('propertyTypesTitle');
            if (propertyTypesTitle) { propertyTypesTitle.textContent = getText('propertyTypesTitle'); }
            
            const insightsErrorText = document.getElementById('insightsErrorText');
            if (insightsErrorText) {
                insightsErrorText.textContent = getText('insightsError');
            }
        }

        // Load countries from API
        async function loadCountries() {
            try {
                const response = await fetch('/api/locations/countries');
                const data = await response.json();
                
                if (data.success) {
                    const countrySelect = document.getElementById('countrySelect');
                    countrySelect.innerHTML = `<option value="">${getText('countryPlaceholder')}</option>`;
                    
                    data.countries.forEach(([id, name]) => {
                        const option = document.createElement('option');
                        option.value = id;
                        option.textContent = name;
                        countrySelect.appendChild(option);
                    });
                } else {
                    console.error('Failed to load countries:', data.error);
                }
            } catch (error) {
                console.error('Error loading countries:', error);
            }
        }

        // Load cities based on selected country
        async function loadCities(countryId) {
            try {
                const response = await fetch('/api/locations/cities', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ country_id: countryId })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const citySelect = document.getElementById('citySelect');
                    citySelect.innerHTML = `<option value="">${getText('cityPlaceholder')}</option>`;
                    
                    data.cities.forEach(([id, name]) => {
                        const option = document.createElement('option');
                        option.value = id;
                        option.textContent = name;
                        citySelect.appendChild(option);
                    });
                    
                    citySelect.disabled = false;
                } else {
                    console.error('Failed to load cities:', data.error);
                }
            } catch (error) {
                console.error('Error loading cities:', error);
            }
        }

        // Load counties based on selected city
        async function loadCounties(cityId) {
            try {
                const response = await fetch('/api/locations/counties', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ city_id: cityId })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const countySelect = document.getElementById('countySelect');
                    countySelect.innerHTML = `<option value="">${getText('countyPlaceholder')}</option>`;
                    
                    data.counties.forEach(([id, name]) => {
                        const option = document.createElement('option');
                        option.value = id;
                        option.textContent = name;
                        countySelect.appendChild(option);
                    });
                    
                    countySelect.disabled = false;
                } else {
                    console.error('Failed to load cities:', data.error);
                }
            } catch (error) {
                console.error('Error loading cities:', error);
            }
        }

        // Load available listing types for each data category
        async function loadListingTypes() {
            try {
                console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ listing_type –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏...');
                
                // Get current location values
                const countrySelect = document.getElementById('countrySelect');
                const citySelect = document.getElementById('citySelect');
                const countySelect = document.getElementById('countySelect');
                const districtSelect = document.getElementById('districtSelect');
                
                // Check if all required location fields are filled
                if (!countrySelect.value || !citySelect.value || !countySelect.value) {
                    console.log('‚ùå –ù–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É listing_type');
                    return;
                }
                
                const locationData = {
                    country_id: countrySelect.value,
                    city_id: citySelect.value,
                    county_id: countySelect.value,
                    district_id: districtSelect.value || 'none'
                };
                
                console.log('üìç Location data for listing types:', locationData);
                
                // Load house type listing types
                const houseTypeResponse = await fetch('/api/listing_types/house_type_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(locationData)
                });
                const houseTypeData = await houseTypeResponse.json();
                if (houseTypeData.success) {
                    console.log('‚úÖ House type listing types loaded:', houseTypeData.listing_types);
                    populateListingTypeSelect('houseTypeSelect', houseTypeData.listing_types, 'house_type');
                } else {
                    console.error('‚ùå Failed to load house type listing types:', houseTypeData.error);
                }

                // Load floor segment listing types
                const floorSegmentResponse = await fetch('/api/listing_types/floor_segment_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(locationData)
                });
                const floorSegmentData = await floorSegmentResponse.json();
                if (floorSegmentData.success) {
                    console.log('‚úÖ Floor segment listing types loaded:', floorSegmentData.listing_types);
                    populateListingTypeSelect('floorSegmentSelect', floorSegmentData.listing_types, 'floor_segment');
                } else {
                    console.error('‚ùå Failed to load floor segment listing types:', floorSegmentData.error);
                }

                // Load age data listing types
                const ageDataResponse = await fetch('/api/listing_types/age_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(locationData)
                });
                const ageDataData = await ageDataResponse.json();
                if (ageDataData.success) {
                    console.log('‚úÖ Age data listing types loaded:', ageDataData.listing_types);
                    populateListingTypeSelect('ageDataSelect', ageDataData.listing_types, 'age');
                } else {
                    console.error('‚ùå Failed to load age data listing types:', ageDataData.error);
                }

                // Load heating data listing types
                const heatingDataResponse = await fetch('/api/listing_types/heating_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(locationData)
                });
                const heatingDataData = await heatingDataResponse.json();
                if (heatingDataData.success) {
                    console.log('‚úÖ Heating data listing types loaded:', heatingDataData.listing_types);
                    populateListingTypeSelect('heatingDataSelect', heatingDataData.listing_types, 'heating');
                } else {
                    console.error('‚ùå Failed to load heating data listing types:', heatingDataData.error);
                }
                
                console.log('‚úÖ –í—Å–µ listing_type –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏');
            } catch (error) {
                console.error('‚ùå Error loading listing types:', error);
            }
        }

        // Populate listing type select with options
        function populateListingTypeSelect(selectId, listingTypes, category) {
            const select = document.getElementById(selectId);
            if (!select) {
                console.error(`‚ùå Select element not found: ${selectId}`);
                return;
            }

            console.log(`üîÑ Populating select ${selectId} with ${listingTypes.length} types for category ${category}:`, listingTypes);
            
            // Clear existing options except the first placeholder
            select.innerHTML = '<option value="">' + getSelectPlaceholder(category) + '</option>';
            
            listingTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                select.appendChild(option);
            });
            
            // Add change event listener
            select.onchange = () => selectListingType(category, select.value);
            
            console.log(`‚úÖ Select ${selectId} populated with ${listingTypes.length} items`);
        }
        
        // Get placeholder text for select dropdowns
        function getSelectPlaceholder(category) {
            const placeholders = {
                'house_type': '–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∞–ª–µ–Ω',
                'floor_segment': '—ç—Ç–∞–∂',
                'age': '–≤–æ–∑—Ä–∞—Å—Ç –æ–±—ä–µ–∫—Ç–∞',
                'heating': '—Ç–∏–ø –æ—Ç–æ–ø–ª–µ–Ω–∏—è'
            };
            return placeholders[category] || '—Ç–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏';
        }

        // Reset listing type selection
        function resetListingTypeSelection() {
            selectedListingTypes = {
                house_type: null,
                floor_segment: null,
                age: null,
                heating: null,
                price: null,
                currency: 'EUR',
                area: 50
            };
            
            // Hide listing type section
            const listingTypeSection = document.getElementById('listingTypeSection');
            if (listingTypeSection) {
                listingTypeSection.style.display = 'none';
            }
            
            // Reset all select dropdowns
            const selects = ['houseTypeSelect', 'floorSegmentSelect', 'ageDataSelect', 'heatingDataSelect'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.value = '';
                }
            });
            
            // Reset price and area fields
            const priceInput = document.getElementById('priceObjectInput');
            const areaInput = document.getElementById('areaObjectInput');
            
            if (priceInput) priceInput.value = '';
            if (areaInput) areaInput.value = '';
            
            // Reset currency buttons
            const currencyButtons = document.querySelectorAll('.currency-button');
            currencyButtons.forEach(button => {
                button.classList.remove('active');
            });
            // Set EUR as default active
            const eurButton = document.querySelector('.currency-button[data-currency="EUR"]');
            if (eurButton) eurButton.classList.add('active');
            
            // Hide selected property types section
            const selectedPropertyTypes = document.getElementById('selectedPropertyTypes');
            if (selectedPropertyTypes) {
                selectedPropertyTypes.style.display = 'none';
            }
        }

        // Handle listing type selection
        function selectListingType(category, type) {
            console.log(`üéØ Selecting listing type: ${category} = ${type}`);
            
            if (type && type !== '') {
                selectedListingTypes[category] = type;
                console.log(`‚úÖ Selected: ${category} = ${type}`);
            } else {
                selectedListingTypes[category] = null;
                console.log(`‚ùå Deselected: ${category}`);
            }
            
            // Update the display of selected property types
            updateSelectedPropertyTypesDisplay();
            
            updateConfirmButton();
            
            // Check if all listing types are selected
            const allTypesSelected = selectedListingTypes.house_type && 
                                   selectedListingTypes.floor_segment && 
                                   selectedListingTypes.age && 
                                   selectedListingTypes.heating &&
                                   selectedListingTypes.price &&
                                   selectedListingTypes.area;
            
            console.log('üîç All listing types selected:', allTypesSelected, selectedListingTypes);
            
            // If all types are selected, automatically load region data
            if (allTypesSelected) {
                console.log('üöÄ All listing types selected, automatically loading region data...');
                // Small delay to ensure UI updates are complete
                setTimeout(() => {
                    confirmLocation();
                }, 100);
            }
        }

        // Load districts based on selected county
        async function loadDistricts(countyId) {
            console.log('üîÑ Loading districts for county_id:', countyId);
            
            try {
                const response = await fetch('/api/locations/districts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ county_id: countyId })
                });
                
                const data = await response.json();
                console.log('üìä Districts API response:', data);
                
                if (data.success) {
                    const districtSelect = document.getElementById('districtSelect');
                    districtSelect.innerHTML = `<option value="">${getText('districtPlaceholder')}</option>`;
                    
                    // Add "–Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è" option
                    const noDistrictOption = document.createElement('option');
                    noDistrictOption.value = 'none';
                    noDistrictOption.textContent = '–ù–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è';
                    districtSelect.appendChild(noDistrictOption);
                    
                    console.log('üìç Adding districts:', data.districts);
                    data.districts.forEach(([id, name]) => {
                        const option = document.createElement('option');
                        option.value = id;
                        option.textContent = name;
                        districtSelect.appendChild(option);
                    });
                    
                    districtSelect.disabled = false;
                    console.log('‚úÖ Districts loaded, district select enabled');
                } else {
                    console.error('‚ùå Failed to load districts:', data.error);
                }
            } catch (error) {
                console.error('‚ùå Error loading districts:', error);
            }
        }

        // Event handlers for location changes
        function onCountryChange() {
            const countrySelect = document.getElementById('countrySelect');
            const citySelect = document.getElementById('citySelect');
            const countySelect = document.getElementById('countySelect');
            const districtSelect = document.getElementById('districtSelect');
            
            const countryId = countrySelect.value;
            
            // Reset dependent selects
            citySelect.innerHTML = `<option value="">${getText('cityPlaceholder')}</option>`;
            citySelect.disabled = true;
            countySelect.innerHTML = `<option value="">${getText('countyPlaceholder')}</option>`;
            countySelect.disabled = true;
            districtSelect.innerHTML = `<option value="">${getText('districtPlaceholder')}</option>`;
            districtSelect.disabled = true;
            
            // Reset listing type selection and hide section
            resetListingTypeSelection();
            const listingTypeSection = document.getElementById('listingTypeSection');
            if (listingTypeSection) {
                listingTypeSection.style.display = 'none';
            }
            
            if (countryId) {
                loadCities(countryId);
            }
            
            updateConfirmButton();
        }

        function onCityChange() {
            const citySelect = document.getElementById('citySelect');
            const countySelect = document.getElementById('countySelect');
            const districtSelect = document.getElementById('districtSelect');
            
            const cityId = citySelect.value;
            
            // Reset dependent selects
            countySelect.innerHTML = `<option value="">${getText('countyPlaceholder')}</option>`;
            countySelect.disabled = true;
            districtSelect.innerHTML = `<option value="">${getText('districtPlaceholder')}</option>`;
            districtSelect.disabled = true;
            
            // Reset listing type selection and hide section
            resetListingTypeSelection();
            const listingTypeSection = document.getElementById('listingTypeSection');
            if (listingTypeSection) {
                listingTypeSection.style.display = 'none';
            }
            
            if (cityId) {
                loadCounties(cityId);
            }
            
            updateConfirmButton();
        }

        function onCountyChange() {
            console.log('üîÑ County changed, starting onCountyChange function...');
            
            const countySelect = document.getElementById('countySelect');
            const districtSelect = document.getElementById('districtSelect');
            
            const countyId = countySelect.value;
            console.log('üìç Selected county_id:', countyId);
            
            // Reset dependent selects
            districtSelect.innerHTML = `<option value="">${getText('districtPlaceholder')}</option>`;
            districtSelect.disabled = true;
            console.log('üîÑ Reset district select');
            
            // Reset listing type selection and hide section
            resetListingTypeSelection();
            const listingTypeSection = document.getElementById('listingTypeSection');
            if (listingTypeSection) {
                listingTypeSection.style.display = 'none';
            }
            
            if (countyId) {
                console.log('‚úÖ County selected, loading districts for county_id:', countyId);
                loadDistricts(countyId);
            } else {
                console.log('‚ùå No county selected');
            }
            
            updateConfirmButton();
        }

        function onDistrictChange() {
            console.log('üîÑ District changed, updating confirm button...');
            updateConfirmButton();
            
            // Show listing type selection section when district is selected
            const districtSelect = document.getElementById('districtSelect');
            const listingTypeSection = document.getElementById('listingTypeSection');
            
            console.log('üìç District value:', districtSelect.value);
            
            if (districtSelect.value && districtSelect.value !== 'none') {
                console.log('‚úÖ District selected, showing listing type section and loading types...');
                listingTypeSection.style.display = 'block';
                // Load available listing types for the selected location
                loadListingTypes();
            } else {
                console.log('‚ùå No district selected, hiding listing type section...');
                listingTypeSection.style.display = 'none';
                // Reset listing type selection when district is cleared
                resetListingTypeSelection();
            }
        }

        // Update selected property types display
        function updateSelectedPropertyTypesDisplay() {
            const selectedPropertyTypes = document.getElementById('selectedPropertyTypes');
            const propertyTypesDetails = document.getElementById('propertyTypesDetails');
            
            if (!selectedPropertyTypes || !propertyTypesDetails) return;
            
            // Check if any property types are selected
            const hasSelectedTypes = selectedListingTypes.house_type || 
                                   selectedListingTypes.floor_segment || 
                                   selectedListingTypes.age || 
                                   selectedListingTypes.heating ||
                                   selectedListingTypes.price ||
                                   selectedListingTypes.area;
            
            if (hasSelectedTypes) {
                selectedPropertyTypes.style.display = 'block';
                
                let html = '';
                
                if (selectedListingTypes.house_type) {
                    html += `
                        <div class="property-type-item">
                            <span class="property-type-label">${getText('bedroomsLabel')}:</span>
                            <span class="property-type-value">${selectedListingTypes.house_type}</span>
                        </div>
                    `;
                }
                
                if (selectedListingTypes.floor_segment) {
                    html += `
                        <div class="property-type-item">
                            <span class="property-type-label">${getText('floorLabel')}:</span>
                            <span class="property-type-value">${selectedListingTypes.floor_segment}</span>
                        </div>
                    `;
                }
                
                if (selectedListingTypes.age) {
                    html += `
                        <div class="property-type-item">
                            <span class="property-type-label">${getText('ageLabel')}:</span>
                            <span class="property-type-value">${selectedListingTypes.age}</span>
                        </div>
                    `;
                }
                
                if (selectedListingTypes.heating) {
                    html += `
                        <div class="property-type-item">
                            <span class="property-type-label">${getText('heatingLabel')}:</span>
                            <span class="property-type-value">${selectedListingTypes.heating}</span>
                        </div>
                    `;
                }
                
                if (selectedListingTypes.price) {
                    const currencySymbols = {
                        'TRY': 'üáπüá∑',
                        'EUR': 'üá™üá∫',
                        'USD': 'üá∫üá∏'
                    };
                    const currencySymbol = currencySymbols[selectedListingTypes.currency] || '';
                    html += `
                        <div class="property-type-item">
                            <span class="property-type-label">–¶–µ–Ω–∞ –æ–±—ä–µ–∫—Ç–∞:</span>
                            <span class="property-type-value">${selectedListingTypes.price} ${currencySymbol} ${selectedListingTypes.currency}</span>
                        </div>
                    `;
                }
                
                if (selectedListingTypes.area) {
                    html += `
                        <div class="property-type-item">
                            <span class="property-type-label">–ü–ª–æ—â–∞–¥—å –æ–±—ä–µ–∫—Ç–∞:</span>
                            <span class="property-type-value">${selectedListingTypes.area} –º¬≤</span>
                        </div>
                    `;
                }
                
                propertyTypesDetails.innerHTML = html;
            } else {
                selectedPropertyTypes.style.display = 'none';
            }
        }

        // Update confirm button state
        function updateConfirmButton() {
            const countrySelect = document.getElementById('countrySelect');
            const citySelect = document.getElementById('citySelect');
            const countySelect = document.getElementById('countySelect');
            const districtSelect = document.getElementById('districtSelect');
            const confirmButton = document.getElementById('confirmButton');
            
            const hasCountry = countrySelect.value;
            const hasCity = citySelect.value;
            const hasCounty = countySelect.value;
            const hasDistrict = districtSelect.value && districtSelect.value !== '';
            
            // Check if all listing types are selected (only if district is selected and not "none")
            let hasAllListingTypes = true;
            if (hasDistrict && districtSelect.value !== 'none') {
                hasAllListingTypes = selectedListingTypes.house_type && 
                                   selectedListingTypes.floor_segment && 
                                   selectedListingTypes.age && 
                                   selectedListingTypes.heating &&
                                   selectedListingTypes.price &&
                                   selectedListingTypes.area;
                
                console.log('üîç Checking listing types:', {
                    house_type: selectedListingTypes.house_type,
                    floor_segment: selectedListingTypes.floor_segment,
                    age: selectedListingTypes.age,
                    heating: selectedListingTypes.heating,
                    price: selectedListingTypes.price,
                    area: selectedListingTypes.area,
                    hasAllListingTypes: hasAllListingTypes
                });
            }
            
            // Button is enabled if all location fields are filled
            // For listing types: if district is "none", no listing types required
            // If district is selected, all listing types are required
            const isDisabled = !(hasCountry && hasCity && hasCounty && hasDistrict) || 
                              (hasDistrict && districtSelect.value !== 'none' && !hasAllListingTypes);
            
            confirmButton.disabled = isDisabled;
            
            console.log('üîò Confirm button state:', {
                hasCountry, hasCity, hasCounty, hasDistrict,
                districtValue: districtSelect.value,
                hasAllListingTypes,
                isDisabled
            });
        }

        // Confirm location selection
        async function confirmLocation() {
            console.log('üéØ confirmLocation function called');
            
            const countrySelect = document.getElementById('countrySelect');
            const citySelect = document.getElementById('citySelect');
            const countySelect = document.getElementById('countySelect');
            const districtSelect = document.getElementById('districtSelect');
            
            const countryId = countrySelect.value;
            const cityId = citySelect.value;
            const countyId = countySelect.value;
            const districtId = districtSelect.value === 'none' ? null : districtSelect.value;
            
            // Get names for display
            const countryName = countrySelect.options[countrySelect.selectedIndex].text;
            const cityName = citySelect.options[citySelect.selectedIndex].text;
            const countyName = countySelect.options[countySelect.selectedIndex].text;
            const districtName = districtSelect.value === 'none' ? '–ù–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è' : districtSelect.options[districtSelect.selectedIndex].text;
            
            // Convert price to EUR if needed
            let priceInEUR = null;
            if (selectedListingTypes.price && selectedListingTypes.currency !== 'EUR') {
                priceInEUR = await convertToEUR(selectedListingTypes.price, selectedListingTypes.currency);
                console.log(`üí∞ Price converted: ${selectedListingTypes.price} ${selectedListingTypes.currency} ‚Üí ${priceInEUR} EUR`);
            } else if (selectedListingTypes.price) {
                priceInEUR = selectedListingTypes.price;
            }
            
            // Update selected location
            selectedLocation = {
                country_id: countryId,
                city_id: cityId,
                county_id: countyId,
                district_id: districtId,
                country_name: countryName,
                city_name: cityName,
                county_name: countyName,
                district_name: districtName,
                // Add property details
                property_price: selectedListingTypes.price,
                property_price_currency: selectedListingTypes.currency,
                property_price_eur: priceInEUR,
                property_area: selectedListingTypes.area
            };
            
            console.log('üìç Selected location for data loading:', {
                country_id: countryId,
                city_id: cityId,
                county_id: countyId,
                district_id: districtId,
                country_name: countryName,
                city_name: cityName,
                county_name: countyName,
                district_name: districtName,
                property_price: selectedListingTypes.price,
                property_price_currency: selectedListingTypes.currency,
                property_price_eur: priceInEUR,
                property_area: selectedListingTypes.area
            });
            
            // Display selected location
            displaySelectedLocation();
            
            // Get user language
            await getUserLanguage();
            
            // Load region data with selected listing types
            await loadRegionData();
        }

        // Display selected location
        function displaySelectedLocation() {
            const selectedLocationDiv = document.getElementById('selectedLocation');
            const locationDetails = document.getElementById('locationDetails');
            const adminIds = document.getElementById('adminIds');
            const adminDetails = document.getElementById('adminDetails');
            
            // Build location string
            let locationString = selectedLocation.country_name;
            if (selectedLocation.city_name) {
                locationString += `, ${selectedLocation.city_name}`;
            }
            if (selectedLocation.county_name) {
                locationString += `, ${selectedLocation.county_name}`;
            }
            if (selectedLocation.district_name && selectedLocation.district_name !== '–ù–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è') {
                locationString += `, ${selectedLocation.district_name}`;
            }
            
            locationDetails.textContent = locationString;
            
            // Update selected property types display
            updateSelectedPropertyTypesDisplay();
            
            // Show admin IDs if user is admin
            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
                const user = window.Telegram.WebApp.initDataUnsafe.user;
                if (user && user.id) {
                    // Check if user is admin (you can implement your own admin check logic)
                    const isAdmin = true; // Placeholder - implement your admin check
                    
                    if (isAdmin) {
                        adminDetails.innerHTML = `
                            country_id: ${selectedLocation.country_id}<br>
                            city_id: ${selectedLocation.city_id}<br>
                            county_id: ${selectedLocation.county_id}<br>
                            district_id: ${selectedLocation.district_id || 'null'}
                        `;
                        adminIds.style.display = 'block';
                    }
                }
            }
            
            selectedLocationDiv.style.display = 'block';
        }

        // Get user language
        async function getUserLanguage() {
            try {
                if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
                    const user = window.Telegram.WebApp.initDataUnsafe.user;
                    if (user && user.id) {
                        const response = await fetch('/api/user/language', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ telegram_id: user.id })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            userLanguage = data.language;
                            currentLanguage = data.language;
                            updatePageText();
                        }
                    }
                }
            } catch (error) {
                console.error('Error getting user language:', error);
            }
        }

        // Load region data
        async function loadRegionData() {
            console.log('üöÄ loadRegionData function called');
            
            try {
                const requestBody = {
                    country_id: selectedLocation.country_id,
                    city_id: selectedLocation.city_id,
                    county_id: selectedLocation.county_id,
                    district_id: selectedLocation.district_id,
                    listing_types: selectedListingTypes
                };
                
                console.log('üîÑ Loading region data with request:', requestBody);
                
                const response = await fetch('/api/region_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                
                console.log('üìä API response:', data);
                
                if (data.success) {
                    displayRegionData(data);
                } else {
                    throw new Error(data.error || 'Failed to load region data');
                }
            } catch (error) {
                console.error('Error loading region data:', error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞');
            }
        }

        // Display region data
        function displayRegionData(data) {
            console.log('üìä Processing received data:', data);
            console.log('üîç Data structure:', {
                hasGeneralData: !!data.general_data,
                hasHouseTypeData: !!data.house_type_data,
                hasFloorSegmentData: !!data.floor_segment_data,
                hasAgeData: !!data.age_data,
                hasHeatingData: !!data.heating_data
            });
            
            // Try different possible key names for data
            const generalData = data.general_data || data.generalData || data.general || [];
            const houseTypeData = data.house_type_data || data.houseTypeData || data.house_types || data.houseTypes || [];
            const floorSegmentData = data.floor_segment_data || data.floorSegmentData || data.floor_segments || data.floorSegments || [];
            const ageData = data.age_data || data.ageData || data.ages || [];
            const heatingData = data.heating_data || data.heatingData || data.heating || [];
            
            console.log('üîç Extracted data arrays:', {
                general: generalData.length,
                houseType: houseTypeData.length,
                floorSegment: floorSegmentData.length,
                age: ageData.length,
                heating: heatingData.length
            });
            
            // Data sections removed - only market indicators table is shown
            
            // Generate and display summary table
            generateSummaryTable(data);
            
            // Show data content
            document.getElementById('dataContent').style.display = 'block';
            
            // Get AI insights
            getRegionInsights(data);
        }









        // Format field name
        function formatFieldName(field) {
            // Convert snake_case to readable text
            return field.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        // Format field value
        function formatFieldValue(value, field) {
            if (value === null || value === undefined) return '-';
            
            // Format based on field type
            if (typeof value === 'number') {
                if (field.includes('price') || field.includes('Price')) {
                    return formatValue(value, 'price');
                } else if (field.includes('yield') || field.includes('Yield') || field.includes('rate')) {
                    return formatValue(value, 'percentage');
                } else if (field.includes('age') || field.includes('Age')) {
                    return formatValue(value, 'years');
                } else if (field.includes('period') || field.includes('Period')) {
                    return formatValue(value, 'days');
                } else {
                    return value.toLocaleString();
                }
            }
            
            return value.toString();
        }

        // Format value based on type
        function formatValue(value, type) {
            if (value === null || value === undefined || value === '-') return '-';
            
            switch (type) {
                case 'price':
                    return `‚Ç∫${parseFloat(value).toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                case 'percentage':
                    return `${parseFloat(value).toFixed(2)}%`;
                case 'years':
                    return `${value} –ª–µ—Ç`;
                case 'days':
                    return `${value} –¥–Ω–µ–π`;
                default:
                    return value.toString();
            }
        }

        // Generate market indicators table with organized structure
        function generateSummaryTable(data) {
            const summaryContainer = document.getElementById('summaryDataContent');
            if (!summaryContainer) return;
            
            // Collect all data from all tables
            const allData = [];
            const tables = ['general_data', 'house_type_data', 'floor_segment_data', 'age_data', 'heating_data'];
            
            tables.forEach(tableName => {
                const tableData = data[tableName] || [];
                if (Array.isArray(tableData)) {
                    allData.push(...tableData);
                }
            });
            
            if (allData.length === 0) {
                summaryContainer.innerHTML = `<div class="no-data">${getText('noDataAvailable')}</div>`;
                return;
            }
            
            // Define fields for summary with new structure
            const saleFields = [
                'average_age_for_sale', 'comparable_area_for_sale', 'count_for_sale', 
                'listing_period_for_sale', 'min_unit_price_for_sale'
            ];
            
            const rentFields = [
                'average_age_for_rent', 'comparable_area_for_rent', 'count_for_rent', 
                'listing_period_for_rent', 'min_unit_price_for_rent'
            ];
            
            // Calculate min/max values for all fields
            const summary = {};
            const allFields = [...saleFields, ...rentFields, 'yield'];
            
            allFields.forEach(field => {
                const values = allData
                    .map(item => item[field])
                    .filter(val => val !== null && val !== undefined && !isNaN(parseFloat(val)));
                
                if (values.length > 0) {
                    summary[field] = {
                        min: Math.min(...values),
                        max: Math.max(...values)
                    };
                }
            });
            
            // Generate market indicators table
            let html = '<table class="data-table summary-table">';
            html += '<thead><tr><th>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å</th><th>–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</th><th>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</th></tr></thead><tbody>';
            
            // Add Sale section header
            html += `<tr class="section-header"><td colspan="3" class="sale-header">${getText('saleHeader')}</td></tr>`;
            
            // Add Sale fields
            saleFields.forEach(field => {
                if (summary[field]) {
                    const fieldName = field === 'min_unit_price_for_sale' ? 'Unit Price For Sale' : formatFieldName(field);
                    html += `
                        <tr>
                            <td>${fieldName}</td>
                            <td>${formatFieldValue(summary[field].min, field)}</td>
                            <td>${formatFieldValue(summary[field].max, field)}</td>
                        </tr>
                    `;
                }
            });
            
            // Add Rent section header
            html += `<tr class="section-header"><td colspan="3" class="rent-header">${getText('rentHeader')}</td></tr>`;
            
            // Add Rent fields
            rentFields.forEach(field => {
                if (summary[field]) {
                    const fieldName = field === 'min_unit_price_for_rent' ? 'Unit Price For Rent' : formatFieldName(field);
                    html += `
                        <tr>
                            <td>${fieldName}</td>
                            <td>${formatFieldValue(summary[field].min, field)}</td>
                            <td>${formatFieldValue(summary[field].max, field)}</td>
                        </tr>
                    `;
                }
            });
            
            // Add Yield with bold styling
            if (summary.yield) {
                html += '<tr class="yield-row"><td colspan="3" class="yield-header">Yield</td></tr>';
                html += `
                    <tr class="yield-data">
                        <td class="yield-label">Yield</td>
                        <td class="yield-value">${formatFieldValue(summary.yield.min, 'yield')}</td>
                        <td class="yield-value">${formatFieldValue(summary.yield.max, 'yield')}</td>
                    </tr>
                `;
            }
            
            html += '</tbody></table>';
            summaryContainer.innerHTML = html;
            
            // Load property trends data
            loadPropertyTrends(data);
        }

        // Load property trends data for selected location
        async function loadPropertyTrends(data) {
            try {
                // Use selected location data instead of searching through tables
                if (!selectedLocation.country_id || !selectedLocation.city_id || 
                    !selectedLocation.county_id || !selectedLocation.district_id) {
                    console.log('‚ö†Ô∏è No location selected for property trends');
                    return;
                }
                
                const locationIds = {
                    country_id: selectedLocation.country_id,
                    city_id: selectedLocation.city_id,
                    county_id: selectedLocation.county_id,
                    district_id: selectedLocation.district_id
                };
                
                console.log('üîÑ Loading property trends for location:', locationIds);
                
                // Make API request to get property trends
                const response = await fetch('/api/property_trends', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(locationIds)
                });
                
                const trendsData = await response.json();
                console.log('üìä Property trends response:', trendsData);
                
                if (trendsData.success && trendsData.trends && trendsData.trends.length > 0) {
                    // Add property trends section below the summary table
                    await addPropertyTrendsSection(trendsData.trends);
                } else {
                    console.log('‚ö†Ô∏è No property trends data available');
                }
                
            } catch (error) {
                console.error('‚ùå Error loading property trends:', error);
            }
        }
        
        // Add property trends section to the page
        async function addPropertyTrendsSection(trends) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Å–µ–∫—Ü–∏—è —Ç—Ä–µ–Ω–¥–æ–≤
            if (document.getElementById('propertyTrendsSection')) {
                console.log('‚ö†Ô∏è Property trends section already exists, skipping...');
                return;
            }
            
            const summarySection = document.getElementById('summaryDataSection');
            if (!summarySection) return;
            
            // Create property trends section
            const trendsSection = document.createElement('div');
            trendsSection.className = 'data-section';
            trendsSection.id = 'propertyTrendsSection';
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ç—Ä–µ–Ω–¥—ã –ø–æ —Ç–∏–ø–∞–º
            const groupedTrends = groupTrendsByType(trends);
            
            trendsSection.innerHTML = `
                <div class="data-section-content">
                    <div class="trends-grid">
                        ${generateMarketPriceTrendCard(trends)}
                    </div>
                    
                    <!-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ –≤—Å–µ–º–∏ –∑–∞–ø–∏—Å—è–º–∏ —Ç—Ä–µ–Ω–¥–æ–≤ -->
                    <div class="trends-table-section">
                        <h4 class="trends-table-title">–î–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–¥–æ–≤</h4>
                        <div class="trends-table-container">
                            ${await generateTrendsTable(trends)}
                        </div>
                    </div>
                </div>
            `;
            
            // Insert after summary section
            summarySection.parentNode.insertBefore(trendsSection, summarySection.nextSibling);
        }
        
        // Group trends by type for better display
        function groupTrendsByType(trends) {
            const grouped = {};
            trends.forEach(trend => {
                const key = trend.trend_type || 'general';
                if (!grouped[key]) {
                    grouped[key] = [];
                }
                grouped[key].push(trend);
            });
            return grouped;
        }
        
        // Format trend type for display
        function formatTrendType(type) {
            const typeMap = {
                'price_trend': '–¢—Ä–µ–Ω–¥ —Ü–µ–Ω',
                'yield_trend': '–¢—Ä–µ–Ω–¥ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏',
                'count_trend': '–¢—Ä–µ–Ω–¥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞',
                'general': '–û–±—â–∏–π —Ç—Ä–µ–Ω–¥'
            };
            return typeMap[type] || type;
        }
        
        // Format percentage values
        function formatPercentage(value) {
            if (value === null || value === undefined) return '-';
            const numValue = parseFloat(value);
            if (isNaN(numValue)) return '-';
            
            // Check if value is already in percentage format (0.01 = 1%)
            if (Math.abs(numValue) <= 1) {
                const sign = numValue >= 0 ? '+' : '';
                return `${sign}${(numValue * 100).toFixed(2)}%`;
            } else {
                // Value is already in percentage format
                const sign = numValue >= 0 ? '+' : '';
                return `${sign}${numValue.toFixed(2)}%`;
            }
        }

        // Format number with thousand separators
        function formatNumber(value) {
            if (value === null || value === undefined) return '0';
            const numValue = parseFloat(value);
            if (isNaN(numValue)) return '0';
            
            // Use European locale for proper formatting
            return numValue.toLocaleString('de-DE', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            });
        }
        
        // Format trend date
        function formatTrendDate(dateStr) {
            if (!dateStr) return '';
            try {
                const date = new Date(dateStr);
                const monthNames = [
                    '—è–Ω–≤.', '—Ñ–µ–≤.', '–º–∞—Ä.', '–∞–ø—Ä.', '–º–∞–π', '–∏—é–Ω.',
                    '–∏—é–ª.', '–∞–≤–≥.', '—Å–µ–Ω.', '–æ–∫—Ç.', '–Ω–æ—è–±.', '–¥–µ–∫.'
                ];
                
                const month = monthNames[date.getMonth()];
                const year = date.getFullYear();
                return `${month} ${year}`;
            } catch (e) {
                return dateStr;
            }
        }
        
        // Generate market price trend card for user's property
        function generateMarketPriceTrendCard(trends) {
            if (!trends || trends.length === 0) {
                return '<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';
            }
            
            // Find current month and year trends
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth() + 1; // January is 0
            
            console.log('üîç Looking for trends:', { currentYear, currentMonth });
            console.log('üìä Available trends:', trends.map(t => ({ year: t.property_year, month: t.property_month, date: t.date })));
            
            // Find trend for current month and year
            let currentTrend = trends.find(trend => {
                if (!trend.property_year || !trend.property_month) return false;
                const match = trend.property_year === currentYear && trend.property_month === currentMonth;
                if (match) {
                    console.log('‚úÖ Found current trend:', trend);
                }
                return match;
            });
            
            // If no exact match, try to find the most recent trend
            if (!currentTrend) {
                console.log('‚ö†Ô∏è No exact match found, looking for most recent trend...');
                currentTrend = trends.reduce((latest, trend) => {
                    if (!trend.property_year || !trend.property_month) return latest;
                    if (!latest) return trend;
                    
                    const trendDate = new Date(trend.property_year, trend.property_month - 1);
                    const latestDate = new Date(latest.property_year, latest.property_month - 1);
                    
                    return trendDate > latestDate ? trend : latest;
                }, null);
                
                if (currentTrend) {
                    console.log('‚úÖ Using most recent trend:', currentTrend);
                }
            }
            
            if (!currentTrend) {
                return '<div class="no-data">' + getText('noDataMessage') + '</div>';
            }
            
            // Calculate market price for user's property
            const marketPricePerM2 = currentTrend.unit_price_for_sale || currentTrend.trend_value || 0;
            const userArea = selectedListingTypes.area || 0;
            const marketPriceTotal = marketPricePerM2 * userArea;
            
            console.log('üè† Market price calculation:', {
                marketPricePerM2,
                userArea,
                marketPriceTotal,
                currentTrend
            });
            
            // Calculate price difference with user's price
            const userPrice = selectedListingTypes.price || 0;
            let priceDifference = 0;
            let priceDifferencePercent = 0;
            let priceComparisonText = '';
            
            if (userPrice > 0) {
                priceDifference = userPrice - marketPriceTotal;
                priceDifferencePercent = (priceDifference / marketPriceTotal) * 100;
                
                if (priceDifference > 0) {
                    priceComparisonText = getText('yourPriceAbove');
                } else if (priceDifference < 0) {
                    priceComparisonText = getText('yourPriceBelow');
                } else {
                    priceComparisonText = getText('yourPriceEqual');
                }
            }
            
            // Format currency based on user's selection
            const currencySymbols = {
                'TRY': '‚Ç∫',
                'EUR': '‚Ç¨',
                'USD': '$'
            };
            const currencySymbol = currencySymbols[selectedListingTypes.currency] || '‚Ç∫';
            
            return `
                <div class="trend-card trend-card-price">
                    <div class="trend-title">${getText('marketPriceTrendTitle')}</div>
                    <div class="trend-value">${currencySymbol}${formatNumber(marketPriceTotal)}</div>
                    <div class="trend-details">
                        <div class="trend-change">
                            ${currentTrend.price_change_sale ? `${getText('saleTrendLabel')}: ${formatPercentage(currentTrend.price_change_sale)}` : ''}
                            ${currentTrend.price_change_rent ? `${getText('rentTrendLabel')}: ${formatPercentage(currentTrend.price_change_rent)}` : ''}
                        </div>
                        ${userPrice > 0 ? `
                            <div class="price-comparison">
                                ${priceComparisonText} ${getText('trendBy')} ${formatNumber(Math.abs(priceDifference))} ${selectedListingTypes.currency} 
                                (${formatPercentage(Math.abs(priceDifferencePercent))})
                            </div>
                        ` : ''}
                        <div class="trend-date">${formatTrendDate(currentTrend.date)}</div>
                    </div>
                </div>
            `;
        }

        // Generate detailed trends table
        async function generateTrendsTable(trends) {
            if (!trends || trends.length === 0) {
                return '<div class="no-data">' + getText('noDataMessage') + '</div>';
            }
            
            // Get user's area and currency
            const userArea = selectedListingTypes.area || 0;
            const userCurrency = selectedListingTypes.currency || 'EUR';
            
            console.log('üîç generateTrendsTable called with:', { userArea, userCurrency, trendsCount: trends.length });
            
            // Currency symbols
            const currencySymbols = {
                'TRY': '‚Ç∫',
                'EUR': '‚Ç¨',
                'USD': '$'
            };
            const currencySymbol = currencySymbols[userCurrency] || '‚Ç¨';
            
            // Get current exchange rates for currency conversion
            let exchangeRates = null;
            try {
                const response = await fetch('/api/currency/rates');
                if (response.ok) {
                    exchangeRates = await response.json();
                    console.log('üí± Exchange rates loaded:', exchangeRates);
                }
            } catch (error) {
                console.error('‚ùå Error loading exchange rates:', error);
            }
            
            // Filter trends to show 6 months back, current month, and 6 months forward
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth() + 1; // January is 0
            
            console.log('üîç Current date info:', { currentYear, currentMonth, currentDate });
            console.log('üìä All trends before filtering:', trends.map(t => ({ 
                year: t.property_year, 
                month: t.property_month, 
                date: t.date,
                salePrice: t.unit_price_for_sale,
                rentPrice: t.unit_price_for_rent
            })));
            
            // First, try to filter by date range
            let filteredTrends = trends.filter(trend => {
                if (!trend.property_year || !trend.property_month) return false;
                
                // Ensure we have valid numbers
                const year = parseInt(trend.property_year);
                const month = parseInt(trend.property_month);
                
                if (isNaN(year) || isNaN(month)) {
                    console.log('‚ö†Ô∏è Invalid year/month:', { year, month, trend });
                    return false;
                }
                
                const trendDate = new Date(year, month - 1);
                const sixMonthsAgo = new Date(currentYear, currentMonth - 7); // 6 months back
                const sixMonthsForward = new Date(currentYear, currentMonth + 5); // 6 months forward
                
                const isInRange = trendDate >= sixMonthsAgo && trendDate <= sixMonthsForward;
                console.log('üìÖ Trend date check:', {
                    trendYear: year,
                    trendMonth: month,
                    trendDate,
                    sixMonthsAgo,
                    sixMonthsForward,
                    isInRange
                });
                
                return isInRange;
            });
            
            // If no trends in range, show all available trends
            if (filteredTrends.length === 0) {
                console.log('‚ö†Ô∏è No trends in date range, showing all available trends');
                filteredTrends = trends.filter(trend => {
                    const year = parseInt(trend.property_year);
                    const month = parseInt(trend.property_month);
                    return !isNaN(year) && !isNaN(month);
                });
            }
            
            // Sort by date descending (newest first)
            filteredTrends.sort((a, b) => {
                const yearA = parseInt(a.property_year);
                const monthA = parseInt(a.property_month);
                const yearB = parseInt(b.property_year);
                const monthB = parseInt(b.property_month);
                
                const dateA = new Date(yearA, monthA - 1);
                const dateB = new Date(yearB, monthB - 1);
                return dateB - dateA;
            });
            
            console.log('üìÖ Final filtered trends:', filteredTrends.map(t => ({ 
                year: t.property_year, 
                month: t.property_month, 
                date: t.date,
                salePrice: t.unit_price_for_sale,
                rentPrice: t.unit_price_for_rent
            })));
            
            // If still no trends, return no data message
            if (filteredTrends.length === 0) {
                console.log('‚ùå No trends available after filtering');
                return '<div class="no-data">' + getText('noDataMessage') + '</div>';
            }
            
            let html = '<table class="trends-table">';
            html += '<thead><tr>';
            html += '<th>' + getText('tableDateHeader') + '</th>';
            html += '<th>' + getText('tableSalePriceHeader') + '</th>';
            html += '<th>' + getText('tableSaleChangeHeader') + '</th>';
            html += '<th>' + getText('tableRentPriceHeader') + '</th>';
            html += '<th>' + getText('tableRentChangeHeader') + '</th>';
            html += '<th>' + getText('tableYieldHeader') + '</th>';
            html += '</tr></thead><tbody>';
            
            filteredTrends.forEach(trend => {
                // Parse prices correctly (handle both dot and comma separators)
                let salePricePerM2 = 0;
                let rentPricePerM2 = 0;
                
                if (trend.unit_price_for_sale) {
                    salePricePerM2 = parseFloat(String(trend.unit_price_for_sale).replace(',', '.'));
                }
                if (trend.unit_price_for_rent) {
                    rentPricePerM2 = parseFloat(String(trend.unit_price_for_rent).replace(',', '.'));
                }
                
                const totalSalePrice = salePricePerM2 * userArea;
                const totalRentPrice = rentPricePerM2 * userArea;
                
                // Convert prices to user's selected currency if needed
                let displaySalePrice = totalSalePrice;
                let displayRentPrice = totalRentPrice;
                
                if (exchangeRates && userCurrency !== 'EUR') {
                    // Convert from EUR (base currency) to user's currency
                    const rate = exchangeRates[userCurrency];
                    if (rate) {
                        displaySalePrice = totalSalePrice * rate;
                        displayRentPrice = totalRentPrice * rate;
                        console.log('üí± Currency conversion:', {
                            from: 'EUR',
                            to: userCurrency,
                            rate,
                            originalSale: totalSalePrice,
                            convertedSale: displaySalePrice,
                            originalRent: totalRentPrice,
                            convertedRent: displayRentPrice
                        });
                    }
                }
                
                // Check if this is current month
                const isCurrentMonth = trend.property_year === currentYear && trend.property_month === currentMonth;
                const rowClass = isCurrentMonth ? 'current-month-row' : '';
                const fontWeight = isCurrentMonth ? 'font-weight: bold;' : '';
                
                console.log('üí∞ Price calculation:', {
                    trend: trend.date,
                    salePricePerM2,
                    rentPricePerM2,
                    userArea,
                    totalSalePrice,
                    totalRentPrice,
                    displaySalePrice,
                    displayRentPrice,
                    userCurrency,
                    isCurrentMonth,
                    trendData: trend
                });
                
                html += `<tr class="${rowClass}" style="${fontWeight}">`;
                html += `<td>${formatTrendDate(trend.date)}</td>`;
                html += `<td>${currencySymbol}${formatNumber(displaySalePrice)}</td>`;
                html += `<td>${formatPercentage(trend.price_change_sale)}</td>`;
                html += `<td>${currencySymbol}${formatNumber(displayRentPrice)}</td>`;
                html += `<td>${formatPercentage(trend.price_change_rent)}</td>`;
                html += `<td>${formatPercentage(trend.yield)}</td>`;
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            return html;
        }
        
        // Format trend value based on type
        function formatTrendValue(value, type) {
            if (value === null || value === undefined) return '-';
            
            if (type && type.includes('price')) {
                return formatValue(value, 'price');
            } else if (type && type.includes('percentage')) {
                return formatValue(value, 'percentage');
            } else if (typeof value === 'number') {
                // –ï—Å–ª–∏ —ç—Ç–æ —á–∏—Å–ª–æ, —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –µ–≥–æ
                if (value >= 1000) {
                    return value.toLocaleString('ru-RU');
                } else {
                    return value.toFixed(2);
                }
            } else {
                return value.toString();
            }
        }
        
        // Helper function to format values consistently
        function formatValue(value, type) {
            if (value === null || value === undefined) return '-';
            
            if (type === 'price') {
                if (typeof value === 'number') {
                    return `‚Ç∫${value.toLocaleString('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                }
                return value.toString();
            } else if (type === 'percentage') {
                if (typeof value === 'number') {
                    return `${(value * 100).toFixed(2)}%`;
                }
                return value.toString();
            }
            
            return value.toString();
        }
        
        // Format trend period
        function formatTrendPeriod(period) {
            if (!period) return '';
            
            // Convert period to readable format
            const periodMap = {
                'monthly': '–ú–µ—Å—è—á–Ω—ã–π',
                'quarterly': '–ö–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–π',
                'yearly': '–ì–æ–¥–æ–≤–æ–π',
                'weekly': '–ù–µ–¥–µ–ª—å–Ω—ã–π'
            };
            
            return periodMap[period] || period;
        }

        // Get AI insights for the region data
        async function getRegionInsights(regionData) {
            try {
                console.log('üß† –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º AI-–≤—ã–≤–æ–¥ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞');
                
                // Show insights section
                const insightsSection = document.getElementById('insightsSection');
                const insightsLoading = document.getElementById('insightsLoading');
                const insightsText = document.getElementById('insightsText');
                const insightsError = document.getElementById('insightsError');
                
                insightsSection.style.display = 'block';
                insightsLoading.style.display = 'flex';
                insightsText.style.display = 'none';
                insightsError.style.display = 'none';
                
                // Update loading text based on user language
                const loadingText = document.getElementById('insightsLoadingText');
                loadingText.textContent = getText('insightsLoading');
                
                // Prepare data for AI analysis
                const analysisData = {
                    region_data: regionData,
                    language: userLanguage
                };
                
                // Make API request to get AI insights
                const response = await fetch('/api/region_insights', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(analysisData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Hide loading and show insights
                    insightsLoading.style.display = 'none';
                    insightsText.style.display = 'block';
                    
                    // Update insights text
                    const insightsTextElement = document.getElementById('insightsText');
                    insightsTextElement.textContent = data.insights;
                    
                    console.log('‚úÖ AI-–≤—ã–≤–æ–¥ –ø–æ–ª—É—á–µ–Ω:', data.insights);
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è AI-–≤—ã–≤–æ–¥–∞:', error);
                
                // Hide loading and show error
                const insightsLoading = document.getElementById('insightsLoading');
                const insightsError = document.getElementById('insightsError');
                const insightsErrorText = document.getElementById('insightsErrorText');
                
                insightsLoading.style.display = 'none';
                insightsError.style.display = 'flex';
                insightsErrorText.textContent = getText('insightsError');
            }
        }



        // Show error
        function showError(message) {
            const errorState = document.getElementById('errorState');
            const errorText = document.getElementById('errorText');
            
            errorText.textContent = message;
            errorState.style.display = 'block';
        }

        // Function to go to main menu
        function goToMainMenu() {
            window.location.href = '/webapp_main';
        }

        // Function to convert currency to EUR (base currency)
        async function convertToEUR(amount, fromCurrency) {
            if (fromCurrency === 'EUR') {
                return amount;
            }
            
            try {
                // Get current exchange rates from currency table
                const response = await fetch('/api/currency/convert', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        amount: amount,
                        from_currency: fromCurrency,
                        to_currency: 'EUR'
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    return data.converted_amount;
                } else {
                    console.error('Currency conversion error:', data.error);
                    return amount; // Return original amount if conversion fails
                }
            } catch (error) {
                console.error('Error converting currency:', error);
                return amount; // Return original amount if conversion fails
            }
        }

        // Initialize page
        function init() {
            updatePageText();
            loadCountries();
            
            // Initialize price input
            const priceInput = document.getElementById('priceObjectInput');
            if (priceInput) {
                priceInput.addEventListener('input', function() {
                    selectedListingTypes.price = this.value ? parseFloat(this.value) : null;
                    updateConfirmButton();
                });
            }
            
            // Initialize area input
            const areaInput = document.getElementById('areaObjectInput');
            if (areaInput) {
                areaInput.addEventListener('input', function() {
                    selectedListingTypes.area = this.value ? parseInt(this.value) : null;
                    updateConfirmButton();
                });
            }
            
            // Initialize currency buttons
            const currencyButtons = document.querySelectorAll('.currency-button');
            currencyButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const selectedCurrency = this.dataset.currency;
                    
                    // Remove active class from all buttons
                    currencyButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Update selected currency
                    selectedListingTypes.currency = selectedCurrency;
                });
            });
            
            // Set EUR as default active currency
            const eurButton = document.querySelector('.currency-button[data-currency="EUR"]');
            if (eurButton) {
                eurButton.classList.add('active');
                selectedListingTypes.currency = 'EUR';
            }
        }

        // Start initialization when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
