# üìÅ –§–∏–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫ –æ—Ç—á–µ—Ç–æ–≤

## üéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:

### ‚úÖ –¢—Ä–µ–±—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
reports/
‚îú‚îÄ‚îÄ {telegram_id}/              # –ü–∞–ø–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á–∏—Å–ª–æ–≤–æ–π ID)
‚îÇ   ‚îú‚îÄ‚îÄ {—É–Ω–∏–∫–∞–ª—å–Ω—ã–π_–Ω–æ–º–µ—Ä}/     # –ü–∞–ø–∫–∞ –æ—Ç—á–µ—Ç–∞ (12 —Ü–∏—Ñ—Ä)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ {–Ω–æ–º–µ—Ä}.html        # HTML —Ñ–∞–π–ª –æ—Ç—á–µ—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ photos/             # –ü–∞–ø–∫–∞ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ property_1.jpg
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ property_2.png
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ {–¥—Ä—É–≥–æ–π_–æ—Ç—á–µ—Ç}/
‚îî‚îÄ‚îÄ {–¥—Ä—É–≥–æ–π_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å}/
```

### üîç –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
```
reports/
‚îú‚îÄ‚îÄ 123456789/                  # telegram_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îî‚îÄ‚îÄ 847392058473/           # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –æ—Ç—á–µ—Ç–∞
‚îÇ       ‚îú‚îÄ‚îÄ 847392058473.html   # HTML —Ñ–∞–π–ª –æ—Ç—á–µ—Ç–∞
‚îÇ       ‚îî‚îÄ‚îÄ photos/             # –ü–∞–ø–∫–∞ –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –æ–±—ä–µ–∫—Ç–∞
‚îÇ           ‚îî‚îÄ‚îÄ property_1.jpg
‚îî‚îÄ‚îÄ —Å—Ç–∞—Ä—ã–µ_—Ñ–∞–π–ª—ã...             # Legacy –æ—Ç—á–µ—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è
```

## üõ†Ô∏è –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫:
```python
# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –æ—Ç—á–µ—Ç–∞ –¥–ª—è –ø–∞–ø–∫–∏
report_folder_id = ''.join(random.choices(string.digits, k=12))

# –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫: reports/{telegram_id}/{report_folder_id}/
user_reports_dir = os.path.join('reports', str(telegram_id))
report_dir = os.path.join(user_reports_dir, report_folder_id)

# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
os.makedirs(report_dir, exist_ok=True)

# –ü—É—Ç–∏ –¥–ª—è —Ñ–∞–π–ª–æ–≤
filename = f"{report_folder_id}.html"
file_path = os.path.join(report_dir, filename)
photos_dir = os.path.join(report_dir, 'photos')
```

### 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:
```python
if property_info.get('photos'):
    # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
    os.makedirs(photos_dir, exist_ok=True)
    
    for i, photo in enumerate(property_info['photos']):
        # –î–µ–∫–æ–¥–∏—Ä—É–µ–º base64 –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
        photo_filename = f"property_{i+1}.jpg"
        photo_path = os.path.join(photos_dir, photo_filename)
        
        with open(photo_path, 'wb') as f:
            f.write(image_data)
```

### 3. API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
```python
# –î–æ—Å—Ç—É–ø –∫ –æ—Ç—á–µ—Ç–∞–º
@app.route('/reports/<int:telegram_id>/<report_id>/<filename>')
def serve_report(telegram_id, report_id, filename):
    report_dir = os.path.join('reports', str(telegram_id), report_id)
    return send_from_directory(report_dir, filename)

# –î–æ—Å—Ç—É–ø –∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º
@app.route('/reports/<int:telegram_id>/<report_id>/photos/<photo_filename>')
def serve_report_photo(telegram_id, report_id, photo_filename):
    photos_dir = os.path.join('reports', str(telegram_id), report_id, 'photos')
    return send_from_directory(photos_dir, photo_filename)
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫**: –ù–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
2. **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞**: –ö–∞–∂–¥—ã–π –æ—Ç—á–µ—Ç –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π 12-–∑–Ω–∞—á–Ω—ã–π ID
3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π**: –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫—É `photos/`
4. **Legacy –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: –°—Ç–∞—Ä—ã–µ –æ—Ç—á–µ—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏
5. **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
6. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤

### üó∫Ô∏è –ö–∞—Ä—Ç–∞ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ `report_data`
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è OpenStreetMap —Å –º–∞—Ä–∫–µ—Ä–æ–º
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ –±–ª–æ–∫–µ "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–æ–∫–∞—Ü–∏–∏"

### üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ–±—ä–µ–∫—Ç–∞:
- –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Ñ–∞–π–ª—ã ‚Üí base64)
- –ö–∞—Ä—É—Å–µ–ª—å —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –∏ –∞–≤—Ç–æ—Å–º–µ–Ω–æ–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞–ø–∫–∏

## üîÑ –ü–µ—Ä–µ—Ö–æ–¥ —Å–æ —Å—Ç–∞—Ä–æ–π –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

### –°—Ç–∞—Ä—ã–µ –æ—Ç—á–µ—Ç—ã (Legacy):
```
reports/
‚îú‚îÄ‚îÄ 1.html
‚îú‚îÄ‚îÄ 1_files/
‚îú‚îÄ‚îÄ Rapport d'analyse immobili√®re.html
‚îî‚îÄ‚îÄ Real Estate Analytics Report.html
```

### –ù–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã (Current):
```
reports/
‚îú‚îÄ‚îÄ 123456789/
‚îÇ   ‚îî‚îÄ‚îÄ 847392058473/
‚îÇ       ‚îú‚îÄ‚îÄ 847392058473.html
‚îÇ       ‚îî‚îÄ‚îÄ photos/
‚îî‚îÄ‚îÄ 987654321/
    ‚îî‚îÄ‚îÄ 592847362849/
        ‚îú‚îÄ‚îÄ 592847362849.html
        ‚îî‚îÄ‚îÄ photos/
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –æ—Ç—á–µ—Ç:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
2. –°–æ–∑–¥–∞–π—Ç–µ –æ—Ç—á–µ—Ç —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ –æ–±—ä–µ–∫—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ `reports/{telegram_id}/{report_id}/`
4. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ `photos/`
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –∫–∞—Ä—Ç—ã –∏ –∫–∞—Ä—É—Å–µ–ª–∏

### –õ–æ–≥–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
```
=== SAVING HTML REPORT === Data keys: [...]
Telegram ID: 123456789
Creating report directory structure: reports/123456789/847392058473
Successfully created directory: reports/123456789/847392058473
Processing 3 photos for report
Created photos directory: reports/123456789/847392058473/photos
Saved photo: reports/123456789/847392058473/photos/property_1.jpg (1024 bytes)
Successfully saved 3 photos
```

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º!**

- ‚úÖ Telegram ID –∫–∞–∫ –ø–∞–ø–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –æ—Ç—á–µ—Ç–∞ –∫–∞–∫ –ø–æ–¥–ø–∞–ø–∫–∞  
- ‚úÖ HTML —Ñ–∞–π–ª —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º
- ‚úÖ –ü–∞–ø–∫–∞ photos/ –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –æ–±—ä–µ–∫—Ç–∞
- ‚úÖ –ö–∞—Ä—Ç–∞ —á–µ—Ä–µ–∑ OpenStreetMap —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
- ‚úÖ –ö–∞—Ä—É—Å–µ–ª—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ

**–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!** üöÄ
